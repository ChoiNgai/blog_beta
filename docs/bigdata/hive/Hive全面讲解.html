<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hive全面讲解 | 大数据技术文档</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="./favicon.ico">
    <meta name="description" content="从入门到入土">
    
    <link rel="preload" href="./assets/css/0.styles.e88c5000.css" as="style"><link rel="preload" href="./assets/js/app.dc5b0715.js" as="script"><link rel="preload" href="./assets/js/2.47c06342.js" as="script"><link rel="preload" href="./assets/js/23.454fb1a0.js" as="script"><link rel="prefetch" href="./assets/js/10.ef98acb1.js"><link rel="prefetch" href="./assets/js/11.37b04a4d.js"><link rel="prefetch" href="./assets/js/12.cee383a4.js"><link rel="prefetch" href="./assets/js/13.d47b2b52.js"><link rel="prefetch" href="./assets/js/14.77b2b060.js"><link rel="prefetch" href="./assets/js/15.a024878c.js"><link rel="prefetch" href="./assets/js/16.a7201fbc.js"><link rel="prefetch" href="./assets/js/17.79e79675.js"><link rel="prefetch" href="./assets/js/18.7639ae91.js"><link rel="prefetch" href="./assets/js/19.280df9d2.js"><link rel="prefetch" href="./assets/js/20.25a38eac.js"><link rel="prefetch" href="./assets/js/21.0aaf754a.js"><link rel="prefetch" href="./assets/js/22.abdec3c1.js"><link rel="prefetch" href="./assets/js/24.5118d094.js"><link rel="prefetch" href="./assets/js/25.b239a8e2.js"><link rel="prefetch" href="./assets/js/26.4af89c7f.js"><link rel="prefetch" href="./assets/js/27.b338361b.js"><link rel="prefetch" href="./assets/js/28.225e99c8.js"><link rel="prefetch" href="./assets/js/29.1749fe14.js"><link rel="prefetch" href="./assets/js/3.376b8cdf.js"><link rel="prefetch" href="./assets/js/30.422f2538.js"><link rel="prefetch" href="./assets/js/31.b1265e4d.js"><link rel="prefetch" href="./assets/js/32.7f4a7aa0.js"><link rel="prefetch" href="./assets/js/33.e8f1b887.js"><link rel="prefetch" href="./assets/js/34.ea398359.js"><link rel="prefetch" href="./assets/js/35.046ac0f0.js"><link rel="prefetch" href="./assets/js/36.f0d4cc9b.js"><link rel="prefetch" href="./assets/js/37.0a7a5f8f.js"><link rel="prefetch" href="./assets/js/38.d06cfcca.js"><link rel="prefetch" href="./assets/js/39.d164c990.js"><link rel="prefetch" href="./assets/js/4.6d1a6719.js"><link rel="prefetch" href="./assets/js/40.6bc1f68d.js"><link rel="prefetch" href="./assets/js/41.e1d9e6f4.js"><link rel="prefetch" href="./assets/js/42.b9146544.js"><link rel="prefetch" href="./assets/js/43.3d89ef90.js"><link rel="prefetch" href="./assets/js/44.e75043b3.js"><link rel="prefetch" href="./assets/js/45.fa675a86.js"><link rel="prefetch" href="./assets/js/46.5e1bd863.js"><link rel="prefetch" href="./assets/js/47.8287576d.js"><link rel="prefetch" href="./assets/js/48.7f50621f.js"><link rel="prefetch" href="./assets/js/49.1273014b.js"><link rel="prefetch" href="./assets/js/5.c4786839.js"><link rel="prefetch" href="./assets/js/50.0ace36ad.js"><link rel="prefetch" href="./assets/js/51.955bc85d.js"><link rel="prefetch" href="./assets/js/52.e3bb73d6.js"><link rel="prefetch" href="./assets/js/53.70bca49a.js"><link rel="prefetch" href="./assets/js/54.4f6fe468.js"><link rel="prefetch" href="./assets/js/55.d0ae6f7c.js"><link rel="prefetch" href="./assets/js/56.5bfe7854.js"><link rel="prefetch" href="./assets/js/57.20ab4e15.js"><link rel="prefetch" href="./assets/js/58.cd6e845e.js"><link rel="prefetch" href="./assets/js/59.e31f564e.js"><link rel="prefetch" href="./assets/js/6.81b9d3e2.js"><link rel="prefetch" href="./assets/js/60.7e997bce.js"><link rel="prefetch" href="./assets/js/61.ae3effab.js"><link rel="prefetch" href="./assets/js/62.d40d2f3b.js"><link rel="prefetch" href="./assets/js/63.c7ab6850.js"><link rel="prefetch" href="./assets/js/64.c317433a.js"><link rel="prefetch" href="./assets/js/65.bee18659.js"><link rel="prefetch" href="./assets/js/66.9bc2ca3c.js"><link rel="prefetch" href="./assets/js/67.36393d6f.js"><link rel="prefetch" href="./assets/js/68.50d2a85d.js"><link rel="prefetch" href="./assets/js/69.bbac38d8.js"><link rel="prefetch" href="./assets/js/7.9979a04e.js"><link rel="prefetch" href="./assets/js/70.318eb4aa.js"><link rel="prefetch" href="./assets/js/71.54649836.js"><link rel="prefetch" href="./assets/js/72.3ebd3c24.js"><link rel="prefetch" href="./assets/js/73.24b6f12b.js"><link rel="prefetch" href="./assets/js/74.1dd537ea.js"><link rel="prefetch" href="./assets/js/75.59231e92.js"><link rel="prefetch" href="./assets/js/76.b8f3ef78.js"><link rel="prefetch" href="./assets/js/77.11821a18.js"><link rel="prefetch" href="./assets/js/78.f63e0308.js"><link rel="prefetch" href="./assets/js/79.1c7441a7.js"><link rel="prefetch" href="./assets/js/8.db54d2a5.js"><link rel="prefetch" href="./assets/js/80.0d3fa419.js"><link rel="prefetch" href="./assets/js/81.53362836.js"><link rel="prefetch" href="./assets/js/82.6a9be763.js"><link rel="prefetch" href="./assets/js/83.11a41a2c.js"><link rel="prefetch" href="./assets/js/84.2e76a3fb.js"><link rel="prefetch" href="./assets/js/85.c61a2184.js"><link rel="prefetch" href="./assets/js/86.7d905d1b.js"><link rel="prefetch" href="./assets/js/87.4c907051.js"><link rel="prefetch" href="./assets/js/88.82047d34.js"><link rel="prefetch" href="./assets/js/89.3457441e.js"><link rel="prefetch" href="./assets/js/9.c83a911f.js"><link rel="prefetch" href="./assets/js/90.cc103581.js"><link rel="prefetch" href="./assets/js/91.68961351.js"><link rel="prefetch" href="./assets/js/92.fbb8f838.js">
    <link rel="stylesheet" href="./assets/css/0.styles.e88c5000.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/./" class="home-link router-link-active"><!----> <span class="site-name">大数据技术文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/./" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程基础" class="dropdown-title"><span class="title">编程基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程基础" class="mobile-dropdown-title"><span class="title">编程基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/java基础语法/" class="nav-link">
  Java基础语法
</a></li><li class="dropdown-subitem"><a href="/./coding-base/" class="nav-link">
  Java基础实战
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶(选学)
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/java并发编程/java并发编程.html" class="nav-link">
  Java并发编程
</a></li><li class="dropdown-subitem"><a href="/./coding-base/" class="nav-link">
  Java网络编程
</a></li><li class="dropdown-subitem"><a href="/./coding-base/java集合/Java集合（永盛）.html" class="nav-link">
  Java集合
</a></li><li class="dropdown-subitem"><a href="/./coding-base/java虚拟机/" class="nav-link">
  Java虚拟机
</a></li></ul></li><li class="dropdown-item"><h4>
          计算机基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-subitem"><a href="/./coding-base/数据结构与算法/" class="nav-link">
  数据结构（重要）
</a></li><li class="dropdown-subitem"><a href="/./coding-base/计算机网络/计算机网络（双祥）.html" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/./coding-base/操作系统/" class="nav-link">
  操作系统
</a></li></ul></li><li class="dropdown-item"><h4>
          Python（选学）
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/Python/python基础/" class="nav-link">
  Python基础语法
</a></li><li class="dropdown-subitem"><a href="/./coding-base/Python/python库/" class="nav-link">
  Python数据科学库
</a></li></ul></li><li class="dropdown-item"><h4>
          框架（选学）
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/框架/springboot/springboot.html" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-subitem"><a href="/./coding-base/框架/flask/falsk.html" class="nav-link">
  Flask
</a></li><li class="dropdown-subitem"><a href="/./coding-base/框架/vue/flask.html" class="nav-link">
  Vue
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./database/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/./database/hbase/" class="nav-link">
  HBase
</a></li><li class="dropdown-item"><!----> <a href="/./database/clickhouse/" class="nav-link">
  ClickHouse
</a></li><li class="dropdown-item"><!----> <a href="/./database/tidb/" class="nav-link">
  TiDB
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据仓库" class="dropdown-title"><span class="title">数据仓库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据仓库" class="mobile-dropdown-title"><span class="title">数据仓库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./datahouse/大数据基础/bigdata-base.html" class="nav-link">
  大数据基础
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/离线数仓/" class="nav-link">
  离线数仓
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/实时数仓/" class="nav-link">
  实时数仓
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/广告技术/" class="nav-link">
  广告技术
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/电商业务/" class="nav-link">
  电商业务
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据框架及组件" class="dropdown-title"><span class="title">大数据框架及组件</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据框架及组件" class="mobile-dropdown-title"><span class="title">大数据框架及组件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./bigdata/hadoop/" class="nav-link">
  Hadoop
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/hive/" class="nav-link router-link-active">
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/zookeeper/" class="nav-link">
  Zookeeper
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/kafka/" class="nav-link">
  kafka
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/spark/" class="nav-link">
  Spark
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/flink/" class="nav-link">
  Flink
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./other/面经/" class="nav-link">
  面经
</a></li><li class="dropdown-item"><!----> <a href="/./other/机器学习/" class="nav-link">
  机器学习
</a></li></ul></div></div><div class="nav-item"><a href="https://www.memorydrive.online" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/./" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程基础" class="dropdown-title"><span class="title">编程基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程基础" class="mobile-dropdown-title"><span class="title">编程基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/java基础语法/" class="nav-link">
  Java基础语法
</a></li><li class="dropdown-subitem"><a href="/./coding-base/" class="nav-link">
  Java基础实战
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶(选学)
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/java并发编程/java并发编程.html" class="nav-link">
  Java并发编程
</a></li><li class="dropdown-subitem"><a href="/./coding-base/" class="nav-link">
  Java网络编程
</a></li><li class="dropdown-subitem"><a href="/./coding-base/java集合/Java集合（永盛）.html" class="nav-link">
  Java集合
</a></li><li class="dropdown-subitem"><a href="/./coding-base/java虚拟机/" class="nav-link">
  Java虚拟机
</a></li></ul></li><li class="dropdown-item"><h4>
          计算机基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-subitem"><a href="/./coding-base/数据结构与算法/" class="nav-link">
  数据结构（重要）
</a></li><li class="dropdown-subitem"><a href="/./coding-base/计算机网络/计算机网络（双祥）.html" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/./coding-base/操作系统/" class="nav-link">
  操作系统
</a></li></ul></li><li class="dropdown-item"><h4>
          Python（选学）
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/Python/python基础/" class="nav-link">
  Python基础语法
</a></li><li class="dropdown-subitem"><a href="/./coding-base/Python/python库/" class="nav-link">
  Python数据科学库
</a></li></ul></li><li class="dropdown-item"><h4>
          框架（选学）
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/框架/springboot/springboot.html" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-subitem"><a href="/./coding-base/框架/flask/falsk.html" class="nav-link">
  Flask
</a></li><li class="dropdown-subitem"><a href="/./coding-base/框架/vue/flask.html" class="nav-link">
  Vue
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./database/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/./database/hbase/" class="nav-link">
  HBase
</a></li><li class="dropdown-item"><!----> <a href="/./database/clickhouse/" class="nav-link">
  ClickHouse
</a></li><li class="dropdown-item"><!----> <a href="/./database/tidb/" class="nav-link">
  TiDB
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据仓库" class="dropdown-title"><span class="title">数据仓库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据仓库" class="mobile-dropdown-title"><span class="title">数据仓库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./datahouse/大数据基础/bigdata-base.html" class="nav-link">
  大数据基础
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/离线数仓/" class="nav-link">
  离线数仓
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/实时数仓/" class="nav-link">
  实时数仓
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/广告技术/" class="nav-link">
  广告技术
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/电商业务/" class="nav-link">
  电商业务
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据框架及组件" class="dropdown-title"><span class="title">大数据框架及组件</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据框架及组件" class="mobile-dropdown-title"><span class="title">大数据框架及组件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./bigdata/hadoop/" class="nav-link">
  Hadoop
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/hive/" class="nav-link router-link-active">
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/zookeeper/" class="nav-link">
  Zookeeper
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/kafka/" class="nav-link">
  kafka
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/spark/" class="nav-link">
  Spark
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/flink/" class="nav-link">
  Flink
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./other/面经/" class="nav-link">
  面经
</a></li><li class="dropdown-item"><!----> <a href="/./other/机器学习/" class="nav-link">
  机器学习
</a></li></ul></div></div><div class="nav-item"><a href="https://www.memorydrive.online" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Hive</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./bigdata/hive/" aria-current="page" class="sidebar-link">目录</a></li><li><a href="/./bigdata/hive/Flink1.10和Hive集成一些需要注意的点.html" class="sidebar-link">Flink1.10和Hive集成一些需要注意的点</a></li><li><a href="/./bigdata/hive/Hive  4万字性能调优面试总结.html" class="sidebar-link">Hive | 4万字性能调优面试总结</a></li><li><a href="/./bigdata/hive/Hive - ORC 文件存储格式详细解析.html" class="sidebar-link">Hive - ORC 文件存储格式详细解析</a></li><li><a href="/./bigdata/hive/Hive SQL三个经典优化案例.html" class="sidebar-link">Hive SQL三个经典优化案例</a></li><li><a href="/./bigdata/hive/Hive SQL内置函数大全.html" class="sidebar-link">Hive SQL内置函数大全</a></li><li><a href="/./bigdata/hive/Hive SQL底层执行过程详细剖析.html" class="sidebar-link">Hive SQL底层执行过程详细剖析</a></li><li><a href="/./bigdata/hive/Hive 中的四种排序详解.html" class="sidebar-link">Hive 中的四种排序详解</a></li><li><a href="/./bigdata/hive/Hive 分析函数进阶指南.html" class="sidebar-link">Hive 分析函数进阶指南</a></li><li><a href="/./bigdata/hive/Hive 复杂数据类型.html" class="sidebar-link">Hive 复杂数据类型</a></li><li><a href="/./bigdata/hive/Hive 调优（童星）.html" class="sidebar-link">Hive 调优</a></li><li><a href="/./bigdata/hive/Hive 高频考点讲解.html" class="sidebar-link">Hive 高频考点讲解</a></li><li><a href="/./bigdata/hive/HiveHadoop高频面试点小集合.html" class="sidebar-link">Hive/Hadoop高频面试点小集合</a></li><li><a href="/./bigdata/hive/Hive中的count(distinct)优化.html" class="sidebar-link">Hive中的count(distinct)优化</a></li><li><a href="/./bigdata/hive/Hive优化-大表join大表优化.html" class="sidebar-link">Hive优化-大表join大表优化</a></li><li><a href="/./bigdata/hive/Hive使用必知必会系列.html" class="sidebar-link">Hive使用必知必会系列</a></li><li><a href="/./bigdata/hive/Hive全面讲解.html" class="active sidebar-link">Hive全面讲解</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/./bigdata/hive/Hive和Hbase的各自适用场景.html" class="sidebar-link">Hive和Hbase的各自适用场景</a></li><li><a href="/./bigdata/hive/Hive小文件合并与数据压缩.html" class="sidebar-link">Hive小文件合并与数据压缩</a></li><li><a href="/./bigdata/hive/Hive小知识之分桶抽样.html" class="sidebar-link">Hive小知识之分桶抽样</a></li><li><a href="/./bigdata/hive/Hive常用参数调优十二式.html" class="sidebar-link">Hive常用参数调优十二式</a></li><li><a href="/./bigdata/hive/Hive常用的函数总结.html" class="sidebar-link">Hive常用的函数总结</a></li><li><a href="/./bigdata/hive/Hive底层原理：explain执行计划详解.html" class="sidebar-link">Hive底层原理：explain执行计划详解</a></li><li><a href="/./bigdata/hive/Hive性能调优  并行执行严格模式JVM重用推测执行.html" class="sidebar-link">Hive性能调优 | 并行执行/严格模式/JVM重用/推测执行</a></li><li><a href="/./bigdata/hive/Hive性能调优  数据倾斜.html" class="sidebar-link">Hive性能调优 | 数据倾斜</a></li><li><a href="/./bigdata/hive/Hive技术原理.html" class="sidebar-link">Hive技术原理</a></li><li><a href="/./bigdata/hive/Hive窗口函数总结与实践.html" class="sidebar-link">Hive窗口函数总结与实践</a></li><li><a href="/./bigdata/hive/Hive计算绝对值同环比.html" class="sidebar-link">Hive计算绝对值同环比</a></li><li><a href="/./bigdata/hive/Hive调优全方位指南.html" class="sidebar-link">Hive调优全方位指南</a></li><li><a href="/./bigdata/hive/Impala一文详解及与Hive简单对比.html" class="sidebar-link">Impala一文详解及与Hive简单对比</a></li><li><a href="/./bigdata/hive/一文搞定Hive函数.html" class="sidebar-link">一文搞定Hive函数</a></li><li><a href="/./bigdata/hive/一篇文章了解Hive调优.html" class="sidebar-link">一篇文章了解Hive调优</a></li><li><a href="/./bigdata/hive/基于Hadoop的数据仓库Hive基础知识.html" class="sidebar-link">基于Hadoop的数据仓库Hive基础知识</a></li><li><a href="/./bigdata/hive/快手数仓Hive MetaStore挑战与优化.html" class="sidebar-link">快手数仓Hive MetaStore挑战与优化</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="hive全面讲解"><a href="#hive全面讲解" class="header-anchor">#</a> Hive全面讲解</h1> <p><strong>1 Hive</strong></p> <p>Hive 是 FaceBook 开源的一款基于 Hadoop 数据仓库工具，它可以将结构化的数据文件映射为一张表，并提供类SQL查询功能。</p> <blockquote><p>The Apache Hive ™ data warehouse software facilitates reading, writing, and managing large datasets residing in distributed storage using SQL 。</p></blockquote> <h3 id="_1-1-hive-优缺点"><a href="#_1-1-hive-优缺点" class="header-anchor">#</a> 1.1 Hive 优缺点</h3> <h5 id="_1-1-1-优点"><a href="#_1-1-1-优点" class="header-anchor">#</a> 1.1.1 优点</h5> <ol><li>操作接口采用类SQL语法，提供快速开发的能力（简单、容易上手）。</li> <li>避免了去写MapReduce，减少开发人员的学习成本。</li> <li>Hive的执行延迟比较高，因此Hive常用于数据分析，对实时性要求不高的场合。</li> <li>Hive优势在于处理大数据，对于处理小数据没有优势，因为Hive的执行延迟比较高。</li> <li>Hive支持用户自定义函数，用户可以根据自己的需求来实现自己的函数。</li></ol> <h5 id="_1-1-2-缺点"><a href="#_1-1-2-缺点" class="header-anchor">#</a> 1.1.2 缺点</h5> <ol><li>Hive 的 HQL 表达能力有限，无法表达迭代式算法，不擅长数据挖掘方面。</li> <li>Hive 的效率比较低，Hive 自动生成的 MapReduce 作业，通常情况下不够智能化。</li> <li>Hive 查询无法做到跟 MySQL 一样毫秒返回。</li></ol> <h3 id="_1-2-hive-跟-mysql-比较"><a href="#_1-2-hive-跟-mysql-比较" class="header-anchor">#</a> 1.2 Hive 跟 MySQL 比较</h3> <h5 id="_1-2-1-对比"><a href="#_1-2-1-对比" class="header-anchor">#</a> 1.2.1 对比</h5> <p>Hive 采用了类SQL 的查询语言 HQL(Hive Query Language)，因此很容易将 Hive 理解为数据库。其实从结构上来看，Hive 和数据库除了拥有类似的查询语言，再无类似之处。本文将从多个方面来阐述 Hive 和数据库的差异。数据库可以用在 Online 的应用中，但是Hive 是为数据仓库而设计的，清楚这一点，有助于从应用角度理解 Hive 的特性。</p> <table><thead><tr><th style="text-align:left;">方向</th> <th style="text-align:left;">Hive</th> <th style="text-align:left;">MySQL</th></tr></thead> <tbody><tr><td style="text-align:left;">应用方向</td> <td style="text-align:left;">数仓</td> <td style="text-align:left;">Online</td></tr> <tr><td style="text-align:left;">查询语言</td> <td style="text-align:left;">HQL</td> <td style="text-align:left;">SQL</td></tr> <tr><td style="text-align:left;">数据存储位置</td> <td style="text-align:left;">HDFS</td> <td style="text-align:left;">本地文件系统</td></tr> <tr><td style="text-align:left;">数据更新</td> <td style="text-align:left;">读多写少，无法修改</td> <td style="text-align:left;">正常CRUD</td></tr> <tr><td style="text-align:left;">索引</td> <td style="text-align:left;">无索引，暴力查询</td> <td style="text-align:left;">各种索引</td></tr> <tr><td style="text-align:left;">执行</td> <td style="text-align:left;">底层MapReduce</td> <td style="text-align:left;">自己执行引擎</td></tr> <tr><td style="text-align:left;">延迟</td> <td style="text-align:left;">高延迟</td> <td style="text-align:left;">低延迟</td></tr> <tr><td style="text-align:left;">可扩展性</td> <td style="text-align:left;">优秀扩展能力</td> <td style="text-align:left;">扩展力有限</td></tr> <tr><td style="text-align:left;">数据量</td> <td style="text-align:left;">超大规模</td> <td style="text-align:left;">小规模</td></tr></tbody></table> <h3 id="_1-2-2-hive-不支持那些"><a href="#_1-2-2-hive-不支持那些" class="header-anchor">#</a> 1.2.2 Hive 不支持那些</h3> <ol><li>支持等值查询，不支持非等值连接</li> <li>支持 and 多条件过滤，不支持 or 多条件过滤。</li> <li>不支持 update 跟 delete。</li></ol> <h3 id="_1-3-hive-底层"><a href="#_1-3-hive-底层" class="header-anchor">#</a> 1.3 Hive 底层</h3> <p>Hive 底层是 MapReduce 计算框架，Hive 只是将通读性强且容易编程的SQL语句通过 Hive 软件转换成MapReduce 程序在集群上执行，Hive 可以看做 MapReduce 客户端。操作的数据还是存储在HDFS上的，而用户定义的表结构等元信息被存储到 MySQL 上了。以前要写八股文 MapReduce 程序，现在只需要HQL查询就可！</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUIzkNGFzMg64FLrfTWrHgMAuzhuty98Jl1iaGDM68NrrlgqmAj5W6IicReoD8OEt14GSAaYU0ADEwg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">Hive整体框架</p> <ol><li>用户接口 Client</li></ol> <blockquote><p>CLI（hive shell）、JDBC/ODBC(java访问hive)、WEBUI（浏览器访问hive）</p> <ol><li>元数据 Metastore</li> <li>元数据包括 表名、表所属的数据库（默认是default）、表的拥有者、列/分区字段、表的类型（是否是外部表）、表的数据所在目录等。</li> <li>默认存储在自带的derby数据库中(单客户连接)，推荐使用MySQL存储Metastore。</li> <li>Hadoop
使用HDFS进行存储，使用MapReduce进行计算。</li></ol></blockquote> <ol><li>驱动器 Driver</li></ol> <blockquote><ol><li>解析器 SQL Parser：将SQL字符串转换成<strong>抽象语法树</strong>AST，这一步一般都用第三方工具库完成，比如antlr；对AST进行语法分析，比如表是否存在、字段是否存在、SQL语义是否有误。</li> <li>编译器 Physical Plan：将AST编译生成逻辑执行计划。</li> <li>优化器 Query Optimizer：对逻辑执行计划进行优化。</li> <li>执行器 Execution：把逻辑执行计划转换成可以运行的物理计划。对于Hive来说就是MR/Spark。</li></ol></blockquote> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUIzkNGFzMg64FLrfTWrHgMgq06r2r76sFd4HPqgCPFNXQUicibibjMLibh94Xk8mozMMqRlic5gqPnDbg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">HQL执行流程</p> <p>不要把 Hive 想的多么神秘，你可以用简单的load方式将数据加载到创建的表里，也可以直接用hadoop指令将数据放入到指定目录，这两种方式都可以直接让你通过SQL查询到数据。</p> <h3 id="_1-4-hql-底层执行举例"><a href="#_1-4-hql-底层执行举例" class="header-anchor">#</a> 1.4  HQL 底层执行举例</h3> <h5 id="_1-4-1-join"><a href="#_1-4-1-join" class="header-anchor">#</a> 1.4.1 Join</h5> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUIzkNGFzMg64FLrfTWrHgMIiaXqLHNnabYYaXsBcGlZDjGnWYrbJL81NI8QSK48ia8AkBSbZ8NEhKw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">Join流程</p> <h5 id="_1-4-2-group-by"><a href="#_1-4-2-group-by" class="header-anchor">#</a> 1.4.2 group by</h5> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUIzkNGFzMg64FLrfTWrHgMNjF1AEjV3QcLWsjAfzWpU9cjQyIOM8cVZL4lEftr4Ggyz9vCic3zhTg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">group by 流程</p> <h5 id="_1-4-3-distinct"><a href="#_1-4-3-distinct" class="header-anchor">#</a> 1.4.3 distinct</h5> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUIzkNGFzMg64FLrfTWrHgMZEbMqvODNs1CUb5cr690xFjH4wWA2U9MuzD4OMXElSU1MVyDru5HoQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">distinct 流程</p> <h1 id="_2-开窗函数"><a href="#_2-开窗函数" class="header-anchor">#</a> 2 开窗函数</h1> <p>有时想要同时显示聚集前后的数据，这时引入了窗口函数，在SQL处理中，窗口函数都是<code>最后一步执行</code>，而且仅位于 Order by 字句之前。</p> <h3 id="_2-1-数据准备"><a href="#_2-1-数据准备" class="header-anchor">#</a> 2.1  数据准备</h3> <div class="language- extra-class"><pre class="language-text"><code>name,orderdate,cost
jack,2017-01-01,10
tony,2017-01-02,15
jack,2017-02-03,23
tony,2017-01-04,29
jack,2017-01-05,46
jack,2017-04-06,42
tony,2017-01-07,50
jack,2017-01-08,55
mart,2017-04-08,62
mart,2017-04-09,68
neil,2017-05-10,12
mart,2017-04-11,75
neil,2017-06-12,80
mart,2017-04-13,94
</code></pre></div><p>建表 导数据</p> <div class="language- extra-class"><pre class="language-text"><code>create table business(
name string, 
orderdate string,
cost int
) ROW FORMAT DELIMITED FIELDS TERMINATED BY ',';
load data local inpath &quot;/opt/module/datas/business.txt&quot; into table business;
</code></pre></div><h3 id="_2-2-用法"><a href="#_2-2-用法" class="header-anchor">#</a> 2.2 用法</h3> <p>相关函数说明</p> <ol><li>OVER()：指定分析函数工作的数据窗口大小，这个数据窗口大小可能会随着行的变而变化</li> <li>CURRENT ROW：当前行</li> <li>n PRECEDING：往前 n 行数据</li> <li>n FOLLOWING：往后 n 行数据</li> <li>UNBOUNDED：起点，UNBOUNDED PRECEDING 表示从前面的起点， UNBOUNDED FOLLOWING 表示到后面的终点</li></ol> <p>上面写 over 里面，下面写 over 前面。</p> <ol><li>LAG(col,n)：往前<code>第</code> n 行数据</li> <li>LEAD(col,n)：往后<code>第</code> n 行数据</li> <li>NTILE(n)：把有序分区中的行分发到指定数据的组中，各个组有编号，编号从1开始，对于每一行，NTILE 返回此行所属的组的编号。注意：n必须为int类型。</li></ol> <h3 id="_2-3-开窗函数demo"><a href="#_2-3-开窗函数demo" class="header-anchor">#</a> 2.3 开窗函数demo</h3> <ol><li>查询在2017年4月份购买过的顾客及总人数</li></ol> <div class="language- extra-class"><pre class="language-text"><code>select name,count(*) over() from business where substring(orderdate,1,7) = '2017-04' group by name;
结果：
mart    2
jack    2
</code></pre></div><ol><li>查询顾客的购买明细及月购买总额</li></ol> <div class="language- extra-class"><pre class="language-text"><code>select name,orderdate,cost,sum(cost) over(partition by month(orderdate)) 
from business; 
解释：按照月划分数据  然后统计这个月的cost总和
jack    2017-01-01  10  205
jack    2017-01-08  55  205
tony    2017-01-07  50  205
jack    2017-01-05  46  205
tony    2017-01-04  29  205
tony    2017-01-02  15  205
jack    2017-02-03  23  23
mart    2017-04-13  94  341
jack    2017-04-06  42  341
mart    2017-04-11  75  341
mart    2017-04-09  68  341
mart    2017-04-08  62  341
neil    2017-05-10  12  12
neil    2017-06-12  80  80
</code></pre></div><ol><li>查看顾客上次的购买时间</li></ol> <div class="language- extra-class"><pre class="language-text"><code>select name,orderdate,cost, 
lag(orderdate,1,'defaulttime') over(partition by name order by orderdate ) as time1, 
lag(orderdate,2,'defaulttime') over (partition by name order by orderdate) as time2  from business;
结果 : 
姓名      日期      价格  前一天日期    前两天日期
jack    2017-01-01  10  defaulttime defaulttime
jack    2017-01-05  46  2017-01-01  defaulttime
jack    2017-01-08  55  2017-01-05  2017-01-01
jack    2017-02-03  23  2017-01-08  2017-01-05
jack    2017-04-06  42  2017-02-03  2017-01-08
mart    2017-04-08  62  defaulttime defaulttime
mart    2017-04-09  68  2017-04-08  defaulttime
mart    2017-04-11  75  2017-04-09  2017-04-08
mart    2017-04-13  94  2017-04-11  2017-04-09
neil    2017-05-10  12  defaulttime defaulttime
neil    2017-06-12  80  2017-05-10  defaulttime
tony    2017-01-02  15  defaulttime defaulttime
tony    2017-01-04  29  2017-01-02  defaulttime
tony    2017-01-07  50  2017-01-04  2017-01-02
</code></pre></div><ol><li>查询前20%时间的订单信息</li></ol> <div class="language- extra-class"><pre class="language-text"><code> select * from (
 select name,orderdate,cost, ntile(5) over(order by orderdate) sorted from business ) t where sorted = 1;
结果 : 
jack    2017-01-01  10  1
tony    2017-01-02  15  1
tony    2017-01-04  29  1
jack    2017-01-05  46  2
tony    2017-01-07  50  2
jack    2017-01-08  55  2
jack    2017-02-03  23  3
jack    2017-04-06  42  3
mart    2017-04-08  62  3
mart    2017-04-09  68  4
mart    2017-04-11  75  4
mart    2017-04-13  94  4
neil    2017-05-10  12  5
neil    2017-06-12  80  5
</code></pre></div><p><strong>以下实验均关注最后一列</strong></p> <p>\1. 所有行相加</p> <div class="language- extra-class"><pre class="language-text"><code>select name,orderdate,cost,sum(cost) over() as sample1 from business; 
结果 : 
mart    2017-04-13  94  661
neil    2017-06-12  80  661
mart    2017-04-11  75  661
neil    2017-05-10  12  661
mart    2017-04-09  68  661
</code></pre></div><p>\2. 按name分组，组内数据相加</p> <div class="language- extra-class"><pre class="language-text"><code>select name,orderdate,cost,sum(cost) over(partition by name) as sample2
from business;
结果 : 
jack    2017-01-05  46  176
jack    2017-01-08  55  176
jack    2017-01-01  10  176
jack    2017-04-06  42  176
jack    2017-02-03  23  176
...
tony    2017-01-04  29  94
tony    2017-01-02  15  94
tony    2017-01-07  50  94
</code></pre></div><p>\3. 按name分组，组内数据累加</p> <div class="language- extra-class"><pre class="language-text"><code>select name,orderdate,cost,
sum(cost) over(partition by name order by orderdate) as sample3
from business; 
跟下面类似
select name,orderdate,cost,
sum(cost) over(distribute by name sort by orderdate) as sample3 
from business; 
jack    2017-01-01  10  10
jack    2017-01-05  46  56
jack    2017-01-08  55  111
jack    2017-02-03  23  134
jack    2017-04-06  42  176
...
</code></pre></div><p>\4. 和sample3一样,由起点到当前行的聚合</p> <div class="language- extra-class"><pre class="language-text"><code>select name,orderdate,cost,
sum(cost) over(partition by name order by orderdate rows
between UNBOUNDED PRECEDING and current row ) as sample4 
from business; 
结果 : 
jack    2017-01-01  10  10
jack    2017-01-05  46  56
jack    2017-01-08  55  111
jack    2017-02-03  23  134
jack    2017-04-06  42  176
...
</code></pre></div><p>\5. 当前行和前面一行做聚合</p> <div class="language- extra-class"><pre class="language-text"><code>select name,orderdate,cost,
sum(cost) over(partition by name order by orderdate rows 
between 1 PRECEDING and current row) as sample5 
from business;
结果 : 
jack    2017-01-01  10  10
jack    2017-01-05  46  56 = 46 + 10
jack    2017-01-08  55  101 = 44 + 46
jack    2017-02-03  23  78  = 23 + 55
jack    2017-04-06  42  65  = 42 + 23
...
tony    2017-01-02  15  15
tony    2017-01-04  29  44
tony    2017-01-07  50  79
</code></pre></div><p>\6. 当前行和前边一行及后面一行</p> <div class="language- extra-class"><pre class="language-text"><code>select name,orderdate,cost,
sum(cost) over(partition by name order by orderdate rows
between 1 PRECEDING AND 1 FOLLOWING ) as sample6
from business;
结果 : 
jack    2017-01-01  10  56  = 10 + 46
jack    2017-01-05  46  111 = 46 + 10 + 55
jack    2017-01-08  55  124 = 55 + 46 + 23
jack    2017-02-03  23  120 = 23 + 55 + 42
jack    2017-04-06  42  65  = 42 + 23
...
tony    2017-01-02  15  44
tony    2017-01-04  29  94
tony    2017-01-07  50  79
</code></pre></div><p>\7. 当前行及后面所有行</p> <div class="language- extra-class"><pre class="language-text"><code>select name,orderdate,cost,sum(cost) over(partition by name order by orderdate rows between current row and UNBOUNDED FOLLOWING ) as sample7 from business;
结果 : 
jack    2017-01-01  10  176 = 10 + 46 + 55 + 23 + 42
jack    2017-01-05  46  166 = 46 + 55 + 23 + 42
jack    2017-01-08  55  120 = 55 + 23 + 42
jack    2017-02-03  23  65  =  23 + 42
jack    2017-04-06  42  42  =  42
mart    2017-04-08  62  299
mart    2017-04-09  68  237
mart    2017-04-11  75  169
mart    2017-04-13  94  94
neil    2017-05-10  12  92
neil    2017-06-12  80  80
tony    2017-01-02  15  94
tony    2017-01-04  29  79
tony    2017-01-07  50  50
</code></pre></div><h3 id="_2-4-rank"><a href="#_2-4-rank" class="header-anchor">#</a> 2.4 Rank</h3> <p>函数说明</p> <blockquote><p><strong>rank()</strong>：排序相同时会重复，总数不会变
<strong>dense_rank()</strong>：排序相同时会重复，总数会减少
<strong>row_number()</strong>：会根据顺序计算</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>select name,subject,score,
rank() over(partition by subject order by score desc) rp,
dense_rank() over(partition by subject order by score desc) drp,
row_number() over(partition by subject order by score desc) rmp
from score;
结果 : 
name   subject score    rp      drp     rmp
孙悟空   数学    95      1       1       1
宋宋    数学    86      2       2       2
婷婷    数学    85      3       3       3
大海    数学    56      4       4       4
宋宋    英语    84      1       1       1
大海    英语    84      1       1       2
婷婷    英语    78      3（跳过2）2        3
孙悟空  英语    68      4       3(总数少)  4
大海    语文    94      1       1       1
孙悟空  语文    87      2        2        2
婷婷    语文    65      3       3       3
宋宋    语文    64      4       4       4
</code></pre></div><h4 id="_2-5-行转列"><a href="#_2-5-行转列" class="header-anchor">#</a> 2.5 行转列</h4> <ol><li>CONCAT(string A, string B)：</li></ol> <blockquote><p>返回输入字符串<code>连接后</code>的结果，支持任意个输入字符串;</p> <ol><li>CONCAT_WS(separator, str1, str2,…)：
特殊形式的 CONCAT()。第一个参数剩余参数间的分隔符。分隔符可以是与剩余参数一样的字符串。如果分隔符是 NULL，返回值也将为 NULL。</li> <li>COLLECT_SET(col)：
只接受基本数据类型，主要作用是将某字段的值进行去重汇总，产生array类型字段。多行汇总成一个array类型。</li></ol></blockquote> <h3 id="_2-6-列转行"><a href="#_2-6-列转行" class="header-anchor">#</a> 2.6 列转行</h3> <ol><li>EXPLODE(col)：</li></ol> <blockquote><p>将hive一列中复杂的array或者map结构拆分成多行。</p> <ol><li>LATERAL VIEW
用法：LATERAL VIEW udtf(expression) table Alias AS columnAlias
解释：用于和split, explode等UDTF一起使用，它能够将一列数据拆成多行数据，在此基础上可以对拆分后的数据进行聚合。</li></ol></blockquote> <h1 id="_3-hive-调优"><a href="#_3-hive-调优" class="header-anchor">#</a> 3 Hive 调优</h1> <h3 id="_3-1-mapjoin"><a href="#_3-1-mapjoin" class="header-anchor">#</a> 3.1 MapJoin</h3> <p>如果不指定 MapJoin 或者不符合 MapJoin 的条件，那么 Hive 解析器会将 Join 操作转换成 Common Join，也就是在Reduce阶段完成join。容易发生数据倾斜。可以用 MapJoin 把小表全部加载到内存在map 端进行 join，避免 reducer 处理。</p> <h3 id="_3-2-行列过滤"><a href="#_3-2-行列过滤" class="header-anchor">#</a> 3.2 行列过滤</h3> <p>列处理：在SELECT时只拿需要的列，尽量使用分区过滤，少用SELECT *。
行处理：在分区剪裁中，当使用外关联时，如果将副表的过滤条件写在 Where后面，那么就会先全表关联，之后再过滤。</p> <h3 id="_3-3-合理设置map数跟reduce数"><a href="#_3-3-合理设置map数跟reduce数" class="header-anchor">#</a> 3.3 合理设置Map数跟Reduce数</h3> <h5 id="_3-3-1-map数不是越多越好"><a href="#_3-3-1-map数不是越多越好" class="header-anchor">#</a> 3.3.1  map数不是越多越好</h5> <p>如果一个任务有很多小文件（远远小于块大小128m），则每个小文件也会被当做一个块，用一个map任务来完成，而一个map任务启动和初始化的时间远远大于逻辑处理的时间，就会造成很大的资源浪费 。而且，同时可执行的map数是受限的。此时我们就应该减少map数量。</p> <h5 id="_3-3-2-reduce数不是越多越好"><a href="#_3-3-2-reduce数不是越多越好" class="header-anchor">#</a> 3.3.2 Reduce数不是越多越好</h5> <ol><li>过多的启动和初始化Reduce也会消耗时间和资源；</li> <li>有多少个Reduce，就会有多少个输出文件，如果生成了很多个小文件，那么如果这些小文件作为下一个任务的输入，则也会出现小文件过多的问题；</li> <li>Reduce个数设置考虑这两个原则：处理大数据量利用合适的Reduce数；使单个Reduce任务处理数据量大小要合适；</li></ol> <h3 id="_3-4-严格模式"><a href="#_3-4-严格模式" class="header-anchor">#</a> 3.4 严格模式</h3> <p>严格模式 strict 下会有以下特点：</p> <ol><li>对于分区表，用户不允许扫描所有分区。</li> <li>使用了order by语句的查询，要求必须使用limit语句。</li> <li>限制笛卡尔积的查询。</li></ol> <h3 id="_3-5-开启map端combiner"><a href="#_3-5-开启map端combiner" class="header-anchor">#</a> 3.5 开启map端combiner</h3> <p>在不影响最终业务逻辑前提下，手动开启 set hive.map.aggr=true；</p> <h3 id="_3-6-压缩"><a href="#_3-6-压缩" class="header-anchor">#</a> 3.6 压缩</h3> <p>设置map端输出中间结果压缩，加速网络传输。</p> <h3 id="_3-7-小文件进行合并"><a href="#_3-7-小文件进行合并" class="header-anchor">#</a> 3.7 小文件进行合并</h3> <p>在Map执行前合并小文件，减少Map数，<strong>CombineHiveInputFormat</strong> 具有对小文件进行合并的功能（系统默认的格式）。HiveInputFormat没有对小文件合并功能。</p> <h3 id="_3-8-其他"><a href="#_3-8-其他" class="header-anchor">#</a> 3.8 其他</h3> <ol><li><strong>Fetch抓取</strong>：指的是 Hive中对某些情况的查询可以不必使用MapReduce计算。</li> <li><strong>本地模式</strong>：Hive可以通过本地模式在单台机器上处理所有的任务。</li> <li><strong>数据分区</strong>：数据细化存储方便访问。</li> <li><strong>JVM重用</strong>：JVM实例在同一个job中重新使用N次。</li> <li><strong>推测执行</strong>：根据一定的法则推测出拖后腿的任务，并为这样的任务启动一个备份任务。</li> <li><strong>并行执行</strong>：一个Hive查询被分解成多个阶段，阶段之间并非完全互相依赖的。</li></ol> <h1 id="_4-hive-高频考点"><a href="#_4-hive-高频考点" class="header-anchor">#</a> 4 Hive 高频考点</h1> <h3 id="_4-1-数据倾斜"><a href="#_4-1-数据倾斜" class="header-anchor">#</a> 4.1 数据倾斜</h3> <h5 id="_4-1-1-定义"><a href="#_4-1-1-定义" class="header-anchor">#</a> 4.1.1 定义</h5> <p>数据分布不平衡，某些地方特别多，某些地方又特别少，导致的在处理数据的时候，有些很快就处理完了，而有些又迟迟未能处理完，导致整体任务最终迟迟无法完成，这种现象就是数据倾斜。</p> <h5 id="_4-1-2-产生"><a href="#_4-1-2-产生" class="header-anchor">#</a> 4.1.2 产生</h5> <ol><li>key的分布不均匀或者说某些key太集中</li> <li>业务数据自身的特性，例如不同数据类型关联产生数据倾斜</li> <li>SQL语句导致的数据倾斜</li></ol> <h5 id="_4-1-3-解决"><a href="#_4-1-3-解决" class="header-anchor">#</a> 4.1.3 解决</h5> <ol><li>不影响最终业务逻辑前提下开启map端combiner。</li> <li>开启数据倾斜时负载均衡。</li> <li>手动抽查做好分区规则。</li> <li>使用mapjoin，小表进内存 在Map端完成Reduce。</li></ol> <h3 id="_4-2-分区表和分桶表对比"><a href="#_4-2-分区表和分桶表对比" class="header-anchor">#</a> 4.2 分区表和分桶表对比？</h3> <h5 id="_4-2-1-分区表"><a href="#_4-2-1-分区表" class="header-anchor">#</a> 4.2.1 分区表</h5> <ol><li>分区使用的是<code>表外</code>字段，需要指定字段类型</li> <li>分区通过<code>关键字</code> <strong>partitioned</strong> by(partition_name string)声明</li> <li>分区划分粒度<code>较粗</code></li> <li>将数据按区域划分开，查询时不用扫描无关的数据，加快查询速度</li></ol> <h5 id="_4-2-2-分桶表"><a href="#_4-2-2-分桶表" class="header-anchor">#</a> 4.2.2 分桶表</h5> <p>分桶逻辑：对分桶字段求哈希值，用哈希值与分桶的数量取余决定数据放到哪个桶里。</p> <ol><li>分桶使用的是<code>表内</code>字段，已经知道字段类型，不需要再指定。</li> <li>分桶表通过关键字 <strong>clustered</strong> by(column_name) into … buckets声明</li> <li>分桶是<code>更细</code>粒度的划分、管理数据，可以对表进行先分区再分桶的划分策略</li> <li>优点在于用于数据取样时候能够起到优化加速的作用</li></ol> <h3 id="_4-3-动态分区"><a href="#_4-3-动态分区" class="header-anchor">#</a> 4.3 动态分区</h3> <ol><li>静态分区与动态分区的主要区别在于静态分区是手动指定，而动态分区是通过数据来进行判断。</li> <li>静态分区的列是在编译时期，通过用户传递来决定的，动态分区只有在 SQL 执行时才能决定。</li> <li>系统默认开启，非严格模式，动态分区最大值。</li></ol> <h3 id="_4-4-hive-中视图跟索引"><a href="#_4-4-hive-中视图跟索引" class="header-anchor">#</a> 4.4 Hive 中视图跟索引</h3> <h5 id="_4-4-1-视图"><a href="#_4-4-1-视图" class="header-anchor">#</a> 4.4.1 视图</h5> <p>视图是一种使用查询语句定义的虚拟表，是数据的一种逻辑结构，创建视图时不会把视图存储到磁盘上，定义视图的查询语句只有在执行视图的语句时才会被执行。视图是只读的，不能向视图中插入或是加载数据</p> <h5 id="_4-4-2-hive索引"><a href="#_4-4-2-hive索引" class="header-anchor">#</a> 4.4.2 Hive索引</h5> <p>Hive支持在表中建立索引。但是索引需要额外的存储空间，因此在创建索引时需要考虑索引的必要性。</p> <p>Hive不支持直接使用 DROP TABLE 语句删除索引表。如果创建索引的表被删除了，则其对应的索引和索引表也会被删除；如果表的某个分区被删除了，则该分区对应的分区索引也会被删除。</p> <h3 id="_4-5-sort-by、order-by、distrbute-by、cluster-by"><a href="#_4-5-sort-by、order-by、distrbute-by、cluster-by" class="header-anchor">#</a> 4.5 Sort By、Order By、Distrbute By、Cluster By</h3> <ol><li>Sort By：分区内有序</li> <li>Order By：全局排序，只有一个Reducer</li> <li>Distrbute By：类似MR中Partition，进行分区，结合sort by使用</li> <li>Cluster By：当Distribute by和Sorts by字段相同时，可以使用Cluster by方式。Cluster by 还兼具 Sort by 的功能，但只能是升序排序。</li></ol> <h3 id="_4-6-内部表-跟外部表"><a href="#_4-6-内部表-跟外部表" class="header-anchor">#</a> 4.6  内部表 跟外部表</h3> <h5 id="_4-6-1-内部表"><a href="#_4-6-1-内部表" class="header-anchor">#</a> 4.6.1 内部表</h5> <p>如果Hive中没有特别指定，则默认创建的表都是管理表，也称内部表。由Hive负责管理表中的数据，管理表不共享数据。删除管理表时，会删除管理表中的数据和元数据信息。</p> <h5 id="_4-6-2-外部表"><a href="#_4-6-2-外部表" class="header-anchor">#</a> 4.6.2 外部表</h5> <p>当一份数据需要被共享时，可以创建一个外部表指向这份数据。删除该表并不会删除掉原始数据，删除的是表的元数据。</p> <h3 id="_4-7-udf-、udaf、udtf"><a href="#_4-7-udf-、udaf、udtf" class="header-anchor">#</a> 4.7 UDF 、UDAF、UDTF</h3> <ol><li>UDF ：一进一出，类似 upper，trim</li> <li>UDAF：多进一出，聚集函数，类似 count、max、min。</li> <li>UDTF：一进多出，如 lateral view explore()</li></ol> <h3 id="_4-8-hql-如何转变为mapreduce"><a href="#_4-8-hql-如何转变为mapreduce" class="header-anchor">#</a> 4.8 HQL 如何转变为MapReduce</h3> <ol><li>Antlr定义SQL语法规则，完成SQL词法，语法解析，SQL转化为 抽象语法树 AST Tree。</li> <li>遍历AST Tree，抽象出查询的基本组成单元QueryBlock。</li> <li>遍历QueryBlock，翻译为执行操作树OperatorTree。</li> <li>逻辑层优化OperatorTree变换，合并不必要的ReduceSinkOperator，减少Shuffle数量。</li> <li>遍历OperatorTree 翻译为MapReduce任务。</li> <li>物理层优化器进行MapReduce任务变换，生成最终执行计划。</li></ol> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUIzkNGFzMg64FLrfTWrHgM9J2iaLic42gnMXicMsTLO6o83icLIhbBn6LNzbA8FIKWicyFm6XFYWibibwGg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/./bigdata/hive/Hive使用必知必会系列.html" class="prev">
        Hive使用必知必会系列
      </a></span> <span class="next"><a href="/./bigdata/hive/Hive和Hbase的各自适用场景.html">
        Hive和Hbase的各自适用场景
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="./assets/js/app.dc5b0715.js" defer></script><script src="./assets/js/2.47c06342.js" defer></script><script src="./assets/js/23.454fb1a0.js" defer></script>
  </body>
</html>
