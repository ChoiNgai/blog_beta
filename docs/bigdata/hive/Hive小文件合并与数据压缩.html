<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hive小文件合并与数据压缩 | 大数据技术文档</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="./favicon.ico">
    <meta name="description" content="从入门到入土">
    
    <link rel="preload" href="./assets/css/0.styles.2c6e287f.css" as="style"><link rel="preload" href="./assets/js/app.9ce0d262.js" as="script"><link rel="preload" href="./assets/js/2.fa5f1a4a.js" as="script"><link rel="preload" href="./assets/js/35.27a56cfa.js" as="script"><link rel="prefetch" href="./assets/js/10.6940d239.js"><link rel="prefetch" href="./assets/js/100.22cf6913.js"><link rel="prefetch" href="./assets/js/101.8a31dcdc.js"><link rel="prefetch" href="./assets/js/102.147ef11e.js"><link rel="prefetch" href="./assets/js/103.cc281f62.js"><link rel="prefetch" href="./assets/js/104.2e0465e5.js"><link rel="prefetch" href="./assets/js/105.910aa23c.js"><link rel="prefetch" href="./assets/js/106.5466141f.js"><link rel="prefetch" href="./assets/js/107.a92bd18e.js"><link rel="prefetch" href="./assets/js/108.51fca30a.js"><link rel="prefetch" href="./assets/js/109.6119ffd0.js"><link rel="prefetch" href="./assets/js/11.bd53d768.js"><link rel="prefetch" href="./assets/js/110.eda784ab.js"><link rel="prefetch" href="./assets/js/111.12c174e7.js"><link rel="prefetch" href="./assets/js/112.8f45d1d2.js"><link rel="prefetch" href="./assets/js/113.e0bb8777.js"><link rel="prefetch" href="./assets/js/114.2ffc5abc.js"><link rel="prefetch" href="./assets/js/115.264d88bb.js"><link rel="prefetch" href="./assets/js/116.43a8b13e.js"><link rel="prefetch" href="./assets/js/117.03317ae7.js"><link rel="prefetch" href="./assets/js/118.dee53adb.js"><link rel="prefetch" href="./assets/js/119.662a11fb.js"><link rel="prefetch" href="./assets/js/12.b25bd03a.js"><link rel="prefetch" href="./assets/js/120.8d1c0658.js"><link rel="prefetch" href="./assets/js/121.c866d980.js"><link rel="prefetch" href="./assets/js/122.141777da.js"><link rel="prefetch" href="./assets/js/123.64bf1df0.js"><link rel="prefetch" href="./assets/js/124.0f402852.js"><link rel="prefetch" href="./assets/js/125.adf420b6.js"><link rel="prefetch" href="./assets/js/126.5ac52ff6.js"><link rel="prefetch" href="./assets/js/127.31a2c0b9.js"><link rel="prefetch" href="./assets/js/128.ee1158fc.js"><link rel="prefetch" href="./assets/js/129.ea47f41d.js"><link rel="prefetch" href="./assets/js/13.127a8756.js"><link rel="prefetch" href="./assets/js/130.169a1c91.js"><link rel="prefetch" href="./assets/js/131.25141855.js"><link rel="prefetch" href="./assets/js/132.1961433f.js"><link rel="prefetch" href="./assets/js/133.4a4b3148.js"><link rel="prefetch" href="./assets/js/134.3cf3137b.js"><link rel="prefetch" href="./assets/js/135.25c96955.js"><link rel="prefetch" href="./assets/js/136.34bc078a.js"><link rel="prefetch" href="./assets/js/137.0d68c97e.js"><link rel="prefetch" href="./assets/js/138.06820a54.js"><link rel="prefetch" href="./assets/js/139.25951593.js"><link rel="prefetch" href="./assets/js/14.ee4f6d75.js"><link rel="prefetch" href="./assets/js/140.9631a9a0.js"><link rel="prefetch" href="./assets/js/141.7e3c7d7b.js"><link rel="prefetch" href="./assets/js/142.fc0ba6d0.js"><link rel="prefetch" href="./assets/js/143.a87cd9f4.js"><link rel="prefetch" href="./assets/js/144.b8153695.js"><link rel="prefetch" href="./assets/js/145.5bb910bf.js"><link rel="prefetch" href="./assets/js/146.48346688.js"><link rel="prefetch" href="./assets/js/147.14fdd265.js"><link rel="prefetch" href="./assets/js/148.910c7bb0.js"><link rel="prefetch" href="./assets/js/149.17e89273.js"><link rel="prefetch" href="./assets/js/15.4c07895d.js"><link rel="prefetch" href="./assets/js/150.c09b3d84.js"><link rel="prefetch" href="./assets/js/151.1c6f270e.js"><link rel="prefetch" href="./assets/js/152.14fbeaa5.js"><link rel="prefetch" href="./assets/js/153.2452da0e.js"><link rel="prefetch" href="./assets/js/154.b4df1979.js"><link rel="prefetch" href="./assets/js/155.22d7abd8.js"><link rel="prefetch" href="./assets/js/156.2f9a9ccc.js"><link rel="prefetch" href="./assets/js/157.969faec2.js"><link rel="prefetch" href="./assets/js/158.3500ec52.js"><link rel="prefetch" href="./assets/js/159.e527d9a4.js"><link rel="prefetch" href="./assets/js/16.c4323435.js"><link rel="prefetch" href="./assets/js/160.e9019d68.js"><link rel="prefetch" href="./assets/js/161.85c34333.js"><link rel="prefetch" href="./assets/js/162.a46ae7b7.js"><link rel="prefetch" href="./assets/js/163.7be9bd8c.js"><link rel="prefetch" href="./assets/js/164.0c6811d8.js"><link rel="prefetch" href="./assets/js/165.57bd5bac.js"><link rel="prefetch" href="./assets/js/166.afa88f4a.js"><link rel="prefetch" href="./assets/js/167.29d4d5ce.js"><link rel="prefetch" href="./assets/js/168.e653cd83.js"><link rel="prefetch" href="./assets/js/169.e6f17762.js"><link rel="prefetch" href="./assets/js/17.505c5524.js"><link rel="prefetch" href="./assets/js/170.ef23a402.js"><link rel="prefetch" href="./assets/js/171.cad09bfd.js"><link rel="prefetch" href="./assets/js/172.70b28875.js"><link rel="prefetch" href="./assets/js/173.bd26a56b.js"><link rel="prefetch" href="./assets/js/174.eb342099.js"><link rel="prefetch" href="./assets/js/175.e65fe97d.js"><link rel="prefetch" href="./assets/js/176.991a568d.js"><link rel="prefetch" href="./assets/js/177.14728a0e.js"><link rel="prefetch" href="./assets/js/178.dd08b87f.js"><link rel="prefetch" href="./assets/js/179.35f52dd6.js"><link rel="prefetch" href="./assets/js/18.a3c1984e.js"><link rel="prefetch" href="./assets/js/180.fce6e839.js"><link rel="prefetch" href="./assets/js/181.344642d1.js"><link rel="prefetch" href="./assets/js/182.cb6d50af.js"><link rel="prefetch" href="./assets/js/183.18ccb5d5.js"><link rel="prefetch" href="./assets/js/184.7a48514f.js"><link rel="prefetch" href="./assets/js/19.e0fa9e47.js"><link rel="prefetch" href="./assets/js/20.da04fed8.js"><link rel="prefetch" href="./assets/js/21.039b78b5.js"><link rel="prefetch" href="./assets/js/22.91b1dd94.js"><link rel="prefetch" href="./assets/js/23.f70b01e1.js"><link rel="prefetch" href="./assets/js/24.bf935b15.js"><link rel="prefetch" href="./assets/js/25.740be3c8.js"><link rel="prefetch" href="./assets/js/26.f310e9df.js"><link rel="prefetch" href="./assets/js/27.0650d6da.js"><link rel="prefetch" href="./assets/js/28.30bd72ee.js"><link rel="prefetch" href="./assets/js/29.765dccf5.js"><link rel="prefetch" href="./assets/js/3.aa27e9f3.js"><link rel="prefetch" href="./assets/js/30.0484ae09.js"><link rel="prefetch" href="./assets/js/31.e09e1f25.js"><link rel="prefetch" href="./assets/js/32.9048892a.js"><link rel="prefetch" href="./assets/js/33.47a85736.js"><link rel="prefetch" href="./assets/js/34.162be571.js"><link rel="prefetch" href="./assets/js/36.e2b24ea4.js"><link rel="prefetch" href="./assets/js/37.660e2ae2.js"><link rel="prefetch" href="./assets/js/38.e115bc82.js"><link rel="prefetch" href="./assets/js/39.786d0e1f.js"><link rel="prefetch" href="./assets/js/4.dac57b37.js"><link rel="prefetch" href="./assets/js/40.1034d892.js"><link rel="prefetch" href="./assets/js/41.2952b19a.js"><link rel="prefetch" href="./assets/js/42.75753f7b.js"><link rel="prefetch" href="./assets/js/43.af07ba27.js"><link rel="prefetch" href="./assets/js/44.c64a1c19.js"><link rel="prefetch" href="./assets/js/45.a3f07fbe.js"><link rel="prefetch" href="./assets/js/46.cde01b57.js"><link rel="prefetch" href="./assets/js/47.ca2de71c.js"><link rel="prefetch" href="./assets/js/48.264c1471.js"><link rel="prefetch" href="./assets/js/49.733bd546.js"><link rel="prefetch" href="./assets/js/5.6ca2ea8d.js"><link rel="prefetch" href="./assets/js/50.7b9d16c8.js"><link rel="prefetch" href="./assets/js/51.f427baa6.js"><link rel="prefetch" href="./assets/js/52.112ba3d3.js"><link rel="prefetch" href="./assets/js/53.bc7a9bfd.js"><link rel="prefetch" href="./assets/js/54.258fa5ae.js"><link rel="prefetch" href="./assets/js/55.00d67ca6.js"><link rel="prefetch" href="./assets/js/56.ea8c85f2.js"><link rel="prefetch" href="./assets/js/57.8263a106.js"><link rel="prefetch" href="./assets/js/58.e0b33df6.js"><link rel="prefetch" href="./assets/js/59.4d5f847f.js"><link rel="prefetch" href="./assets/js/6.a67b19a4.js"><link rel="prefetch" href="./assets/js/60.d3638a19.js"><link rel="prefetch" href="./assets/js/61.33bd82a8.js"><link rel="prefetch" href="./assets/js/62.6287fa56.js"><link rel="prefetch" href="./assets/js/63.f043aec3.js"><link rel="prefetch" href="./assets/js/64.fd61b3bb.js"><link rel="prefetch" href="./assets/js/65.088db422.js"><link rel="prefetch" href="./assets/js/66.fa850071.js"><link rel="prefetch" href="./assets/js/67.6f9263db.js"><link rel="prefetch" href="./assets/js/68.a40fea6a.js"><link rel="prefetch" href="./assets/js/69.82a38b9c.js"><link rel="prefetch" href="./assets/js/7.130b2290.js"><link rel="prefetch" href="./assets/js/70.78387c60.js"><link rel="prefetch" href="./assets/js/71.c8bafdac.js"><link rel="prefetch" href="./assets/js/72.f6af738e.js"><link rel="prefetch" href="./assets/js/73.483631aa.js"><link rel="prefetch" href="./assets/js/74.7a295ce2.js"><link rel="prefetch" href="./assets/js/75.4ee52419.js"><link rel="prefetch" href="./assets/js/76.bfa2477e.js"><link rel="prefetch" href="./assets/js/77.36dbbf31.js"><link rel="prefetch" href="./assets/js/78.99a9055a.js"><link rel="prefetch" href="./assets/js/79.cf91068c.js"><link rel="prefetch" href="./assets/js/8.e81bc496.js"><link rel="prefetch" href="./assets/js/80.5091cf53.js"><link rel="prefetch" href="./assets/js/81.1ab1ac83.js"><link rel="prefetch" href="./assets/js/82.075a98b9.js"><link rel="prefetch" href="./assets/js/83.f6479725.js"><link rel="prefetch" href="./assets/js/84.36b72a58.js"><link rel="prefetch" href="./assets/js/85.5a115a90.js"><link rel="prefetch" href="./assets/js/86.e2e2bc5e.js"><link rel="prefetch" href="./assets/js/87.7498c4d7.js"><link rel="prefetch" href="./assets/js/88.424c69e2.js"><link rel="prefetch" href="./assets/js/89.5997766e.js"><link rel="prefetch" href="./assets/js/9.7d490254.js"><link rel="prefetch" href="./assets/js/90.ba4d2a78.js"><link rel="prefetch" href="./assets/js/91.920a9ee1.js"><link rel="prefetch" href="./assets/js/92.7903dbd3.js"><link rel="prefetch" href="./assets/js/93.e120bbac.js"><link rel="prefetch" href="./assets/js/94.cddc34d7.js"><link rel="prefetch" href="./assets/js/95.0a7a80fe.js"><link rel="prefetch" href="./assets/js/96.26590fe7.js"><link rel="prefetch" href="./assets/js/97.91bdc308.js"><link rel="prefetch" href="./assets/js/98.9a1146d2.js"><link rel="prefetch" href="./assets/js/99.d5e87370.js">
    <link rel="stylesheet" href="./assets/css/0.styles.2c6e287f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/./" class="home-link router-link-active"><!----> <span class="site-name">大数据技术文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/./" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程基础" class="dropdown-title"><span class="title">编程基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程基础" class="mobile-dropdown-title"><span class="title">编程基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/java基础语法/" class="nav-link">
  Java基础语法
</a></li><li class="dropdown-subitem"><a href="/./coding-base/" class="nav-link">
  Java基础实战
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶(选学)
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/java并发编程/java并发编程.html" class="nav-link">
  Java并发编程
</a></li><li class="dropdown-subitem"><a href="/./coding-base/" class="nav-link">
  Java网络编程
</a></li><li class="dropdown-subitem"><a href="/./coding-base/java集合/Java集合（永盛）.html" class="nav-link">
  Java集合
</a></li><li class="dropdown-subitem"><a href="/./coding-base/java虚拟机/" class="nav-link">
  Java虚拟机
</a></li></ul></li><li class="dropdown-item"><h4>
          计算机基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-subitem"><a href="/./coding-base/数据结构与算法/" class="nav-link">
  数据结构（重要）
</a></li><li class="dropdown-subitem"><a href="/./coding-base/计算机网络/计算机网络（双祥）.html" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/./coding-base/操作系统/" class="nav-link">
  操作系统
</a></li></ul></li><li class="dropdown-item"><h4>
          Python（选学）
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/Python/python基础/" class="nav-link">
  Python基础语法
</a></li><li class="dropdown-subitem"><a href="/./coding-base/Python/python库/" class="nav-link">
  Python数据科学库
</a></li></ul></li><li class="dropdown-item"><h4>
          框架（选学）
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/框架/sprin系列/" class="nav-link">
  Spring系列
</a></li><li class="dropdown-subitem"><a href="/./coding-base/框架/flask/falsk.html" class="nav-link">
  Flask
</a></li><li class="dropdown-subitem"><a href="/./coding-base/框架/vue/flask.html" class="nav-link">
  Vue
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./database/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/./database/hbase/" class="nav-link">
  HBase
</a></li><li class="dropdown-item"><!----> <a href="/./database/tidb/" class="nav-link">
  TiDB
</a></li><li class="dropdown-item"><!----> <a href="/./database/clickhouse/" class="nav-link">
  ClickHouse
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据仓库" class="dropdown-title"><span class="title">数据仓库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据仓库" class="mobile-dropdown-title"><span class="title">数据仓库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./datahouse/sql/" class="nav-link">
  SQL
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/大数据基础/bigdata-base.html" class="nav-link">
  大数据基础
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/离线数仓/" class="nav-link">
  离线数仓
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/实时数仓/" class="nav-link">
  实时数仓
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/商业化技术/" class="nav-link">
  商业化技术
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/电商业务/" class="nav-link">
  电商业务
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据框架及组件" class="dropdown-title"><span class="title">大数据框架及组件</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据框架及组件" class="mobile-dropdown-title"><span class="title">大数据框架及组件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./bigdata/hadoop/" class="nav-link">
  Hadoop
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/hive/" class="nav-link router-link-active">
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/zookeeper/" class="nav-link">
  Zookeeper
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/kafka/" class="nav-link">
  kafka
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/spark/" class="nav-link">
  Spark
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/flink/" class="nav-link">
  Flink
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/sqoop/Sqoop入门.html" class="nav-link">
  Sqoop
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/presto/Presto入门.html" class="nav-link">
  Presto
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/kylin/" class="nav-link">
  Kylin
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/Druid/Druid入门.html" class="nav-link">
  Druid
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/elasticsearch/ElasticSearch入门.html" class="nav-link">
  ElasticSearch
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./other/面经/" class="nav-link">
  面经
</a></li><li class="dropdown-item"><!----> <a href="/./other/机器学习/" class="nav-link">
  机器学习
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/./" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程基础" class="dropdown-title"><span class="title">编程基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程基础" class="mobile-dropdown-title"><span class="title">编程基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/java基础语法/" class="nav-link">
  Java基础语法
</a></li><li class="dropdown-subitem"><a href="/./coding-base/" class="nav-link">
  Java基础实战
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶(选学)
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/java并发编程/java并发编程.html" class="nav-link">
  Java并发编程
</a></li><li class="dropdown-subitem"><a href="/./coding-base/" class="nav-link">
  Java网络编程
</a></li><li class="dropdown-subitem"><a href="/./coding-base/java集合/Java集合（永盛）.html" class="nav-link">
  Java集合
</a></li><li class="dropdown-subitem"><a href="/./coding-base/java虚拟机/" class="nav-link">
  Java虚拟机
</a></li></ul></li><li class="dropdown-item"><h4>
          计算机基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-subitem"><a href="/./coding-base/数据结构与算法/" class="nav-link">
  数据结构（重要）
</a></li><li class="dropdown-subitem"><a href="/./coding-base/计算机网络/计算机网络（双祥）.html" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/./coding-base/操作系统/" class="nav-link">
  操作系统
</a></li></ul></li><li class="dropdown-item"><h4>
          Python（选学）
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/Python/python基础/" class="nav-link">
  Python基础语法
</a></li><li class="dropdown-subitem"><a href="/./coding-base/Python/python库/" class="nav-link">
  Python数据科学库
</a></li></ul></li><li class="dropdown-item"><h4>
          框架（选学）
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/框架/sprin系列/" class="nav-link">
  Spring系列
</a></li><li class="dropdown-subitem"><a href="/./coding-base/框架/flask/falsk.html" class="nav-link">
  Flask
</a></li><li class="dropdown-subitem"><a href="/./coding-base/框架/vue/flask.html" class="nav-link">
  Vue
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./database/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/./database/hbase/" class="nav-link">
  HBase
</a></li><li class="dropdown-item"><!----> <a href="/./database/tidb/" class="nav-link">
  TiDB
</a></li><li class="dropdown-item"><!----> <a href="/./database/clickhouse/" class="nav-link">
  ClickHouse
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据仓库" class="dropdown-title"><span class="title">数据仓库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据仓库" class="mobile-dropdown-title"><span class="title">数据仓库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./datahouse/sql/" class="nav-link">
  SQL
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/大数据基础/bigdata-base.html" class="nav-link">
  大数据基础
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/离线数仓/" class="nav-link">
  离线数仓
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/实时数仓/" class="nav-link">
  实时数仓
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/商业化技术/" class="nav-link">
  商业化技术
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/电商业务/" class="nav-link">
  电商业务
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据框架及组件" class="dropdown-title"><span class="title">大数据框架及组件</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据框架及组件" class="mobile-dropdown-title"><span class="title">大数据框架及组件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./bigdata/hadoop/" class="nav-link">
  Hadoop
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/hive/" class="nav-link router-link-active">
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/zookeeper/" class="nav-link">
  Zookeeper
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/kafka/" class="nav-link">
  kafka
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/spark/" class="nav-link">
  Spark
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/flink/" class="nav-link">
  Flink
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/sqoop/Sqoop入门.html" class="nav-link">
  Sqoop
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/presto/Presto入门.html" class="nav-link">
  Presto
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/kylin/" class="nav-link">
  Kylin
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/Druid/Druid入门.html" class="nav-link">
  Druid
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/elasticsearch/ElasticSearch入门.html" class="nav-link">
  ElasticSearch
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./other/面经/" class="nav-link">
  面经
</a></li><li class="dropdown-item"><!----> <a href="/./other/机器学习/" class="nav-link">
  机器学习
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Hive</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./bigdata/hive/" aria-current="page" class="sidebar-link">目录</a></li><li><a href="/./bigdata/hive/Hive全面讲解.html" class="sidebar-link">Hive全面讲解</a></li><li><a href="/./bigdata/hive/Hive 调优（童星）.html" class="sidebar-link">Hive 调优</a></li><li><a href="/./bigdata/hive/HIVE小文件过多问题.html" class="sidebar-link">HIVE小文件过多问题</a></li><li><a href="/./bigdata/hive/Hive  4万字性能调优面试总结.html" class="sidebar-link">Hive | 4万字性能调优面试总结</a></li><li><a href="/./bigdata/hive/Hive - ORC 文件存储格式详细解析.html" class="sidebar-link">Hive - ORC 文件存储格式详细解析</a></li><li><a href="/./bigdata/hive/Hive SQL三个经典优化案例.html" class="sidebar-link">Hive SQL三个经典优化案例</a></li><li><a href="/./bigdata/hive/Hive SQL内置函数大全.html" class="sidebar-link">Hive SQL内置函数大全</a></li><li><a href="/./bigdata/hive/Hive SQL底层执行过程详细剖析.html" class="sidebar-link">Hive SQL底层执行过程详细剖析</a></li><li><a href="/./bigdata/hive/Hive 中的四种排序详解.html" class="sidebar-link">Hive 中的四种排序详解</a></li><li><a href="/./bigdata/hive/Hive 分析函数进阶指南.html" class="sidebar-link">Hive 分析函数进阶指南</a></li><li><a href="/./bigdata/hive/Hive 复杂数据类型.html" class="sidebar-link">Hive 复杂数据类型</a></li><li><a href="/./bigdata/hive/Hive 高频考点讲解.html" class="sidebar-link">Hive 高频考点讲解</a></li><li><a href="/./bigdata/hive/HiveHadoop高频面试点小集合.html" class="sidebar-link">Hive/Hadoop高频面试点小集合</a></li><li><a href="/./bigdata/hive/Hive中的count(distinct)优化.html" class="sidebar-link">Hive中的count(distinct)优化</a></li><li><a href="/./bigdata/hive/Hive优化-大表join大表优化.html" class="sidebar-link">Hive优化-大表join大表优化</a></li><li><a href="/./bigdata/hive/Hive使用必知必会系列.html" class="sidebar-link">Hive使用必知必会系列</a></li><li><a href="/./bigdata/hive/Hive和Flink1.10集成一些需要注意的点.html" class="sidebar-link">Flink1.10和Hive集成一些需要注意的点</a></li><li><a href="/./bigdata/hive/Hive和Hbase的各自适用场景.html" class="sidebar-link">Hive和Hbase的各自适用场景</a></li><li><a href="/./bigdata/hive/Hive小文件合并与数据压缩.html" class="active sidebar-link">Hive小文件合并与数据压缩</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./bigdata/hive/Hive小文件合并与数据压缩.html#hive小文件合并与数据压缩" class="sidebar-link">Hive小文件合并与数据压缩</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./bigdata/hive/Hive小文件合并与数据压缩.html#一、小文件带来的问题" class="sidebar-link">一、小文件带来的问题</a></li><li class="sidebar-sub-header"><a href="/./bigdata/hive/Hive小文件合并与数据压缩.html#二、hive小文件产生的原因" class="sidebar-link">二、Hive小文件产生的原因</a></li><li class="sidebar-sub-header"><a href="/./bigdata/hive/Hive小文件合并与数据压缩.html#三、配置map输入合并" class="sidebar-link">三、配置Map输入合并</a></li><li class="sidebar-sub-header"><a href="/./bigdata/hive/Hive小文件合并与数据压缩.html#四、配置hive结果合并" class="sidebar-link">四、配置hive结果合并</a></li><li class="sidebar-sub-header"><a href="/./bigdata/hive/Hive小文件合并与数据压缩.html#五、压缩文件的处理" class="sidebar-link">五、压缩文件的处理</a></li><li class="sidebar-sub-header"><a href="/./bigdata/hive/Hive小文件合并与数据压缩.html#六、使用har归档文件" class="sidebar-link">六、使用HAR归档文件</a></li><li class="sidebar-sub-header"><a href="/./bigdata/hive/Hive小文件合并与数据压缩.html#文件压缩" class="sidebar-link">文件压缩</a></li><li class="sidebar-sub-header"><a href="/./bigdata/hive/Hive小文件合并与数据压缩.html#textfile" class="sidebar-link">TextFile</a></li><li class="sidebar-sub-header"><a href="/./bigdata/hive/Hive小文件合并与数据压缩.html#sequencefile文件" class="sidebar-link">SequenceFile文件</a></li><li class="sidebar-sub-header"><a href="/./bigdata/hive/Hive小文件合并与数据压缩.html#rcfile" class="sidebar-link">RcFile</a></li><li class="sidebar-sub-header"><a href="/./bigdata/hive/Hive小文件合并与数据压缩.html#orcfile" class="sidebar-link">ORCFile</a></li><li class="sidebar-sub-header"><a href="/./bigdata/hive/Hive小文件合并与数据压缩.html#parquet" class="sidebar-link">Parquet</a></li><li class="sidebar-sub-header"><a href="/./bigdata/hive/Hive小文件合并与数据压缩.html#avro" class="sidebar-link">Avro</a></li><li class="sidebar-sub-header"><a href="/./bigdata/hive/Hive小文件合并与数据压缩.html#不同压缩算法比较" class="sidebar-link">不同压缩算法比较</a></li><li class="sidebar-sub-header"><a href="/./bigdata/hive/Hive小文件合并与数据压缩.html#数仓表分区优化" class="sidebar-link">数仓表分区优化</a></li></ul></li></ul></li><li><a href="/./bigdata/hive/Hive小知识之分桶抽样.html" class="sidebar-link">Hive小知识之分桶抽样</a></li><li><a href="/./bigdata/hive/Hive常用参数调优十二式.html" class="sidebar-link">Hive常用参数调优十二式</a></li><li><a href="/./bigdata/hive/Hive常用的函数总结.html" class="sidebar-link">Hive常用的函数总结</a></li><li><a href="/./bigdata/hive/Hive底层原理：explain执行计划详解.html" class="sidebar-link">Hive底层原理：explain执行计划详解</a></li><li><a href="/./bigdata/hive/Hive性能调优  并行执行严格模式JVM重用推测执行.html" class="sidebar-link">Hive性能调优 | 并行执行/严格模式/JVM重用/推测执行</a></li><li><a href="/./bigdata/hive/Hive性能调优  数据倾斜.html" class="sidebar-link">Hive性能调优 | 数据倾斜</a></li><li><a href="/./bigdata/hive/Hive技术原理.html" class="sidebar-link">Hive技术原理</a></li><li><a href="/./bigdata/hive/Hive查询的18种方式.html" class="sidebar-link">Hive查询的十八种方式</a></li><li><a href="/./bigdata/hive/Hive窗口函数总结与实践.html" class="sidebar-link">Hive窗口函数总结与实践</a></li><li><a href="/./bigdata/hive/Hive计算绝对值同环比.html" class="sidebar-link">Hive计算绝对值同环比</a></li><li><a href="/./bigdata/hive/Hive调优全方位指南.html" class="sidebar-link">Hive调优全方位指南</a></li><li><a href="/./bigdata/hive/Impala一文详解及与Hive简单对比.html" class="sidebar-link">Impala一文详解及与Hive简单对比</a></li><li><a href="/./bigdata/hive/一文搞定Hive函数.html" class="sidebar-link">一文搞定Hive函数</a></li><li><a href="/./bigdata/hive/一篇文章了解Hive调优.html" class="sidebar-link">一篇文章了解Hive调优</a></li><li><a href="/./bigdata/hive/基于Hadoop的数据仓库Hive基础知识.html" class="sidebar-link">基于Hadoop的数据仓库Hive基础知识</a></li><li><a href="/./bigdata/hive/快手数仓Hive MetaStore挑战与优化.html" class="sidebar-link">快手数仓Hive MetaStore挑战与优化</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="hive小文件合并与数据压缩"><a href="#hive小文件合并与数据压缩" class="header-anchor">#</a> Hive小文件合并与数据压缩</h2> <p>Hive仓库表数据最终是存储在HDFS上，由于Hadoop的特性，对大文件的处理非常高效。而且大文件可以减少文件元数据信息，减轻NameNode的存储压力。但是在数据仓库中，越是上层的表汇总程度就越高，数据量也就越小，而且这些表通常会有日期分区，随着时间的推移，HDFS的文件数目就会逐步增加。</p> <h3 id="一、小文件带来的问题"><a href="#一、小文件带来的问题" class="header-anchor">#</a> 一、小文件带来的问题</h3> <p>HDFS的文件包好数据块和元信息，其中元信息包括位置、大小、分块等信息，都保存在NameNode的内存中。每个对象大约占用150个字节，因此一千万文件及分块就会占用约3G的内存空间，一旦接近这个量级，NameNode的性能就会开始下降。HDFS读写小文件时也会更加耗时，因为每次都需要从NameNode获取元信息，并且对应的DataNode建立连接。对于MapReduce程序来说，小文件会增加Mapper的数量，每个Map任务只会处理很少的数据，浪费大量的调度时间。</p> <h3 id="二、hive小文件产生的原因"><a href="#二、hive小文件产生的原因" class="header-anchor">#</a> 二、Hive小文件产生的原因</h3> <p>一方面hive数据仓库中汇总表的数据量通常比源数据少的多，而且为了提升运算速度，我们会增加Reduce的数量，Hive本身也会做类似的优化----Reducer数量等于源数据的量除以hive.exec.reducers.bytes.per.reduce所配置的量(默认1G)。Reduce数量的增加也即意味着结果文件的增加，从而产生小文件的问题。</p> <p>解决小文件的问题可以从两个方向入手：</p> <p>•输入合并。即在map前合并小文件。•输出合并。即在输出结果的时候合并小文件。</p> <h3 id="三、配置map输入合并"><a href="#三、配置map输入合并" class="header-anchor">#</a> 三、配置Map输入合并</h3> <div class="language- extra-class"><pre class="language-text"><code>-- 每个Map最大输入大小，决定合并后的文件数
set mapred.max.split.size=256000000;
-- 一个节点上split的至少的大小 ，决定了多个data node上的文件是否需要合并
set mapred.min.split.size.per.node=100000000;
-- 一个交换机下split的至少的大小，决定了多个交换机上的文件是否需要合并
set mapred.min.split.size.per.rack=100000000;
-- 执行Map前进行小文件合并
set hive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat;
</code></pre></div><h3 id="四、配置hive结果合并"><a href="#四、配置hive结果合并" class="header-anchor">#</a> 四、配置hive结果合并</h3> <p>通过设置hive的配置项在执行结束后对结果文件进行合并：</p> <div class="language- extra-class"><pre class="language-text"><code>set hive.merge.mapfiles = true #在Map-only的任务结束时合并小文件
set hive.merge.mapredfiles = true #在Map-Reduce的任务结束时合并小文件
set hive.merge.size.per.task = 256*1000*1000 #合并文件的大小
set hive.merge.smallfiles.avgsize=16000000 #当输出文件的平均大小小于该值时，启动一个独立的map-reduce任务进行文件merge
</code></pre></div><p>hive在对结果文件进行合并时会执行一个额外的map-only脚本，mapper的数量是文件总大小除以size.per.task参数所得的值，触发合并的条件是：根据查询类型不同，相应的mapfiles/mapredfiles参数需要打开；结果文件的平均大小需要大于avgsize参数的值。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- map-red job，5个reducer，产生5个60K的文件。</span>
createtable dw_stage<span class="token punctuation">.</span>zj_small <span class="token keyword">as</span>
<span class="token keyword">select</span> paid<span class="token punctuation">,</span> <span class="token function">count</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> dw_db<span class="token punctuation">.</span>dw_soj_imp_dtl
wherelog_dt <span class="token operator">=</span> <span class="token string">'2014-04-14'</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> paid<span class="token punctuation">;</span>
<span class="token comment">-- 执行额外的map-only job，一个mapper，产生一个300K的文件。</span>
<span class="token keyword">set</span> hive<span class="token punctuation">.</span><span class="token keyword">merge</span><span class="token punctuation">.</span>mapredfiles<span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
createtable dw_stage<span class="token punctuation">.</span>zj_small <span class="token keyword">as</span>
<span class="token keyword">select</span> paid<span class="token punctuation">,</span> <span class="token function">count</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> dw_db<span class="token punctuation">.</span>dw_soj_imp_dtl
wherelog_dt <span class="token operator">=</span> <span class="token string">'2014-04-14'</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> paid<span class="token punctuation">;</span>
<span class="token comment">-- map-only job，45个mapper，产生45个25M左右的文件。</span>
createtable dw_stage<span class="token punctuation">.</span>zj_small <span class="token keyword">as</span>
<span class="token keyword">select</span> <span class="token operator">*</span>
<span class="token keyword">from</span> dw_db<span class="token punctuation">.</span>dw_soj_imp_dtl
wherelog_dt <span class="token operator">=</span> <span class="token string">'2014-04-14'</span>
<span class="token operator">and</span> paid <span class="token operator">like</span> <span class="token string">'%baidu%'</span> <span class="token punctuation">;</span>
<span class="token comment">-- 执行额外的map-only job，4个mapper，产生4个250M左右的文件。</span>
<span class="token keyword">set</span> hive<span class="token punctuation">.</span><span class="token keyword">merge</span><span class="token punctuation">.</span>smallfiles<span class="token punctuation">.</span>avgsize<span class="token operator">=</span><span class="token number">100000000</span><span class="token punctuation">;</span>
createtable dw_stage<span class="token punctuation">.</span>zj_small <span class="token keyword">as</span>
<span class="token keyword">select</span> <span class="token operator">*</span>
<span class="token keyword">from</span> dw_db<span class="token punctuation">.</span>dw_soj_imp_dtl
wherelog_dt <span class="token operator">=</span> <span class="token string">'2014-04-14'</span>
<span class="token operator">and</span> paid <span class="token operator">like</span> <span class="token string">'%baidu%'</span> <span class="token punctuation">;</span>
</code></pre></div><h3 id="五、压缩文件的处理"><a href="#五、压缩文件的处理" class="header-anchor">#</a> 五、压缩文件的处理</h3> <p>对于输出结果为压缩文件形式存储的情况，要解决小文件问题，如果在map输入前合并，对输出的文件存储格式并没有限制。但是如果使用输出合并，则必须配合SequenceFile来存储，否则无法进行合并，以下是实例：</p> <div class="language- extra-class"><pre class="language-text"><code>set mapred.output.compression.type=BLOCK;
set hive.exec.compress.output= true;
set mapred.output.compression.codec=org.apache.hadoop.io.compress.LzoCodec;
set hive.merge.smallfiles.avgsize=100000000;
droptableifexists dw_stage.zj_small;
createtable dw_stage.zj_small
STORED AS SEQUENCEFILE
asselect *
from dw_db.dw_soj_imp_dtl
wherelog_dt = '2014-04-14'
and paid like '%baidu%' ;
</code></pre></div><h3 id="六、使用har归档文件"><a href="#六、使用har归档文件" class="header-anchor">#</a> 六、使用HAR归档文件</h3> <p>Hadoop的归档文件格式也是解决小文件问题的方式之一。而且hive提供了原生支持：</p> <div class="language- extra-class"><pre class="language-text"><code>set hive.archive.enabled= true;
set hive.archive.har.parentdir.settable= true;
set har.partfile.size=1099511627776;
ALTERTABLE srcpart ARCHIVEPARTITION(ds= '2008-04-08', hr= '12' );
ALTERTABLE srcpart UNARCHIVE PARTITION(ds= '2008-04-08', hr= '12' );
</code></pre></div><p>如果使用的不是分区表，则可以创建成外部表，并使用har://协议来指定路径。</p> <h3 id="文件压缩"><a href="#文件压缩" class="header-anchor">#</a> 文件压缩</h3> <p>数据仓库在建设使用的过程中，主要消耗的资源包含：CPU、MEMORY、DISK三部分。</p> <p>数据仓库在计算过程中主要消耗CPU和Memory资源，当然也会消耗一些DISK资源用来存储计算过程中的临时结果。但是主要优化的方向，还是降低CPU和MEMORY的消耗，这方面主要依赖于模型设计的合理性，所以在模型设计阶段增加模型设计review的步骤，保证模型设计的合理性。</p> <p>数据仓库在数据的存储阶段主要消耗MEMORY和DISK资源。memory资源主要是在NameNode存储文件信息的时候消耗掉；DISK在存储数据的时候消耗掉。在这个阶段需要严格控制HIVE表的的定义，来降低资源的消耗。</p> <p>本次主要探讨是数据仓库在数据存储阶段对资源消耗的优化，下面将通过2个方面展开，分别是：数据仓库如何配置，可以实现数据压缩，降低数据的存储量，达到减少对DISK的消耗；数仓表如何设计，可以降低文件信息存储量，达到减少对MEMORY的消耗。</p> <p>hive在存储数据时支持通过不同的文件类型来组织，并且为了节省相应的存储资源，也提供了多种类型的压缩算法，供用户选择。只要是配置正确的文件类型和压缩类型，hive都可以按预期读取并解析数据，不影响上层HQL语句的使用。例如：SequenceFile本身的结构已经设计了对内容进行压缩，所以对于SequenceFile文件的压缩，并不是先生成SequenceFile文件，再对文件进行压缩；而是生成SequenceFile文件时，就对其中的内容字段进行压缩。最终压缩后，对外仍然体现为一个SequenceFile。RCFile、ORCFile、Parquet、Avro对于压缩的处理方式与SequenceFile相同。</p> <p>hive支持的文件类型有：TextFile、SequenceFile、RCFile、ORCFile、Parquet、Avro。</p> <p>hive支持的压缩算法有：</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2PDYW1H9ZcwnwM2B86BxqS42wE7WD26dtNs315sVDLYmKib16jgMW6VpkqiaEA4lPHh6swlDUB90xAQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p> <h3 id="textfile"><a href="#textfile" class="header-anchor">#</a> TextFile</h3> <p>TextFile是hive数据表的默认格式，存储方式：行存储；可以采用多种压缩方式，但是部分压缩算法压缩数据后生成的文件是不支持split；压缩后的数据在反序列化过程中，必须逐个字段判断是不是分隔符和行结束符，因此反序列化开销会比SequenceFile高几十倍。</p> <p>•TextFile文件，非压缩</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--创建一个表，格式为文本文件：</span>
CREATEEXTERNALTABLE student_text <span class="token punctuation">(</span>idSTRING<span class="token punctuation">,</span> nameSTRING<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED
    <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span>
    <span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\n'</span>
STORED <span class="token keyword">AS</span> TEXTFILE<span class="token punctuation">;</span>
<span class="token comment">--导入数据到此表中,将启动MR任务</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> student_text <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span>
</code></pre></div><p>可以看到生成的数据文件的格式为非压缩的文本文件：</p> <div class="language- extra-class"><pre class="language-text"><code>hdfs dfs -cat /user/hive/warehouse/student_text/000000_0

1001810081,cheyo
1001810082,pku
1001810083,rocky
1001810084,stephen
2002820081,sql
2002820082,hello
2002820083,hijj
3001810081,hhhhhhh
3001810082,abbbbbb
</code></pre></div><p>•TextFile文件，Deflate压缩</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--创建一个表，格式为文件文件：</span>
CREATETABLE student_text_def <span class="token punctuation">(</span>idSTRING<span class="token punctuation">,</span> nameSTRING<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED
    <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span>
    <span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\n'</span>
STORED <span class="token keyword">AS</span> TEXTFILE<span class="token punctuation">;</span>
<span class="token comment">--设置压缩类型为Gzip压缩</span>
<span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>compress<span class="token punctuation">.</span>output<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compress<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compression<span class="token punctuation">.</span>codec<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>DefaultCodec<span class="token punctuation">;</span>
<span class="token comment">--导入数据：</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> student_text_def <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span>
<span class="token comment">--查看数据</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student_text_def<span class="token punctuation">;</span>
</code></pre></div><p>查看数据文件，可以看到数据文件为多个.deflate文件</p> <div class="language- extra-class"><pre class="language-text"><code>hdfs dfs -ls /user/hive/warehouse/student_text_def/
-rw-r--r--   2015-09-16 12:48 /user/hive/warehouse/student_text_def/000000_0.deflate
-rw-r--r--   2015-09-16 12:48 /user/hive/warehouse/student_text_def/000001_0.deflate
-rw-r--r--   2015-09-16 12:48 /user/hive/warehouse/student_text_def/000002_0.deflate
</code></pre></div><p>•TextFile文件，Gzip压缩</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--创建一个表，格式为文件文件：</span>
CREATETABLE student_text_gzip <span class="token punctuation">(</span>idSTRING<span class="token punctuation">,</span> nameSTRING<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED
    <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span>
    <span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\n'</span>
STORED <span class="token keyword">AS</span> TEXTFILE<span class="token punctuation">;</span>
<span class="token comment">--设置压缩类型为Gzip压缩</span>
<span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>compress<span class="token punctuation">.</span>output<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compress<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compression<span class="token punctuation">.</span>codec<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>GzipCodec<span class="token punctuation">;</span>

<span class="token keyword">set</span> io<span class="token punctuation">.</span>compression<span class="token punctuation">.</span>codecs<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>GzipCodec<span class="token punctuation">;</span>  
<span class="token comment">--导入数据：</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> student_text_gzip <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span>
<span class="token comment">--查看数据</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student_text_gzip<span class="token punctuation">;</span>
</code></pre></div><p>查看数据文件，可以看到数据文件为多个.gz文件。解压.gz文件，可以看到明文文本：</p> <div class="language- extra-class"><pre class="language-text"><code>hdfs dfs -ls /user/hive/warehouse/student_text_gzip/
-rw-r--r--  2015-09-15 10:03 /user/hive/warehouse/student_text_gzip/000000_0.gz
-rw-r--r--  2015-09-15 10:03 /user/hive/warehouse/student_text_gzip/000001_0.gz
-rw-r--r--  2015-09-15 10:03 /user/hive/warehouse/student_text_gzip/000002_0.gz
</code></pre></div><p>•TextFile文件，Bzip2压缩</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--创建一个表，格式为文件文件：</span>
CREATETABLE student_text_bzip2 <span class="token punctuation">(</span>idSTRING<span class="token punctuation">,</span> nameSTRING<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED
    <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span>
    <span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\n'</span>
STORED <span class="token keyword">AS</span> TEXTFILE<span class="token punctuation">;</span>
<span class="token comment">--设置压缩类型为Bzip2压缩：</span>
<span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>compress<span class="token punctuation">.</span>output<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compress<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compression<span class="token punctuation">.</span>codec<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>BZip2Codec<span class="token punctuation">;</span>
<span class="token comment">--导入数据</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> student_text_bzip2 <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span>
<span class="token comment">--查看数据：</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student_text_bzip2<span class="token punctuation">;</span>
</code></pre></div><p>查看数据文件，可看到数据文件为多个.bz2文件。解开.bz2文件，可以看到明文文本：</p> <div class="language- extra-class"><pre class="language-text"><code>hdfs dfs -ls /user/hive/warehouse/student_text_bzip2
-rw-r--r--  2015-09-15 10:09 /user/hive/warehouse/student_text_bzip2/000000_0.bz2
-rw-r--r--  2015-09-15 10:09 /user/hive/warehouse/student_text_bzip2/000001_0.bz2
-rw-r--r--  2015-09-15 10:09 /user/hive/warehouse/student_text_bzip2/000002_0.bz2
</code></pre></div><p>•TextFile文件，Lzo压缩</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--创建表</span>
CREATETABLE student_text_lzo <span class="token punctuation">(</span>idSTRING<span class="token punctuation">,</span> nameSTRING<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED
    <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span>
    <span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\n'</span>
STORED <span class="token keyword">AS</span> TEXTFILE<span class="token punctuation">;</span>
<span class="token comment">--设置为LZO压缩</span>
<span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>compress<span class="token punctuation">.</span>output<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compress<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compression<span class="token punctuation">.</span>codec<span class="token operator">=</span>com<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>compression<span class="token punctuation">.</span>lzo<span class="token punctuation">.</span>LzopCodec<span class="token punctuation">;</span>
<span class="token comment">--导入数据</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> student_text_lzo <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span>
<span class="token comment">--查询数据</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student_text_lzo<span class="token punctuation">;</span>
</code></pre></div><p>查看数据文件，可以看到数据文件为多个.lzo压缩。解开.lzo文件，可以看到明文文件。（需要安装lzop库）</p> <p>•TextFile文件，Lz4压缩</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--创建表</span>
CREATETABLE student_text_lz4 <span class="token punctuation">(</span>idSTRING<span class="token punctuation">,</span> nameSTRING<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED
    <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span>
    <span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\n'</span>
STORED <span class="token keyword">AS</span> TEXTFILE<span class="token punctuation">;</span>
<span class="token comment">--设置为LZ4压缩</span>
<span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>compress<span class="token punctuation">.</span>output<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compress<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compression<span class="token punctuation">.</span>codec<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>Lz4Codec<span class="token punctuation">;</span>
<span class="token comment">--导入数据</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> student_text_lz4 <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span>
</code></pre></div><p>查看数据文件，可看到数据文件为多个.lz4压缩。使用cat查看.lz4文件，可以看到是压缩后的文本。</p> <div class="language- extra-class"><pre class="language-text"><code>hdfs dfs -ls /user/hive/warehouse/student_text_lz4
-rw-r--r-- 2015-09-16 12:06 /user/hive/warehouse/student_text_lz4/000000_0.lz4
-rw-r--r-- 2015-09-16 12:06 /user/hive/warehouse/student_text_lz4/000001_0.lz4
-rw-r--r-- 2015-09-16 12:06 /user/hive/warehouse/student_text_lz4/000002_0.lz4
</code></pre></div><p>•TextFile文件，Snappy压缩</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--创建表</span>
CREATETABLE student_text_snappy <span class="token punctuation">(</span>idSTRING<span class="token punctuation">,</span> nameSTRING<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED
    <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span>
    <span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\n'</span>
STORED <span class="token keyword">AS</span> TEXTFILE<span class="token punctuation">;</span>
<span class="token comment">--设置压缩</span>
<span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>compress<span class="token punctuation">.</span>output<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>map<span class="token punctuation">.</span>output<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compress<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compression<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>SnappyCodec<span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compression<span class="token punctuation">.</span>codec<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>SnappyCodec<span class="token punctuation">;</span>
<span class="token keyword">SET</span> io<span class="token punctuation">.</span>compression<span class="token punctuation">.</span>codecs<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>SnappyCodec<span class="token punctuation">;</span>
<span class="token comment">--导入数据</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> student_text_snappy <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span>
<span class="token comment">--查询数据</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student_text_snappy<span class="token punctuation">;</span>
</code></pre></div><p>查看数据文件，可看到数据文件多个.snappy压缩文件。使用cat查看.snappy文件，可以看到是压缩后的文本：</p> <div class="language- extra-class"><pre class="language-text"><code>hdfs dfs -ls /user/hive/warehouse/student_text_snappy
Found3 items
-rw-r--r--   2015-09-15 16:42 /user/hive/warehouse/student_text_snappy/000000_0.snappy
-rw-r--r--   2015-09-15 16:42 /user/hive/warehouse/student_text_snappy/000001_0.snappy
-rw-r--r--   2015-09-15 16:42 /user/hive/warehouse/student_text_snappy/000002_0.snappy
</code></pre></div><h3 id="sequencefile文件"><a href="#sequencefile文件" class="header-anchor">#</a> SequenceFile文件</h3> <p>SequenceFile是Hadoop API提供的一种二进制文件，它将数据以&lt;key,value&gt;的形式序列化到文件中。这种二进制文件内部使用hadoop的标准Writable接口实现序列化和反序列化。它与Hadoop API中的MapFile是互相兼容的。hive中的SequenceFile继承自hadoop API的SequenceFile,不过它的key为空，使用value存放实际的值，这样是为了避免MR在运行map阶段的排序过程。</p> <p>•SequenceFile是一种二进制文件，以&lt;key,value&gt;的形式序列化到文件中。存储方式：行存储；•支持三种压缩类型：None、Record、Block。默认采用Record，但是Record压缩率低；一般建议使用Block压缩；•优势是文件和Hadoop API的MapFile是相互兼容的。</p> <p>•SequenceFile,Deflate压缩</p> <div class="language- extra-class"><pre class="language-text"><code>--创建一个表，格式为文件文件：
CREATETABLE student_seq_def (idSTRING, nameSTRING)
ROW FORMAT DELIMITED
    FIELDS TERMINATED BY ','
    LINES TERMINATED BY '\n'
STORED AS SEQUENCEFILE;
--设置压缩算法为Deflate压缩
SET hive.exec.compress.output=true;
SET mapred.output.compress=true;
SET mapred.output.compression.codec=org.apache.hadoop.io.compress.DeflateCodec;
--设置压缩类型为block
SET mapred.output.compression.type=BLOCK
--导入数据：
INSERT OVERWRITE TABLE student_seq_def SELECT * FROM student;
--查看数据
SELECT * FROM student_seq_def;
</code></pre></div><p>查看数据文件，是一个密文的文件。</p> <div class="language- extra-class"><pre class="language-text"><code>hdfs dfs -ls /user/hive/warehouse/student_seq_def/
-rw-r--r--  /user/hive/warehouse/student_seq_def/000000_0
</code></pre></div><p>•SequenceFile,Gzip压缩</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--创建一个表，格式为文件文件：</span>
CREATETABLE student_seq_gzip <span class="token punctuation">(</span>idSTRING<span class="token punctuation">,</span> nameSTRING<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED
    <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span>
    <span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\n'</span>
STORED <span class="token keyword">AS</span> SEQUENCEFILE<span class="token punctuation">;</span>
<span class="token comment">--设置压缩类型为Gzip压缩</span>
<span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>compress<span class="token punctuation">.</span>output<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compress<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compression<span class="token punctuation">.</span>codec<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>GzipCodec<span class="token punctuation">;</span>
<span class="token comment">--设置压缩类型为block</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compression<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token operator">=</span>BLOCK
<span class="token comment">--导入数据：</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> student_seq_gzip <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span>
<span class="token comment">--查看数据</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student_seq_gzip<span class="token punctuation">;</span>
</code></pre></div><p>查看数据文件，是一个密文的文件，无法通过gzip解压：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>hdfs dfs -ls /user/hive/warehouse/student_seq_gzip/
-rw-r--r--  /user/hive/warehouse/student_seq_gzip/000000_0
</code></pre></div><h3 id="rcfile"><a href="#rcfile" class="header-anchor">#</a> RcFile</h3> <p>存储方式：数据按行分块，每块按列存储。结合了行存储和列存储的有点：</p> <p>•首先RCFile保证同一行的数据位于同一节点，因此元组重构开销很低；•其次像列存储一样，RCFile能够利用列维度的数据压缩，并且能跳过不必要的列读取。</p> <p>RCFile的一个行组包括三部分：</p> <p>•第一部分是行组头部的
同步标识，主要用于分割HDFS块中的两个连续行组；•第二部分是行组的元数据头部，用户存储行组单元的信息，包括行组中的记录数、每个列的字节数、列中每个域的字节数；•第三部分是
表格数据段，即实际的列存储数据。在该部分中，同一列的所有域顺序存储。</p> <p>数据追加：RCFile不支持任意方式的数据写操作，仅提供一种追加接口，这是因为底层的HDFS当前仅仅支持数据追加写文件尾部。</p> <p>行组大小：行组变大有助于提高数据压缩的效率，但是可能会损害数据的读取性能，因为这样增加了 Lazy 解压性能的消耗。而且行组变大会占用更多的内存，这会影响并发执行的其他MR作业。考虑到存储空间和查询效率两个方面，Facebook 选择 4MB 作为默认的行组大小，当然也允许用户自行选择参数进行配置。</p> <p>•RcFile,Gzip压缩</p> <div class="language-sql extra-class"><pre class="language-sql"><code>CREATETABLE student_rcfile_gzip <span class="token punctuation">(</span>idSTRING<span class="token punctuation">,</span> nameSTRING<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED
    <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span>
    <span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\n'</span>
STORED <span class="token keyword">AS</span> RCFILE<span class="token punctuation">;</span>

<span class="token comment">--设置压缩类型为Gzip压缩</span>
<span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>compress<span class="token punctuation">.</span>output<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compress<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compression<span class="token punctuation">.</span>codec<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>GzipCodec<span class="token punctuation">;</span>
<span class="token keyword">SET</span> io<span class="token punctuation">.</span>compression<span class="token punctuation">.</span>codecs<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>GzipCodec<span class="token punctuation">;</span>
<span class="token comment">--导入数据：</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> student_rcfile_gzip SELECTid<span class="token punctuation">,</span>nameFROM student<span class="token punctuation">;</span>
<span class="token comment">--查看数据</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student_rcfile_gzip<span class="token punctuation">;</span>
</code></pre></div><h3 id="orcfile"><a href="#orcfile" class="header-anchor">#</a> ORCFile</h3> <p>ORCFile有自己的参数设置压缩格式，一般不使用上述Hive参数设置压缩参数。</p> <p>•存储方式：数据按行分块，每块按照列存储；•压缩快 快速列存取•效率比RCFile高，是RCFile的改良版本。</p> <p>•ORCFile，Zlib压缩</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--创建表</span>
CREATETABLE student_orcfile_zlib <span class="token punctuation">(</span>idSTRING<span class="token punctuation">,</span> nameSTRING<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED
    <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span>
    <span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\n'</span>
STORED <span class="token keyword">AS</span> ORCFILE TBLPROPERTIES <span class="token punctuation">(</span><span class="token string">&quot;orc.compress&quot;</span><span class="token operator">=</span><span class="token string">&quot;ZLIB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--导入数据</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> student_orcfile_zlib SELECTid<span class="token punctuation">,</span>nameFROM student<span class="token punctuation">;</span>
<span class="token comment">--查询数据</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student_orcfile_zlib<span class="token punctuation">;</span>
</code></pre></div><p>•ORCFile，Snappy压缩</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--创建表</span>
CREATETABLE student_orcfile_snappy2 <span class="token punctuation">(</span>idSTRING<span class="token punctuation">,</span> nameSTRING<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED
    <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span>
    <span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\n'</span>
STORED <span class="token keyword">AS</span> ORCFILE TBLPROPERTIES <span class="token punctuation">(</span><span class="token string">&quot;orc.compress&quot;</span><span class="token operator">=</span><span class="token string">&quot;SNAPPY&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--导入数据</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> student_orcfile_snappy2 SELECTid<span class="token punctuation">,</span>nameFROM student<span class="token punctuation">;</span>
<span class="token comment">--查询数据</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student_orcfile_snappy2<span class="token punctuation">;</span>
</code></pre></div><p>•不推荐</p> <p>一般不推荐使用下述方式。采用下述方式压缩后，结果与上面同类型压缩（Snappy）不同。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--创建表</span>
CREATETABLE student_orcfile_snappy <span class="token punctuation">(</span>idSTRING<span class="token punctuation">,</span> nameSTRING<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED
    <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span>
    <span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\n'</span>
STORED <span class="token keyword">AS</span> ORCFILE<span class="token punctuation">;</span>
<span class="token comment">--设置压缩</span>
<span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>compress<span class="token punctuation">.</span>output<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>map<span class="token punctuation">.</span>output<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compress<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compression<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>SnappyCodec<span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compression<span class="token punctuation">.</span>codec<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>SnappyCodec<span class="token punctuation">;</span>
<span class="token keyword">SET</span> io<span class="token punctuation">.</span>compression<span class="token punctuation">.</span>codecs<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>SnappyCodec<span class="token punctuation">;</span>
<span class="token comment">--导入数据</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> student_orcfile_snappy SELECTid<span class="token punctuation">,</span>nameFROM student<span class="token punctuation">;</span>
<span class="token comment">--查询数据</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student_orcfile_snappy<span class="token punctuation">;</span>
</code></pre></div><h3 id="parquet"><a href="#parquet" class="header-anchor">#</a> Parquet</h3> <p>•Parquet，Snappy压缩</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--创建表</span>
CREATETABLE student_parquet_snappy <span class="token punctuation">(</span>idSTRING<span class="token punctuation">,</span> nameSTRING<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED
    <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span>
    <span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\n'</span>
STORED <span class="token keyword">AS</span> PARQUET<span class="token punctuation">;</span>
<span class="token comment">--设置压缩</span>
<span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>compress<span class="token punctuation">.</span>output<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>map<span class="token punctuation">.</span>output<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compress<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compression<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>SnappyCodec<span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compression<span class="token punctuation">.</span>codec<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>SnappyCodec<span class="token punctuation">;</span>
<span class="token keyword">SET</span> io<span class="token punctuation">.</span>compression<span class="token punctuation">.</span>codecs<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>SnappyCodec<span class="token punctuation">;</span>
<span class="token comment">--导入数据</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> student_parquet_snappy SELECTid<span class="token punctuation">,</span>nameFROM student<span class="token punctuation">;</span>
<span class="token comment">--查询数据</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student_parquet_snappy<span class="token punctuation">;</span>
</code></pre></div><h3 id="avro"><a href="#avro" class="header-anchor">#</a> Avro</h3> <p>•Avro，Snappy压缩</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--创建表</span>
CREATETABLE student_avro_snappy <span class="token punctuation">(</span>idSTRING<span class="token punctuation">,</span> nameSTRING<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT DELIMITED
    <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span>
    <span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\n'</span>
STORED <span class="token keyword">AS</span> AVRO<span class="token punctuation">;</span>
<span class="token comment">--设置压缩</span>
<span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>compress<span class="token punctuation">.</span>output<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>map<span class="token punctuation">.</span>output<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compress<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compression<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>SnappyCodec<span class="token punctuation">;</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>output<span class="token punctuation">.</span>compression<span class="token punctuation">.</span>codec<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>SnappyCodec<span class="token punctuation">;</span>
<span class="token keyword">SET</span> io<span class="token punctuation">.</span>compression<span class="token punctuation">.</span>codecs<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>SnappyCodec<span class="token punctuation">;</span>
<span class="token comment">--导入数据</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> student_avro_snappy SELECTid<span class="token punctuation">,</span>nameFROM student<span class="token punctuation">;</span>
<span class="token comment">--查询数据</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student_avro_snappy<span class="token punctuation">;</span>
</code></pre></div><h3 id="不同压缩算法比较"><a href="#不同压缩算法比较" class="header-anchor">#</a> 不同压缩算法比较</h3> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2PDYW1H9ZcwnwM2B86BxqS4bicrmBK9Yhe3aFHgWmtDnMmJhm6dkrHjOESSA83nzqFqYgYyFibeNw8g/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p> <h3 id="数仓表分区优化"><a href="#数仓表分区优化" class="header-anchor">#</a> 数仓表分区优化</h3> <p>数据仓库创建数仓表时，ETL开发人员基于使用习惯和处理的方便性，经常创建多层分区，来存储数据。但是过多的分区会消耗NameNode大量的资源，并且也会引入小文件的问题。所以对于创建数仓表的分区，要求如下：</p> <p>•对于统计数据表、数据量不大的基础表、业务上无累计快照和周期性快照要求的数据表，尽可能的不创建分区，而采用数据合并回写的方式解决；•对于一些数据量大的表，如果需要创建分区，提高插叙过程中数据的加载速度，尽可能的只做天级分区。而对于卖点的原始数据，这种特大的数据量的，可以采用小时分区。对于月分区，坚决去掉。•对于一些周期快照和累计快照的表，我们尽可能只创建日分区。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/./bigdata/hive/Hive和Hbase的各自适用场景.html" class="prev">
        Hive和Hbase的各自适用场景
      </a></span> <span class="next"><a href="/./bigdata/hive/Hive小知识之分桶抽样.html">
        Hive小知识之分桶抽样
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="./assets/js/app.9ce0d262.js" defer></script><script src="./assets/js/2.fa5f1a4a.js" defer></script><script src="./assets/js/35.27a56cfa.js" defer></script>
  </body>
</html>
