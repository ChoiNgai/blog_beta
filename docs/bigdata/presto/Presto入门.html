<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>即席查询框架Presto入门 | 大数据技术文档</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="./favicon.ico">
    <meta name="description" content="从入门到入土">
    
    <link rel="preload" href="./assets/css/0.styles.2c6e287f.css" as="style"><link rel="preload" href="./assets/js/app.9ce0d262.js" as="script"><link rel="preload" href="./assets/js/2.fa5f1a4a.js" as="script"><link rel="preload" href="./assets/js/57.8263a106.js" as="script"><link rel="prefetch" href="./assets/js/10.6940d239.js"><link rel="prefetch" href="./assets/js/100.22cf6913.js"><link rel="prefetch" href="./assets/js/101.8a31dcdc.js"><link rel="prefetch" href="./assets/js/102.147ef11e.js"><link rel="prefetch" href="./assets/js/103.cc281f62.js"><link rel="prefetch" href="./assets/js/104.2e0465e5.js"><link rel="prefetch" href="./assets/js/105.910aa23c.js"><link rel="prefetch" href="./assets/js/106.5466141f.js"><link rel="prefetch" href="./assets/js/107.a92bd18e.js"><link rel="prefetch" href="./assets/js/108.51fca30a.js"><link rel="prefetch" href="./assets/js/109.6119ffd0.js"><link rel="prefetch" href="./assets/js/11.bd53d768.js"><link rel="prefetch" href="./assets/js/110.eda784ab.js"><link rel="prefetch" href="./assets/js/111.12c174e7.js"><link rel="prefetch" href="./assets/js/112.8f45d1d2.js"><link rel="prefetch" href="./assets/js/113.e0bb8777.js"><link rel="prefetch" href="./assets/js/114.2ffc5abc.js"><link rel="prefetch" href="./assets/js/115.264d88bb.js"><link rel="prefetch" href="./assets/js/116.43a8b13e.js"><link rel="prefetch" href="./assets/js/117.03317ae7.js"><link rel="prefetch" href="./assets/js/118.dee53adb.js"><link rel="prefetch" href="./assets/js/119.662a11fb.js"><link rel="prefetch" href="./assets/js/12.b25bd03a.js"><link rel="prefetch" href="./assets/js/120.8d1c0658.js"><link rel="prefetch" href="./assets/js/121.c866d980.js"><link rel="prefetch" href="./assets/js/122.141777da.js"><link rel="prefetch" href="./assets/js/123.64bf1df0.js"><link rel="prefetch" href="./assets/js/124.0f402852.js"><link rel="prefetch" href="./assets/js/125.adf420b6.js"><link rel="prefetch" href="./assets/js/126.5ac52ff6.js"><link rel="prefetch" href="./assets/js/127.31a2c0b9.js"><link rel="prefetch" href="./assets/js/128.ee1158fc.js"><link rel="prefetch" href="./assets/js/129.ea47f41d.js"><link rel="prefetch" href="./assets/js/13.127a8756.js"><link rel="prefetch" href="./assets/js/130.169a1c91.js"><link rel="prefetch" href="./assets/js/131.25141855.js"><link rel="prefetch" href="./assets/js/132.1961433f.js"><link rel="prefetch" href="./assets/js/133.4a4b3148.js"><link rel="prefetch" href="./assets/js/134.3cf3137b.js"><link rel="prefetch" href="./assets/js/135.25c96955.js"><link rel="prefetch" href="./assets/js/136.34bc078a.js"><link rel="prefetch" href="./assets/js/137.0d68c97e.js"><link rel="prefetch" href="./assets/js/138.06820a54.js"><link rel="prefetch" href="./assets/js/139.25951593.js"><link rel="prefetch" href="./assets/js/14.ee4f6d75.js"><link rel="prefetch" href="./assets/js/140.9631a9a0.js"><link rel="prefetch" href="./assets/js/141.7e3c7d7b.js"><link rel="prefetch" href="./assets/js/142.fc0ba6d0.js"><link rel="prefetch" href="./assets/js/143.a87cd9f4.js"><link rel="prefetch" href="./assets/js/144.b8153695.js"><link rel="prefetch" href="./assets/js/145.5bb910bf.js"><link rel="prefetch" href="./assets/js/146.48346688.js"><link rel="prefetch" href="./assets/js/147.14fdd265.js"><link rel="prefetch" href="./assets/js/148.910c7bb0.js"><link rel="prefetch" href="./assets/js/149.17e89273.js"><link rel="prefetch" href="./assets/js/15.4c07895d.js"><link rel="prefetch" href="./assets/js/150.c09b3d84.js"><link rel="prefetch" href="./assets/js/151.1c6f270e.js"><link rel="prefetch" href="./assets/js/152.14fbeaa5.js"><link rel="prefetch" href="./assets/js/153.2452da0e.js"><link rel="prefetch" href="./assets/js/154.b4df1979.js"><link rel="prefetch" href="./assets/js/155.22d7abd8.js"><link rel="prefetch" href="./assets/js/156.2f9a9ccc.js"><link rel="prefetch" href="./assets/js/157.969faec2.js"><link rel="prefetch" href="./assets/js/158.3500ec52.js"><link rel="prefetch" href="./assets/js/159.e527d9a4.js"><link rel="prefetch" href="./assets/js/16.c4323435.js"><link rel="prefetch" href="./assets/js/160.e9019d68.js"><link rel="prefetch" href="./assets/js/161.85c34333.js"><link rel="prefetch" href="./assets/js/162.a46ae7b7.js"><link rel="prefetch" href="./assets/js/163.7be9bd8c.js"><link rel="prefetch" href="./assets/js/164.0c6811d8.js"><link rel="prefetch" href="./assets/js/165.57bd5bac.js"><link rel="prefetch" href="./assets/js/166.afa88f4a.js"><link rel="prefetch" href="./assets/js/167.29d4d5ce.js"><link rel="prefetch" href="./assets/js/168.e653cd83.js"><link rel="prefetch" href="./assets/js/169.e6f17762.js"><link rel="prefetch" href="./assets/js/17.505c5524.js"><link rel="prefetch" href="./assets/js/170.ef23a402.js"><link rel="prefetch" href="./assets/js/171.cad09bfd.js"><link rel="prefetch" href="./assets/js/172.70b28875.js"><link rel="prefetch" href="./assets/js/173.bd26a56b.js"><link rel="prefetch" href="./assets/js/174.eb342099.js"><link rel="prefetch" href="./assets/js/175.e65fe97d.js"><link rel="prefetch" href="./assets/js/176.991a568d.js"><link rel="prefetch" href="./assets/js/177.14728a0e.js"><link rel="prefetch" href="./assets/js/178.dd08b87f.js"><link rel="prefetch" href="./assets/js/179.35f52dd6.js"><link rel="prefetch" href="./assets/js/18.a3c1984e.js"><link rel="prefetch" href="./assets/js/180.fce6e839.js"><link rel="prefetch" href="./assets/js/181.344642d1.js"><link rel="prefetch" href="./assets/js/182.cb6d50af.js"><link rel="prefetch" href="./assets/js/183.18ccb5d5.js"><link rel="prefetch" href="./assets/js/184.7a48514f.js"><link rel="prefetch" href="./assets/js/19.e0fa9e47.js"><link rel="prefetch" href="./assets/js/20.da04fed8.js"><link rel="prefetch" href="./assets/js/21.039b78b5.js"><link rel="prefetch" href="./assets/js/22.91b1dd94.js"><link rel="prefetch" href="./assets/js/23.f70b01e1.js"><link rel="prefetch" href="./assets/js/24.bf935b15.js"><link rel="prefetch" href="./assets/js/25.740be3c8.js"><link rel="prefetch" href="./assets/js/26.f310e9df.js"><link rel="prefetch" href="./assets/js/27.0650d6da.js"><link rel="prefetch" href="./assets/js/28.30bd72ee.js"><link rel="prefetch" href="./assets/js/29.765dccf5.js"><link rel="prefetch" href="./assets/js/3.aa27e9f3.js"><link rel="prefetch" href="./assets/js/30.0484ae09.js"><link rel="prefetch" href="./assets/js/31.e09e1f25.js"><link rel="prefetch" href="./assets/js/32.9048892a.js"><link rel="prefetch" href="./assets/js/33.47a85736.js"><link rel="prefetch" href="./assets/js/34.162be571.js"><link rel="prefetch" href="./assets/js/35.27a56cfa.js"><link rel="prefetch" href="./assets/js/36.e2b24ea4.js"><link rel="prefetch" href="./assets/js/37.660e2ae2.js"><link rel="prefetch" href="./assets/js/38.e115bc82.js"><link rel="prefetch" href="./assets/js/39.786d0e1f.js"><link rel="prefetch" href="./assets/js/4.dac57b37.js"><link rel="prefetch" href="./assets/js/40.1034d892.js"><link rel="prefetch" href="./assets/js/41.2952b19a.js"><link rel="prefetch" href="./assets/js/42.75753f7b.js"><link rel="prefetch" href="./assets/js/43.af07ba27.js"><link rel="prefetch" href="./assets/js/44.c64a1c19.js"><link rel="prefetch" href="./assets/js/45.a3f07fbe.js"><link rel="prefetch" href="./assets/js/46.cde01b57.js"><link rel="prefetch" href="./assets/js/47.ca2de71c.js"><link rel="prefetch" href="./assets/js/48.264c1471.js"><link rel="prefetch" href="./assets/js/49.733bd546.js"><link rel="prefetch" href="./assets/js/5.6ca2ea8d.js"><link rel="prefetch" href="./assets/js/50.7b9d16c8.js"><link rel="prefetch" href="./assets/js/51.f427baa6.js"><link rel="prefetch" href="./assets/js/52.112ba3d3.js"><link rel="prefetch" href="./assets/js/53.bc7a9bfd.js"><link rel="prefetch" href="./assets/js/54.258fa5ae.js"><link rel="prefetch" href="./assets/js/55.00d67ca6.js"><link rel="prefetch" href="./assets/js/56.ea8c85f2.js"><link rel="prefetch" href="./assets/js/58.e0b33df6.js"><link rel="prefetch" href="./assets/js/59.4d5f847f.js"><link rel="prefetch" href="./assets/js/6.a67b19a4.js"><link rel="prefetch" href="./assets/js/60.d3638a19.js"><link rel="prefetch" href="./assets/js/61.33bd82a8.js"><link rel="prefetch" href="./assets/js/62.6287fa56.js"><link rel="prefetch" href="./assets/js/63.f043aec3.js"><link rel="prefetch" href="./assets/js/64.fd61b3bb.js"><link rel="prefetch" href="./assets/js/65.088db422.js"><link rel="prefetch" href="./assets/js/66.fa850071.js"><link rel="prefetch" href="./assets/js/67.6f9263db.js"><link rel="prefetch" href="./assets/js/68.a40fea6a.js"><link rel="prefetch" href="./assets/js/69.82a38b9c.js"><link rel="prefetch" href="./assets/js/7.130b2290.js"><link rel="prefetch" href="./assets/js/70.78387c60.js"><link rel="prefetch" href="./assets/js/71.c8bafdac.js"><link rel="prefetch" href="./assets/js/72.f6af738e.js"><link rel="prefetch" href="./assets/js/73.483631aa.js"><link rel="prefetch" href="./assets/js/74.7a295ce2.js"><link rel="prefetch" href="./assets/js/75.4ee52419.js"><link rel="prefetch" href="./assets/js/76.bfa2477e.js"><link rel="prefetch" href="./assets/js/77.36dbbf31.js"><link rel="prefetch" href="./assets/js/78.99a9055a.js"><link rel="prefetch" href="./assets/js/79.cf91068c.js"><link rel="prefetch" href="./assets/js/8.e81bc496.js"><link rel="prefetch" href="./assets/js/80.5091cf53.js"><link rel="prefetch" href="./assets/js/81.1ab1ac83.js"><link rel="prefetch" href="./assets/js/82.075a98b9.js"><link rel="prefetch" href="./assets/js/83.f6479725.js"><link rel="prefetch" href="./assets/js/84.36b72a58.js"><link rel="prefetch" href="./assets/js/85.5a115a90.js"><link rel="prefetch" href="./assets/js/86.e2e2bc5e.js"><link rel="prefetch" href="./assets/js/87.7498c4d7.js"><link rel="prefetch" href="./assets/js/88.424c69e2.js"><link rel="prefetch" href="./assets/js/89.5997766e.js"><link rel="prefetch" href="./assets/js/9.7d490254.js"><link rel="prefetch" href="./assets/js/90.ba4d2a78.js"><link rel="prefetch" href="./assets/js/91.920a9ee1.js"><link rel="prefetch" href="./assets/js/92.7903dbd3.js"><link rel="prefetch" href="./assets/js/93.e120bbac.js"><link rel="prefetch" href="./assets/js/94.cddc34d7.js"><link rel="prefetch" href="./assets/js/95.0a7a80fe.js"><link rel="prefetch" href="./assets/js/96.26590fe7.js"><link rel="prefetch" href="./assets/js/97.91bdc308.js"><link rel="prefetch" href="./assets/js/98.9a1146d2.js"><link rel="prefetch" href="./assets/js/99.d5e87370.js">
    <link rel="stylesheet" href="./assets/css/0.styles.2c6e287f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/./" class="home-link router-link-active"><!----> <span class="site-name">大数据技术文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/./" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程基础" class="dropdown-title"><span class="title">编程基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程基础" class="mobile-dropdown-title"><span class="title">编程基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/java基础语法/" class="nav-link">
  Java基础语法
</a></li><li class="dropdown-subitem"><a href="/./coding-base/" class="nav-link">
  Java基础实战
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶(选学)
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/java并发编程/java并发编程.html" class="nav-link">
  Java并发编程
</a></li><li class="dropdown-subitem"><a href="/./coding-base/" class="nav-link">
  Java网络编程
</a></li><li class="dropdown-subitem"><a href="/./coding-base/java集合/Java集合（永盛）.html" class="nav-link">
  Java集合
</a></li><li class="dropdown-subitem"><a href="/./coding-base/java虚拟机/" class="nav-link">
  Java虚拟机
</a></li></ul></li><li class="dropdown-item"><h4>
          计算机基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-subitem"><a href="/./coding-base/数据结构与算法/" class="nav-link">
  数据结构（重要）
</a></li><li class="dropdown-subitem"><a href="/./coding-base/计算机网络/计算机网络（双祥）.html" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/./coding-base/操作系统/" class="nav-link">
  操作系统
</a></li></ul></li><li class="dropdown-item"><h4>
          Python（选学）
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/Python/python基础/" class="nav-link">
  Python基础语法
</a></li><li class="dropdown-subitem"><a href="/./coding-base/Python/python库/" class="nav-link">
  Python数据科学库
</a></li></ul></li><li class="dropdown-item"><h4>
          框架（选学）
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/框架/sprin系列/" class="nav-link">
  Spring系列
</a></li><li class="dropdown-subitem"><a href="/./coding-base/框架/flask/falsk.html" class="nav-link">
  Flask
</a></li><li class="dropdown-subitem"><a href="/./coding-base/框架/vue/flask.html" class="nav-link">
  Vue
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./database/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/./database/hbase/" class="nav-link">
  HBase
</a></li><li class="dropdown-item"><!----> <a href="/./database/tidb/" class="nav-link">
  TiDB
</a></li><li class="dropdown-item"><!----> <a href="/./database/clickhouse/" class="nav-link">
  ClickHouse
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据仓库" class="dropdown-title"><span class="title">数据仓库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据仓库" class="mobile-dropdown-title"><span class="title">数据仓库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./datahouse/sql/" class="nav-link">
  SQL
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/大数据基础/bigdata-base.html" class="nav-link">
  大数据基础
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/离线数仓/" class="nav-link">
  离线数仓
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/实时数仓/" class="nav-link">
  实时数仓
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/商业化技术/" class="nav-link">
  商业化技术
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/电商业务/" class="nav-link">
  电商业务
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据框架及组件" class="dropdown-title"><span class="title">大数据框架及组件</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据框架及组件" class="mobile-dropdown-title"><span class="title">大数据框架及组件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./bigdata/hadoop/" class="nav-link">
  Hadoop
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/hive/" class="nav-link">
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/zookeeper/" class="nav-link">
  Zookeeper
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/kafka/" class="nav-link">
  kafka
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/spark/" class="nav-link">
  Spark
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/flink/" class="nav-link">
  Flink
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/sqoop/Sqoop入门.html" class="nav-link">
  Sqoop
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/presto/Presto入门.html" class="nav-link">
  Presto
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/kylin/" class="nav-link">
  Kylin
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/Druid/Druid入门.html" class="nav-link">
  Druid
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/elasticsearch/ElasticSearch入门.html" class="nav-link">
  ElasticSearch
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./other/面经/" class="nav-link">
  面经
</a></li><li class="dropdown-item"><!----> <a href="/./other/机器学习/" class="nav-link">
  机器学习
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/./" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程基础" class="dropdown-title"><span class="title">编程基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程基础" class="mobile-dropdown-title"><span class="title">编程基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/java基础语法/" class="nav-link">
  Java基础语法
</a></li><li class="dropdown-subitem"><a href="/./coding-base/" class="nav-link">
  Java基础实战
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶(选学)
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/java并发编程/java并发编程.html" class="nav-link">
  Java并发编程
</a></li><li class="dropdown-subitem"><a href="/./coding-base/" class="nav-link">
  Java网络编程
</a></li><li class="dropdown-subitem"><a href="/./coding-base/java集合/Java集合（永盛）.html" class="nav-link">
  Java集合
</a></li><li class="dropdown-subitem"><a href="/./coding-base/java虚拟机/" class="nav-link">
  Java虚拟机
</a></li></ul></li><li class="dropdown-item"><h4>
          计算机基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-subitem"><a href="/./coding-base/数据结构与算法/" class="nav-link">
  数据结构（重要）
</a></li><li class="dropdown-subitem"><a href="/./coding-base/计算机网络/计算机网络（双祥）.html" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/./coding-base/操作系统/" class="nav-link">
  操作系统
</a></li></ul></li><li class="dropdown-item"><h4>
          Python（选学）
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/Python/python基础/" class="nav-link">
  Python基础语法
</a></li><li class="dropdown-subitem"><a href="/./coding-base/Python/python库/" class="nav-link">
  Python数据科学库
</a></li></ul></li><li class="dropdown-item"><h4>
          框架（选学）
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/框架/sprin系列/" class="nav-link">
  Spring系列
</a></li><li class="dropdown-subitem"><a href="/./coding-base/框架/flask/falsk.html" class="nav-link">
  Flask
</a></li><li class="dropdown-subitem"><a href="/./coding-base/框架/vue/flask.html" class="nav-link">
  Vue
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./database/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/./database/hbase/" class="nav-link">
  HBase
</a></li><li class="dropdown-item"><!----> <a href="/./database/tidb/" class="nav-link">
  TiDB
</a></li><li class="dropdown-item"><!----> <a href="/./database/clickhouse/" class="nav-link">
  ClickHouse
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据仓库" class="dropdown-title"><span class="title">数据仓库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据仓库" class="mobile-dropdown-title"><span class="title">数据仓库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./datahouse/sql/" class="nav-link">
  SQL
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/大数据基础/bigdata-base.html" class="nav-link">
  大数据基础
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/离线数仓/" class="nav-link">
  离线数仓
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/实时数仓/" class="nav-link">
  实时数仓
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/商业化技术/" class="nav-link">
  商业化技术
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/电商业务/" class="nav-link">
  电商业务
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据框架及组件" class="dropdown-title"><span class="title">大数据框架及组件</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据框架及组件" class="mobile-dropdown-title"><span class="title">大数据框架及组件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./bigdata/hadoop/" class="nav-link">
  Hadoop
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/hive/" class="nav-link">
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/zookeeper/" class="nav-link">
  Zookeeper
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/kafka/" class="nav-link">
  kafka
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/spark/" class="nav-link">
  Spark
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/flink/" class="nav-link">
  Flink
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/sqoop/Sqoop入门.html" class="nav-link">
  Sqoop
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/presto/Presto入门.html" class="nav-link">
  Presto
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/kylin/" class="nav-link">
  Kylin
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/Druid/Druid入门.html" class="nav-link">
  Druid
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/elasticsearch/ElasticSearch入门.html" class="nav-link">
  ElasticSearch
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./other/面经/" class="nav-link">
  面经
</a></li><li class="dropdown-item"><!----> <a href="/./other/机器学习/" class="nav-link">
  机器学习
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Presto</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./bigdata/presto/Presto入门.html" class="active sidebar-link">即席查询框架Presto入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_1-presto简介" class="sidebar-link">1. Presto简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_1-1-presto概念" class="sidebar-link">1. 1 Presto概念</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_1-2-presto-应用场景" class="sidebar-link">1.2 Presto 应用场景</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_1-3-presto架构" class="sidebar-link">1.3 Presto架构</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_1-4-presto-数据模型" class="sidebar-link">1.4 Presto 数据模型</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_1-5-presto-优缺点" class="sidebar-link">1.5 Presto 优缺点</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_1-6-presto、impala性能比较" class="sidebar-link">1.6  Presto、Impala性能比较</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_1-7-官网地址" class="sidebar-link">1.7 官网地址</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_1-8-prestodb-vs-prestosql-trino" class="sidebar-link">1.8 Prestodb VS Prestosql(trino)</a></li></ul></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_2-presto安装部署" class="sidebar-link">2. Presto安装部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_2-1-prestosql-版本的选择" class="sidebar-link">2.1 prestosql 版本的选择</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_2-2-集群安装规划" class="sidebar-link">2.2 集群安装规划</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_2-3-presto-server-的安装" class="sidebar-link">2.3 Presto Server 的安装</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_2-4-node-properties-配置" class="sidebar-link">2.4 Node Properties 配置</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_2-5-jvm-config-配置" class="sidebar-link">2.5 JVM Config 配置</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_2-6-config-properties-配置" class="sidebar-link">2.6 Config Properties 配置</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_2-7-log-properties-配置" class="sidebar-link">2.7 Log Properties 配置</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_2-8-catalog-properties-配置" class="sidebar-link">2.8 Catalog Properties 配置</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_2-9-分发安装目录到集群中其它节点上" class="sidebar-link">2.9 分发安装目录到集群中其它节点上</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_2-10-修改-node-id" class="sidebar-link">2.10 修改 node.id</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_2-11-修改-work-节点的配置信息" class="sidebar-link">2.11 修改 work 节点的配置信息</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_2-12-启动服务" class="sidebar-link">2.12 启动服务</a></li></ul></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_3、presto-命令行-client-的安装" class="sidebar-link">3、Presto 命令行 Client 的安装</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_4、presto-的基本使用" class="sidebar-link">4、Presto 的基本使用</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_5、presto可视化客户端的安装" class="sidebar-link">5、Presto可视化客户端的安装</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_6、presto的优化" class="sidebar-link">6、Presto的优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_6-1-数据存储" class="sidebar-link">6.1 数据存储</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_6-2-sql查询" class="sidebar-link">6.2 SQL查询</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_6-3-注意事项" class="sidebar-link">6.3 注意事项</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#_6-4-可能会踩的坑" class="sidebar-link">6.4 可能会踩的坑</a></li></ul></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#巨人的肩膀" class="sidebar-link">巨人的肩膀</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#小结" class="sidebar-link">小结</a></li><li class="sidebar-sub-header"><a href="/./bigdata/presto/Presto入门.html#彩蛋" class="sidebar-link">彩蛋</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="即席查询框架presto入门"><a href="#即席查询框架presto入门" class="header-anchor">#</a> 即席查询框架Presto入门</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p><strong>Presto</strong> 作为现在在企业中流行使用的<strong>即席查询</strong>框架，已经在不同的领域得到了越来越多的应用。本期内容，我会从一个初学者的角度，带着大家从 0 到 1 学习 <strong>Presto</strong>，希望大家能够有所收获！
<img src="https://img-blog.csdnimg.cn/20210303224919638.png?,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDMxODgzMA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">
@[TOC]</p> <h2 id="_1-presto简介"><a href="#_1-presto简介" class="header-anchor">#</a> 1. Presto简介</h2> <h3 id="_1-1-presto概念"><a href="#_1-1-presto概念" class="header-anchor">#</a> 1. 1 Presto概念</h3> <p><font color="Tomato">Presto是  Facebook  推出的一个开源的分布式SQL查询引擎，数据规模可以支持GB到PB级，主要应用于处理<strong>秒级查询</strong>的场景。</font>Presto 的设计和编写完全是为了解决像 Facebook 这样规模的商业数据仓库的<strong>交互式分析和处理速度</strong>的问题。</p> <blockquote><p><strong>注意：</strong> <font color="RoyalBlue"><strong>虽然 Presto 可以解析 SQL，但它不是一个标准的数据库。不是 MySQL、Oracle 的代替品，也不能用来处理在线事务（OLTP）</strong></font>。</p></blockquote> <h3 id="_1-2-presto-应用场景"><a href="#_1-2-presto-应用场景" class="header-anchor">#</a> 1.2 Presto 应用场景</h3> <p>        Presto 支持<strong>在线数据查询</strong>，包括 Hive，关系数据库（MySQL、Oracle）以及专有数据存储。一条 Presto 查询可以将<strong>多个数据源的数据进行合并，可以跨越整个组织进行分析</strong>。</p> <p>        Presto 主要用来处理<font color="red"> 响应时间小于 1 秒到几分钟的场景 </font>。</p> <h3 id="_1-3-presto架构"><a href="#_1-3-presto架构" class="header-anchor">#</a> 1.3 Presto架构</h3> <p>        Presto 是一个运行在多台服务器上的分布式系统。完整安装包括一个 <code>Coordinator</code> 和多 个 <code>Worker</code>。由<strong>客户端</strong>提交查询，从 Presto 命令行 CLI 提交到 Coordinator。Coordinator 进行 解析，分析并执行查询计划，然后分发处理队列到 Worker 。
<img src="https://img-blog.csdnimg.cn/20210303231449284.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDMxODgzMA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">
        Presto 有两类服务器：<strong>Coordinator</strong> 和 <strong>Worker</strong></p> <p>        1) <code>Coordinator</code></p> <p><font color="RoyalBlue"><strong>Coordinator 服务器是用来解析语句，执行计划分析和管理 Presto 的 Worker 节点</strong></font>。<strong>Presto 安装必须有一个 Coordinator 和多个 Worker</strong>。如果用于开发环境和测试，则一个 Presto 实例 可以同时担任这两个角色。</p> <p><font color="RoyalBlue"><strong>Coordinator 跟踪每个 Work 的活动情况并协调查询语句的执行</strong></font>。<strong>Coordinator 为每个查询建立模型</strong>，模型包含多个Stage，每个Stage再转为Task 分发到不同的 Worker 上执行。</p> <p>        Coordinator 与 Worker、Client 通信是通过 <strong>REST API</strong>。</p> <p>        2）<code>Worker</code></p> <p><font color="	DarkOrchid"><strong>Worker 是负责执行任务和处理数据</strong></font>。Worker 从 Connector 获取数据。Worker 之间会交换中间数据。Coordinator 是负责从 Worker 获取结果并返回最终结果给 Client。</p> <p><font color="DarkOrchid"><strong>当 Worker 启动时，会广播自己去发现 Coordinator，并告知 Coordinator 它是可用，随 时可以接受 Task</strong></font>。</p> <p>        Worker 与 Coordinator、Worker 通信是通过 <strong>REST API</strong>。</p> <p>        3）数据源</p> <p>        贯穿下文，你会看到一些术语：<strong>Connector</strong>、<strong>Catelog</strong>、<strong>Schema</strong> 和 <strong>Table</strong>。这些是 Presto 特定的<strong>数据源</strong></p> <ul><li><strong>Connector</strong></li></ul> <p><font color="	Tomato"><strong>Connector 是适配器，用于 Presto 和数据源（如 Hive、RDBMS）的连接</strong></font>。你可以认为 类似 <code>JDBC</code> 那样，但却是 Presto 的 SPI 的实现，使用标准的 API 来与不同的数据源交互。</p> <p>        Presto 有几个内建 Connector：JMX 的 Connector、System Connector（用于访问内建的 System table）、Hive 的 Connector、TPCH（用于 TPC-H 基准数据）。还有很多第三方的 Connector，所以 <strong>Presto 可以访问不同数据源的数据</strong>。</p> <p><font color="	Tomato"><strong>每个 Catalog 都有一个特定的 Connecto</strong>r</font>。如果你使用 catelog 配置文件，你会发现每个 文件都必须包含 connector.name 属性，用于指定 catelog 管理器（创建特定的 Connector 使用）。 一个或多个 catelog 用同样的 connector 是访问同样的数据库。例如，你有两个 Hive 集群。 你可以在一个 Presto 集群上配置两个 catelog，两个 catelog 都是用 Hive Connector，从而达 到可以查询两个 Hive 集群。</p> <ul><li><strong>Catelog</strong></li></ul> <p><font color="DarkCyan"><strong>一个 Catelog 包含 Schema 和 Connector</strong></font> 。例如，你配置JMX 的 catelog，通过JXM Connector 访问 JXM 信息。当你<strong>执行一条 SQL 语句时，可以同时运行在多个 catelog</strong>。</p> <p>        Presto 处理 table 时，是通过表的<strong>完全限定（fully-qualified）名</strong>来找到 catelog。例如， 一个表的权限定名是 <code>hive.test_data.test</code>，则 <strong>test</strong> 是表名，<strong>test_data</strong> 是 schema，<strong>hive</strong> 是 catelog。</p> <p>        Catelog 的定义文件是在 Presto 的配置目录中。</p> <ul><li><strong>Schema</strong></li></ul> <p><font color="	MediumSeaGreen"><strong>Schema 是用于组织 table</strong></font>。把 catelog 和 schema 结合在一起来包含一组的表。当通过Presto 访问 hive 或 Mysq 时，一个 schema 会同时转为 hive 和 mysql 的同等概念。</p> <ul><li><strong>Table</strong></li></ul> <p>        Table 跟关系型的表定义一样，但数据和表的映射是交给 Connector。</p> <h3 id="_1-4-presto-数据模型"><a href="#_1-4-presto-数据模型" class="header-anchor">#</a> 1.4 Presto 数据模型</h3> <p>        1）<strong>Presto</strong> 采取三层表结构：</p> <p><code>Catalog</code>：对应某一类数据源，例如 Hive 的数据，或 MySql 的数据</p> <p><code>Schema</code>：对应 MySql 中的数据库</p> <p><code>Table</code>：对应 MySql 中的表</p> <p><img src="https://img-blog.csdnimg.cn/20210303234447546.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDMxODgzMA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <p>&amp;nbsp</p> <p>       2）<strong>Presto</strong> 的存储单元包括：</p> <p><code>Page</code>：多行数据的集合，包含多个列的数据，内部仅提供逻辑行，实际以列式存储。</p> <p><code>Block</code>：一列数据，根据不同类型的数据，通常采取不同的编码方式，了解这些编码方式，有助于自己的存储系统对接 presto。</p> <p><img src="https://img-blog.csdnimg.cn/20210303234614255.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDMxODgzMA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述">
        3）不同类型的 Block：</p> <p>        
        （1）<font color="Tomato"><strong>Array 类型 Block，应用于固定宽度的类型</strong></font>，例如 int，long，double。block 由两部分组成：</p> <ul><li><code>boolean valueIsNull[]</code> <strong>表示每一行是否有值</strong>。</li> <li><code>T values[]</code> <strong>每一行的具体值</strong></li></ul> <p>        （2）<font color="Tomato"><strong>可变宽度的 Block，应用于 String 类数据</strong></font>，由三部分信息组成</p> <ul><li><code>Slice</code>：所有行的数据拼接起来的字符串</li> <li><code>int offsets[]</code>：每一行数据的起始偏移位置。每一行的长度等于下一行的起始偏移减去当 前行的起始偏移。</li> <li><code>boolean valueIsNull[]</code>: 表示某一行是否有值。如果有某一行无值，那么这一行的偏移量 等于上一行的偏移量。</li></ul> <p>        （3）<font color="Tomato"><strong>固定宽度的 String 类型的 block，所有行的数据拼接成一长串 Slice，每一行的长度固定</strong></font>。</p> <p>        （4）<font color="Tomato"><strong>字典 block：对于某些列，distinct 值较少，适合使用字典保存</strong></font>。主要有两部分组成：</p> <p><code>字典</code>，可以是任意一种类型的 block(甚至可以嵌套一个字典 block)，block 中的每一行按照顺序排序编号。</p> <p><code>int ids[]</code>表示每一行数据对应的 value 在字典中的编号。在查找时，首先找到某一行的 id， 然后到字典中获取真实的值。</p> <h3 id="_1-5-presto-优缺点"><a href="#_1-5-presto-优缺点" class="header-anchor">#</a> 1.5 Presto 优缺点</h3> <p>        学习一个新的框架，免不了来探讨一下它的优缺点：</p> <p>        通过下面一张图，我们来看看 Presto 中 SQL 运行过程：<strong>MapReduce vs Presto</strong></p> <p><img src="https://img-blog.csdnimg.cn/20210304000146319.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDMxODgzMA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述">
        我们可以很明显地感受到，<strong><font color="tomato">Presto 使用内存计算，减少与硬盘交互</font></strong></p> <h4 id="_1-5-1-优点"><a href="#_1-5-1-优点" class="header-anchor">#</a> 1.5.1 优点</h4> <p>        1）<font color="RoyalBlue"><strong>Presto 与 Hive 对比，都能够处理 PB 级别的海量数据分析，但 Presto 是基于内存运算，减少没必要的硬盘 IO，所以更快</strong></font>。</p> <p>        2）<font color="RoyalBlue"><strong>能够连接多个数据源，跨数据源连表查，如从 Hive 查询大量网站访问记录，然后从 Mysql 中匹配出设备信息</strong></font>。</p> <p>        3）<font color="RoyalBlue"><strong>部署也比 Hive 简单，因为 Hive 是基于 HDFS 的，需要先部署 HDFS</strong></font>。</p> <p>        找了张对比图，大家感受下：
        
<img src="https://img-blog.csdnimg.cn/20210304000652730.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDMxODgzMA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p> <h4 id="_1-5-2-缺点"><a href="#_1-5-2-缺点" class="header-anchor">#</a> 1.5.2 缺点</h4> <p>        1）<font color="red"><strong>虽然能够处理 PB 级别的海量数据分析，但不是代表 Presto 把 PB 级别都放在内存中计算的</strong></font>。而是根据场景，如 <strong>count，avg</strong> 等聚合运算，是<strong>边读数据边计算，再清内存，再读数据再计算，这种耗的内存并不高</strong>。但是<strong>连表查，就可能产生大量的临时数据，因此速度会变慢，反而 Hive此时会更擅长</strong>。</p> <p>        2）为了达到实时查询，可能会想到用它直连 MySql 来操作查询，这效率并不会提升， 瓶颈依然在 MySql，此时还引入网络瓶颈，所以会比原本直接操作数据库要慢。</p> <h3 id="_1-6-presto、impala性能比较"><a href="#_1-6-presto、impala性能比较" class="header-anchor">#</a> 1.6  Presto、Impala性能比较</h3> <p>        Presto 和 Impala这两种典型的<strong>内存数据库</strong>之间具体的性能测试比较就不详细展开叙述，感兴趣可以去看这篇链接：<a href="https://blog.csdn.net/u012551524/article/details/79124532" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/u012551524/article/details/79124532<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>        我就说下总结的结论：</p> <blockquote><p>他们的共同点就是吃内存，当然在内存充足的情况下，并且有规模适当的集群，性能应该会更可观。并且从几次性能的比较查询来看，<strong>Impala性能稍领先于presto，但是presto在数据源支持上非常丰富</strong>，包括hive、图数据库、传统关系型数据库、Redis等</p></blockquote> <p>        大家也可以根据上面的链接，自己也尝试去做下对比测试。</p> <h3 id="_1-7-官网地址"><a href="#_1-7-官网地址" class="header-anchor">#</a> 1.7 官网地址</h3> <p>        就在 2020 年 12 月 27 日，prestosql 与 facebook 正式分裂,并改名为<code>trino</code>。分裂之前和之后的官网分别是：<a href="https://prestosql.io/" target="_blank" rel="noopener noreferrer">https://prestosql.io/ <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>和 <a href="https://trino.io" target="_blank" rel="noopener noreferrer">https://trino.io<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p><img src="https://img-blog.csdnimg.cn/20210308230927511.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDMxODgzMA==,size_16,color_FFFFFF,t_70" alt="最新的官网"></p> <h3 id="_1-8-prestodb-vs-prestosql-trino"><a href="#_1-8-prestodb-vs-prestosql-trino" class="header-anchor">#</a> 1.8 Prestodb VS Prestosql(trino)</h3> <p>        根据目前社区活跃度和使用广泛度,更加推荐 prestosql。具体的区别详见：</p> <p><a href="http://armsword.com/2020/05/02/the-difference-between-prestodb-and-prestosql/" target="_blank" rel="noopener noreferrer">http://armsword.com/2020/05/02/the-difference-between-prestodb-and-prestosql/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_2-presto安装部署"><a href="#_2-presto安装部署" class="header-anchor">#</a> 2. Presto安装部署</h2> <h3 id="_2-1-prestosql-版本的选择"><a href="#_2-1-prestosql-版本的选择" class="header-anchor">#</a> 2.1 prestosql 版本的选择</h3> <p>        在 presto330 版本里已经提到，jdk8 只支持到 2020-03 月发行的版本.详情参考:
<a href="https://prestosql.io/docs/current/release/release-330.html" target="_blank" rel="noopener noreferrer">https://prestosql.io/docs/current/release/release-330.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。在 2020 年 4 月 8 号 presto 社区发布的 332 版本开始，需要 jdk11 的版本.由于现在基本都使 用的是 jdk8，所以我们选择 presto315 版本的,此版本在 jdk8 的环境下是可用的。如果我们生产环境是 jdk8，但是又想使用新版的 presto，可以为 presto 单独指定 jdk11 也可使用。</p> <h3 id="_2-2-集群安装规划"><a href="#_2-2-集群安装规划" class="header-anchor">#</a> 2.2 集群安装规划</h3> <table><thead><tr><th>host</th> <th>coordinator</th> <th>worker</th></tr></thead> <tbody><tr><td>node01</td> <td>√</td> <td>×</td></tr> <tr><td>node02</td> <td>×</td> <td>√</td></tr> <tr><td>node03</td> <td>×</td> <td>√</td></tr></tbody></table> <h3 id="_2-3-presto-server-的安装"><a href="#_2-3-presto-server-的安装" class="header-anchor">#</a> 2.3 Presto Server 的安装</h3> <p>        1、安装包下载地址：</p> <blockquote><p>https://repo1.maven.org/maven2/io/prestosql/presto-server/315/presto-server-315.tar.gz</p></blockquote> <p>        2、将 <code>presto-server-315.tar.gz</code> 上传到服务器上,这里导入到 node01 服务器上的 <code>/export/software/</code>目录下，并解压至 <code>/export/servers/</code>目录下：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node01 software<span class="token punctuation">]</span><span class="token comment"># tar -zvxf presto-server-315.tar.gz -C /export/servers/</span>
</code></pre></div><p>        3、创建 presto 的数据目录 ( <strong>presto 集群的每台机器都要创建</strong>)，用来存储日志这些</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node01 presto-server-315<span class="token punctuation">]</span><span class="token comment"># mkdir -p /file/data/presto</span>
</code></pre></div><p>        4、在安装目录 /export/servers/presto-server-315 下创建 etc 目录,用来存放各种配置文件</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>node01@node01 presto-server-315<span class="token punctuation">]</span><span class="token comment"># mkdir etc</span>
</code></pre></div><h3 id="_2-4-node-properties-配置"><a href="#_2-4-node-properties-配置" class="header-anchor">#</a> 2.4 Node Properties 配置</h3> <p>        在 <code>/export/servers/presto-server-315/etc</code> 路径下,配置 node 属性(注意：<strong>集群中每台 presto 的 node.id 必须不一样</strong>,后面需要修改集群中其它节点的 node.id 值)</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node01 etc<span class="token punctuation">]</span><span class="token comment"># vim node.properties</span>
<span class="token comment">#环境名称,自己任取.集群中的所有 Presto 节点必须具有相同的环境名称.</span>
node.environment<span class="token operator">=</span>develop
<span class="token comment">#支持字母,数字.对于每个节点,这必须是唯一的.这个标识符应该在重新启动或升级 Presto 时保持一致</span>
node.id<span class="token operator">=</span><span class="token number">1</span>
<span class="token comment">#指定 presto 的日志和其它数据的存储目录,自己创建前面创建好的数据目录</span>
node.data-dir<span class="token operator">=</span>/file/data/presto
</code></pre></div><h3 id="_2-5-jvm-config-配置"><a href="#_2-5-jvm-config-配置" class="header-anchor">#</a> 2.5 JVM Config 配置</h3> <p>        在<code>/exports/servers/presto-server-315/etc</code> 目录下添加 <strong>jvm.config</strong> 配置文件,并填入如下内容</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#参考官方给的配置,根据自身机器实际内存进行配置</span>
-server
<span class="token comment">#最大 jvm 内存</span>
-Xmx16G
<span class="token comment">#指定 GC 的策略</span>
-XX:+UseG1GC
-XX:G1HeapRegionSize<span class="token operator">=</span>32M
-XX:+UseGCOverheadLimit
-XX:+ExplicitGCInvokesConcurrent
-XX:+HeapDumpOnOutOfMemoryError
-XX:+ExitOnOutOfMemoryError
-XX:ReservedCodeCacheSize<span class="token operator">=</span>256M
</code></pre></div><h3 id="_2-6-config-properties-配置"><a href="#_2-6-config-properties-配置" class="header-anchor">#</a> 2.6 Config Properties 配置</h3> <p>        Presto 是由一个 <code>coordinator</code> 节点和多个 <code>worker</code> 节点组成。由于在单独一台服务器上配置 coordinator ，有利于提高性能，所以在 node01上配置成 coordinator，在 node02,node03 上配 置为 worker(如果实际机器数量不多的话可以将在协调器上部署 worker.)在 <code>/export/servers/presto-server-315/etc</code>目录下添加 <strong>config.properties</strong> 配置文件</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 该节点是否作为 coordinator,如果是 true 就允许该 Presto 实例充当协调器</span>
<span class="token assign-left variable">coordinator</span><span class="token operator">=</span>true
<span class="token comment"># 允许在协调器上调度工作(即配置 worker 节点).为 false 就是不允许.对于较大的集群,协调器上的处理工作可能会影响查询性能,因为机器的资源无法用于调度,管理和监视查询执行的关键任务</span>
<span class="token comment"># 如果需要在协调器所在节点配置 worker 节点改为 true 即可</span>
node-scheduler.include-coordinator<span class="token operator">=</span>false
<span class="token comment"># 指定 HTTP 服务器的端口.Presto 使用 HTTP 进行所有内部和外部通信</span>
http-server.http.port<span class="token operator">=</span><span class="token number">8080</span>
<span class="token comment"># 每个查询可以使用的最大分布式内存量</span>
query.max-memory<span class="token operator">=</span>50GB
<span class="token comment">#查询可在任何一台计算机上使用的最大用户内存量</span>
query.max-memory-per-node<span class="token operator">=</span>1GB
<span class="token comment"># 查询可在任何一台计算机上使用的最大用户和系统内存量，其中系统内存是读取器，写入器和网络缓冲区等在执行期间使用的内存</span>
query.max-total-memory-per-node<span class="token operator">=</span>2GB
<span class="token comment"># discover-server 是 coordinator 内置的服务,负责监听 worker</span>
discovery-server.enabled<span class="token operator">=</span>true
<span class="token comment"># 发现服务器的 URI.因为已经在 Presto 协调器中启用了 discovery,所以这应该是 Presto 协调器的 URI</span>
discovery.uri<span class="token operator">=</span>http://node01:8080
</code></pre></div><h3 id="_2-7-log-properties-配置"><a href="#_2-7-log-properties-配置" class="header-anchor">#</a> 2.7 Log Properties 配置</h3> <p>        日志配置文件：<code>etc/log.properties</code>。类似Java的日志级别，包括 <code>INFO</code>、<code>DEBUG</code>、<code>ERROR</code>。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>com.facebook.presto<span class="token operator">=</span>INFO
</code></pre></div><h3 id="_2-8-catalog-properties-配置"><a href="#_2-8-catalog-properties-配置" class="header-anchor">#</a> 2.8 Catalog Properties 配置</h3> <p>        Presto 可以支持多个数据源，在 Presto 里面叫 catalog，这里以配置支持 Hive 的数据源为例，配置一个 Hive 的 catalog ：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#在 etc 目录下创建 catalog 目录 </span>
<span class="token punctuation">[</span>root@node01 etc<span class="token punctuation">]</span><span class="token comment"># mkdir catalog</span>
</code></pre></div><p><strong>Hive 的 catalog:</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node01 catalog<span class="token punctuation">]</span><span class="token comment"># vim hive.properties</span>
<span class="token comment">#代表 hadoop2 代版本,并不是单单指 hadoop2.x 的版本,而是 hadoop 第二代.固定写法</span>
connector.name<span class="token operator">=</span>node02
<span class="token comment">#指定 hive 的 metastore 的地址(hive 必须启用 metastore)</span>
hive.metastore.uri<span class="token operator">=</span>thrift://node01:9083
<span class="token comment">#如果 hdfs 是高可用必须增加这个配置.如果不是高可用,可省略.如果 Presto 所在的节点&gt;没 有安装 Hadoop,需要从其它 hadoop 节点复制这些文件到 Presto 的节点</span>
hive.config.resources<span class="token operator">=</span>/export/servers/hadoop-2.6.0-cdh5.14.0/etc/hadoop/core-site.xml, /export/servers/hadoop-2.6.0-cdh5.14.0/etc/hadoop/hdfs-site.xml
hive.allow-drop-table<span class="token operator">=</span>true
hive.storage-format<span class="token operator">=</span>ORC
hive.metastore-cache-ttl<span class="token operator">=</span>1s
hive.metastore-refresh-interval<span class="token operator">=</span>1s
hive.metastore-timeout<span class="token operator">=</span>35m
hive.max-partitions-per-writers<span class="token operator">=</span><span class="token number">1000</span>
</code></pre></div><h3 id="_2-9-分发安装目录到集群中其它节点上"><a href="#_2-9-分发安装目录到集群中其它节点上" class="header-anchor">#</a> 2.9 分发安装目录到集群中其它节点上</h3> <p>        将 node01 上配置好的 presto 安装包分发到集群中的其它节点(这里使用的是自己写的分发脚本)</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node01 servers<span class="token punctuation">]</span><span class="token comment"># xsync script /export/servers/presto-server-315/</span>
</code></pre></div><h3 id="_2-10-修改-node-id"><a href="#_2-10-修改-node-id" class="header-anchor">#</a> 2.10 修改 node.id</h3> <p>        修改 node02 和 node03 机器上 <strong>node.properties</strong> 配置文件中的 <strong>node.id</strong> (因为每台机器 node.id 必须要不一样)</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node02 etc<span class="token punctuation">]</span><span class="token comment"># vim node.properties </span>
node.id<span class="token operator">=</span><span class="token number">2</span> 

<span class="token punctuation">[</span>root@node03 etc<span class="token punctuation">]</span><span class="token comment"># vim node.properties </span>
node.id<span class="token operator">=</span><span class="token number">3</span>
</code></pre></div><h3 id="_2-11-修改-work-节点的配置信息"><a href="#_2-11-修改-work-节点的配置信息" class="header-anchor">#</a> 2.11 修改 work 节点的配置信息</h3> <p>        修改 worker 节点(即 linux122 和 linux123 机器)上的 <strong>config.properties</strong> 配置文件里面的配置内容与 <strong>coordinator</strong> 所在的节点是不一样的</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#该节点是否作为 coordinator,因为是 worker 节点,这里是 false</span>
<span class="token assign-left variable">coordinator</span><span class="token operator">=</span>false
<span class="token comment">#访问端口,可以自己指定</span>
http-server.http.port<span class="token operator">=</span><span class="token number">8080</span>
<span class="token comment">#每个查询可以使用的最大分布式内存量</span>
query.max-memory<span class="token operator">=</span>50GB
<span class="token comment">#查询可在任何一台计算机上使用的最大用户内存量</span>
query.max-memory-per-node<span class="token operator">=</span>1GB
<span class="token comment">#查询可在任何一台计算机上使用的最大用户和系统内存量，其中系统内存是读取器，写 入器和网络缓冲区等在执行期间使用的内存</span>
query.max-total-memory-per-node<span class="token operator">=</span>2GB
<span class="token comment">#指定 discovery-server 的地址,这样 worker 才能找到它.与上面的端口须一致</span>
discovery.uri<span class="token operator">=</span>http://node01:8080
</code></pre></div><h3 id="_2-12-启动服务"><a href="#_2-12-启动服务" class="header-anchor">#</a> 2.12 启动服务</h3> <p>        启动脚本在安装目录的<code>bin/launcher</code>目录下，我们可以使用如下命令作为一个后台进程启动：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>bin/launcher start
</code></pre></div><p>        另外，也可以用在前台启动的方式运行，日志和目录输出将会写入到 <code>stdout/stderr</code>（可以使用类似<code>daemontools</code>的工具捕捉这两个数据流）</p> <div class="language-bash extra-class"><pre class="language-bash"><code>bin/launcher run
</code></pre></div><p>        启动完之后，日志将会写在<code>var/log</code>目录下，该目录下有如下文件：</p> <ul><li><code>launcher.log</code>：这个日志文件由 <strong>launcher</strong> 创建，并且server的stdout和stderr都被重定向到了这个日志文件中。这份日志文件中只会有很少的信息，包括：</li></ul> <p>        在server日志系统初始化的时候产生的日志和JVM产生的诊断和测试信息。</p> <p><code>server.log</code>：这个是 Presto 使用的主要日志文件。一般情况下，该文件中将会包括<strong>server初始化失败时产生的相关信息</strong>。</p> <p><code>http-request.log</code>： 这是<strong>HTTP请求的日志文件</strong>，包括server收到的每个HTTP请求信息。</p> <p>        启动成功之后，我们可以通过<code>jps</code>查看到多了一个 PrestoServer 的进程。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node01 etc<span class="token punctuation">]</span><span class="token comment"># jps</span>
<span class="token number">6051</span> PrestoServer
</code></pre></div><p>        此时我们就可以通过<code>ip:端口</code>的方式访问到 presto 的 <strong>webui</strong> 界面。</p> <p><img src="https://img-blog.csdnimg.cn/20210308234248293.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDMxODgzMA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">
        关于 <code>webui</code> 中<strong>各项指标的含义</strong>，我整理了2张图，大家可以借鉴一下</p> <p><img src="https://img-blog.csdnimg.cn/20210312160025787.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDMxODgzMA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <p><img src="https://img-blog.csdnimg.cn/20210312161811830.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDMxODgzMA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">
        另外，关于 Stage，Task 阶段的各参数指标含义，就不细讲了，更多内容详情见官网....</p> <h2 id="_3、presto-命令行-client-的安装"><a href="#_3、presto-命令行-client-的安装" class="header-anchor">#</a> 3、Presto 命令行 Client 的安装</h2> <p>        Presto 的 命令行 Client 下载步骤也很简单：</p> <p>        1、下载 Presto 的客户端（下载 presto 对应的版本）👉<a href="https://repo1.maven.org/maven2/io/prestosql/presto-cli/315/presto-cli-315-executable.jar" target="_blank" rel="noopener noreferrer">https://repo1.maven.org/maven2/io/prestosql/presto-cli/315/presto-cli-315-executable.jar<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>        2、将 <code>presto-cli-315-executable.jar</code> 上传至服务器,放在 node01 的 <code>/export/servers/presto-server- 315/bin</code> 目录下</p> <p>        3、为方便使用，修改 jar 包名称为 presto</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node01 bin<span class="token punctuation">]</span>$ <span class="token function">mv</span> presto-cli-315-executable.jar presto
</code></pre></div><p>        4. 给文件增加执行权限</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node01 bin<span class="token punctuation">]</span><span class="token comment"># chmod +x presto</span>
</code></pre></div><h2 id="_4、presto-的基本使用"><a href="#_4、presto-的基本使用" class="header-anchor">#</a> 4、Presto 的基本使用</h2> <p>        1、 启动 presto 客户端并选择连接的数据源(这里以 hive 为例)</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node01 bin<span class="token punctuation">]</span>$ ./presto <span class="token punctuation">\</span> 
--server node01:8080 <span class="token punctuation">\</span> 
--catalog hive <span class="token punctuation">\</span><span class="token punctuation">(</span>可选<span class="token punctuation">)</span> 
--schema <span class="token builtin class-name">test</span> <span class="token punctuation">\</span><span class="token punctuation">(</span>可选<span class="token punctuation">)</span> 
--user xiaobai <span class="token punctuation">(</span>可选<span class="token punctuation">)</span>
</code></pre></div><p><strong>说明</strong>:
--  server 指定的是 <code>coordinator</code> 的地址
-- catalog 指定的是<strong>连接的数据源</strong>.(跟配置文件里面的名称一致)
-- schema 指定的是<strong>连接哪个数据库</strong>,这里是 test 数据库
-- user 指定的是<strong>连接使用哪个用户</strong>,这里是xiaobai</p> <p>        2、Presto 命令行操作</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#查看所有的数据库 </span>
presto:test<span class="token operator">&gt;</span> show schemas<span class="token punctuation">;</span> 
<span class="token comment">#查看某个库下的所有表 </span>
presto:test<span class="token operator">&gt;</span> show tables<span class="token punctuation">;</span> 
<span class="token comment">#查看一条 sql 查询(6 亿多条数据比 hive 快很多) </span>
presto:test<span class="token operator">&gt;</span> <span class="token keyword">select</span> count<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> from test.test_hive<span class="token punctuation">;</span> 
_col0 
----------- 
<span class="token number">620756992</span>
</code></pre></div><h2 id="_5、presto可视化客户端的安装"><a href="#_5、presto可视化客户端的安装" class="header-anchor">#</a> 5、Presto可视化客户端的安装</h2> <p>        Presto 可视化客户端有多种，这里我们选择使用 <code>yanagishima-20.0</code> 版本</p> <blockquote><p>本篇文章中谈到的<strong>所有</strong>安装包资源，在公众号【大数据梦想家】后台回复 “presto”即可获得！</p></blockquote> <ul><li>1、将 yanagishima-20.0.zip 安装包上传至 linux121 服务器上</li> <li>2、解压 yanagishima-20.0.zip 安装包</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node01 software<span class="token punctuation">]</span><span class="token comment"># unzip yanagishima-20.0.zip -d /export/servers/</span>
</code></pre></div><ul><li>3、.进入到 <code>/opt/servers/yanagishima-20.0/conf/</code>目录下,修改 <strong>yanagishima.properties</strong> 配置文件</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#指定 jetty 的端口,类似 tomcat 的 web 容器的一个组件</span>
jetty.port<span class="token operator">=</span><span class="token number">7788</span>
<span class="token comment">#指定数据源</span>
presto.datasources<span class="token operator">=</span>presto_test
presto.coordinator.server.presto_test<span class="token operator">=</span>http://node01:8080
catalog.presto_test<span class="token operator">=</span>hive
schema.presto_test<span class="token operator">=</span>ods
sql.query.engines<span class="token operator">=</span>presto
</code></pre></div><ul><li>4、启动 yanagishima</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node01 yanagishima-20.0<span class="token punctuation">]</span><span class="token comment"># nohup bin/yanagishima-start.sh 1&gt;/dev/null 2&gt;&amp;1 &amp;</span>
</code></pre></div><ul><li>5、webUI访问界面</li></ul> <p>        通过<code>http://node01:7788/</code>，即可查询到相关信息</p> <ul><li>6、查看 Presto 表结构，如下图所示：</li></ul> <p><img src="https://img-blog.csdnimg.cn/20210313222843492.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDMxODgzMA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <p>        在“Treeview”页面下可以查看所有表的结构，包括<code>Schema</code>，<code>Table</code>，<code>Column</code>等。</p> <p>        比如，执行<code>SELECT * FROM hive.company.&quot;action&quot; LIMIT 100</code></p> <p>        每张表后面都有一个复制图标，单击此图标可以复制完整的表名，然后在上面的文本框中输入 SQL 语句 即可，如图所示：
<img src="https://img-blog.csdnimg.cn/20210313222946672.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDMxODgzMA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">
        还可以查询列表中其他的表格，比如，想要执行现在已经写好了的SQL语句，<code>SELECT * FROM hive.company.&quot;demo01&quot; LIMIT 100</code>，按<code>Ctrl + Enter</code>组合键显示<strong>查询结果</strong>，如图所示：
<img src="https://img-blog.csdnimg.cn/20210313223146337.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDMxODgzMA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">
        当然，我们也可以通过<code>Query List</code>模块查询我们执行过的SQL详细信息，包括<code>State</code>，<code>query ID</code>，<code>Elapsed</code>，<code>Query</code>，<code>Source</code>，<code>User</code>....</p> <p>        更多使用，就不一一剧透介绍，小伙伴们可以自行去研究~</p> <h2 id="_6、presto的优化"><a href="#_6、presto的优化" class="header-anchor">#</a> 6、Presto的优化</h2> <p>        Presto 的优化是一个非常有水平的问题，大致总结下，分如下几个类别：</p> <h3 id="_6-1-数据存储"><a href="#_6-1-数据存储" class="header-anchor">#</a> 6.1 数据存储</h3> <p>        想要使用 Presto 更高效地查询数据，需要在数据存储方面利用一些优化手段。</p> <h4 id="_6-1-1-合理设置分区"><a href="#_6-1-1-合理设置分区" class="header-anchor">#</a> 6.1.1 合理设置分区</h4> <p>        与 Hive 类似，Presto 会根据元数据信息读取分区数据，<strong>合理地设置分区</strong>能减少 Presto 数据读取量，提升查询性能。</p> <h4 id="_6-1-2-使用-orc-格式存储"><a href="#_6-1-2-使用-orc-格式存储" class="header-anchor">#</a> 6.1.2 使用 ORC 格式存储</h4> <p>        Presto 对 ORC文件 读取进行了特定优化，因此，<strong>在 Hive 中创建 Presto 使用的表时，建议采用 ORC 格式存储</strong>。相对于 Parquet 格式，Presto 对 ORC 格式支持得更好。</p> <h4 id="_6-1-3-使用压缩"><a href="#_6-1-3-使用压缩" class="header-anchor">#</a> 6.1.3 使用压缩</h4> <p><strong>数据压缩可以减少节点间数据传输对 IO 带宽的压力</strong>，对于即席查询需要快速解压，建议采用 <code>Snappy</code>压缩。</p> <h4 id="_6-1-4-预先排序"><a href="#_6-1-4-预先排序" class="header-anchor">#</a> 6.1.4 预先排序</h4> <p>        对于已经排序的数据，在查询的数据过滤阶段，ORC格式支持跳过读取不必要的数据。比如对于经常需要过滤的字段可以预先排序。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">table</span> nation_orc <span class="token keyword">partition</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> nation SORT <span class="token keyword">BY</span> n_name<span class="token punctuation">;</span>
</code></pre></div><p>        如果需要过滤 n_name 字段，则性能将提升。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> nation_orc <span class="token keyword">WHERE</span> n_name<span class="token operator">=</span>’AUSTRALIA’<span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-2-sql查询"><a href="#_6-2-sql查询" class="header-anchor">#</a> 6.2 SQL查询</h3> <p>        想要使用 <code>Presto</code>更高效地查询数据，需要在编写查询SQL语句方面利用一些优化手段。</p> <h4 id="_6-2-1-只选择需要的字段"><a href="#_6-2-1-只选择需要的字段" class="header-anchor">#</a> 6.2.1 只选择需要的字段</h4> <p>        由于采用列式存储，所以<strong>只选择需要的字段可加快字段的读取速度，减少数据量</strong>。避免采用 * 读取所有字段。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>GOOD<span class="token punctuation">]</span>: SELECT time,user,host FROM tbl
<span class="token punctuation">[</span>BAD<span class="token punctuation">]</span>:  SELECT * FROM tbl
</code></pre></div><h4 id="_6-2-2-过滤条件必须加上分区字段"><a href="#_6-2-2-过滤条件必须加上分区字段" class="header-anchor">#</a> 6.2.2 过滤条件必须加上分区字段</h4> <p><strong>对于有分区的表，where语句中优先使用分区字段进行过滤</strong>。acct_day 是分区字段，visit_time 是具体访问时间。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token punctuation">[</span>GOOD<span class="token punctuation">]</span>: <span class="token keyword">SELECT</span> <span class="token keyword">time</span><span class="token punctuation">,</span><span class="token keyword">user</span><span class="token punctuation">,</span>host <span class="token keyword">FROM</span> tbl <span class="token keyword">where</span> acct_day<span class="token operator">=</span><span class="token number">20171101</span>
<span class="token punctuation">[</span>BAD<span class="token punctuation">]</span>:  <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl <span class="token keyword">where</span> visit_time<span class="token operator">=</span><span class="token number">20171101</span>
</code></pre></div><h4 id="_6-2-3-group-by语句优化"><a href="#_6-2-3-group-by语句优化" class="header-anchor">#</a> 6.2.3 Group By语句优化</h4> <p>        合理安排 <code>Group by</code>语句中<strong>字段顺序对性能有一定提升</strong>。将 Group By 语句中字段按照每个字段 distinct 数据多少进行降序排列。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token punctuation">[</span>GOOD<span class="token punctuation">]</span>: <span class="token keyword">SELECT</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> uid<span class="token punctuation">,</span> gender
<span class="token punctuation">[</span>BAD<span class="token punctuation">]</span>:  <span class="token keyword">SELECT</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> gender<span class="token punctuation">,</span> uid
</code></pre></div><h4 id="_6-2-4-order-by时使用limit"><a href="#_6-2-4-order-by时使用limit" class="header-anchor">#</a> 6.2.4 Order by时使用Limit</h4> <p>        Order by 需要扫描数据到单个 worker 节点进行排序，导致单个worker需要大量内存。<strong>如果是查询 Top N 或者 Bottom N，使用 limit 可减少排序计算和内存压力</strong>。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token punctuation">[</span>GOOD<span class="token punctuation">]</span>: <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token keyword">time</span> <span class="token keyword">LIMIT</span> <span class="token number">100</span>
<span class="token punctuation">[</span>BAD<span class="token punctuation">]</span>:  <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token keyword">time</span>
</code></pre></div><h4 id="_6-2-5-使用近似聚合函数"><a href="#_6-2-5-使用近似聚合函数" class="header-anchor">#</a> 6.2.5 使用近似聚合函数</h4> <p>        Presto有一些近似聚合函数，对于<strong>允许有少量误差</strong>的查询场景，使用这些函数<strong>对查询性能有大幅提升</strong>。比如使用<code>approx_distinct()</code>函数比<code>Count(distinct x)</code>有大概2.3%的误差。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> approx_distinct<span class="token punctuation">(</span>user_id<span class="token punctuation">)</span> <span class="token keyword">FROM</span> access
</code></pre></div><h4 id="_6-2-6-用regexp-like代替多个like语句"><a href="#_6-2-6-用regexp-like代替多个like语句" class="header-anchor">#</a> 6.2.6 用regexp_like代替多个like语句</h4> <p>        Presto查询优化器没有对多个 <code>like</code> 语句进行优化，使用<code>regexp_like</code>对性能有较大提升。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token punctuation">[</span>GOOD<span class="token punctuation">]</span>
<span class="token keyword">SELECT</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span>
  access
<span class="token keyword">WHERE</span>
  regexp_like<span class="token punctuation">(</span>method<span class="token punctuation">,</span> <span class="token string">'GET|POST|PUT|DELETE'</span><span class="token punctuation">)</span>

<span class="token punctuation">[</span>BAD<span class="token punctuation">]</span>
<span class="token keyword">SELECT</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span>
  access
<span class="token keyword">WHERE</span>
  method <span class="token operator">LIKE</span> <span class="token string">'%GET%'</span> <span class="token operator">OR</span>
  method <span class="token operator">LIKE</span> <span class="token string">'%POST%'</span> <span class="token operator">OR</span>
  method <span class="token operator">LIKE</span> <span class="token string">'%PUT%'</span> <span class="token operator">OR</span>
  method <span class="token operator">LIKE</span> <span class="token string">'%DELETE%'</span>
</code></pre></div><h4 id="_6-2-7-使用join语句时将大表放在左边"><a href="#_6-2-7-使用join语句时将大表放在左边" class="header-anchor">#</a> 6.2.7 使用Join语句时将大表放在左边</h4> <p>        Presto中 join 的默认算法是<code>broadcast join</code>，即将 join 左边的表分割到多个 worker ，然后将join 右边的表数据整个复制一份发送到每个worker进行计算。如果右边的表数据量太大，则可能会报内存溢出错误。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token punctuation">[</span>GOOD<span class="token punctuation">]</span> <span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FROM</span> large_table l <span class="token keyword">join</span> small_table s <span class="token keyword">on</span> l<span class="token punctuation">.</span>id <span class="token operator">=</span> s<span class="token punctuation">.</span>id
<span class="token punctuation">[</span>BAD<span class="token punctuation">]</span> <span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FROM</span> small_table s <span class="token keyword">join</span> large_table l <span class="token keyword">on</span> l<span class="token punctuation">.</span>id <span class="token operator">=</span> s<span class="token punctuation">.</span>id
</code></pre></div><h4 id="_6-2-8-使用rank函数代替row-number函数来获取top-n"><a href="#_6-2-8-使用rank函数代替row-number函数来获取top-n" class="header-anchor">#</a> 6.2.8 使用Rank函数代替row_number函数来获取Top N</h4> <p>        在进行一些分组排序场景时，使用rank函数性能更好</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token punctuation">[</span>GOOD<span class="token punctuation">]</span>
<span class="token keyword">SELECT</span> checksum<span class="token punctuation">(</span>rnk<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span> rank<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> l_orderkey<span class="token punctuation">,</span> l_partkey <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> l_shipdate <span class="token keyword">DESC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> rnk
  <span class="token keyword">FROM</span> lineitem
<span class="token punctuation">)</span> t
<span class="token keyword">WHERE</span> rnk <span class="token operator">=</span> <span class="token number">1</span>

<span class="token punctuation">[</span>BAD<span class="token punctuation">]</span>
<span class="token keyword">SELECT</span> checksum<span class="token punctuation">(</span>rnk<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span> row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> l_orderkey<span class="token punctuation">,</span> l_partkey <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> l_shipdate <span class="token keyword">DESC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> rnk
  <span class="token keyword">FROM</span> lineitem
<span class="token punctuation">)</span> t
<span class="token keyword">WHERE</span> rnk <span class="token operator">=</span> <span class="token number">1</span>
</code></pre></div><h3 id="_6-3-注意事项"><a href="#_6-3-注意事项" class="header-anchor">#</a> 6.3 注意事项</h3> <p><code>ORC</code>和<code>Parquet</code> 都支持<strong>列式存储</strong>，但是<strong>ORC对Presto支持更好</strong>（Parquet对Impala支持更好）</p> <p>        对于列式存储而言，存储文件为二进制的，对于经常增删字段的表，建议不要使用列式存储（修改文件元数据代价大）。对比数据仓库，<strong>dwd层建议不要使用ORC，而dm层则建议使用</strong>。</p> <h3 id="_6-4-可能会踩的坑"><a href="#_6-4-可能会踩的坑" class="header-anchor">#</a> 6.4 可能会踩的坑</h3> <p>        使用 Presto 需要注意如下几点：</p> <blockquote><p>引用：https://segmentfault.com/a/1190000013120454?utm_source=tag-newest</p></blockquote> <h4 id="_6-4-1-如何加快在presto上的数据统计"><a href="#_6-4-1-如何加快在presto上的数据统计" class="header-anchor">#</a> 6.4.1 如何加快在Presto上的数据统计</h4> <p>        很多的时候，在Presto上对数据库跨库查询，例如Mysql数据库。这个时候Presto的做法是从MySQL数据库端拉取最基本的数据，然后再去做进一步的处理，例如统计等聚合操作。</p> <p>        举个例子：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>SELECT count<span class="token punctuation">(</span>id<span class="token punctuation">)</span> FROM table_1 WHERE <span class="token assign-left variable">condition</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><p>        上面的SQL语句会分为3个步骤进行：</p> <p>        （1）Presto发起到Mysql数据库进行查询</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> table_1 <span class="token keyword">WHERE</span> condition<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><p>        （2）对结果进行count计算</p> <p>        （3）返回结果</p> <p>        所以说，对于Presto来说，其跨库查询的瓶颈是在数据拉取这个步骤。若要提高数据统计的速度，可考虑<strong>把 Mysql 中相关的数据表定期转移到HDFS中，并转存为高效的列式存储格式ORC</strong>。</p> <p>        所以定时归档是一个很好的选择，这里还要注意，在归档的时候我们要选择一个归档字段，如果是按日归档，我们可以用日期作为这个字段的值，采用<code>yyyyMMdd</code>的形式，例如<code>20180123</code>.</p> <p>        一般创建归档数据库的SQL语句如下：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> table_1 <span class="token punctuation">(</span>
id <span class="token keyword">INTEGER</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
partition_date <span class="token keyword">INTEGER</span>
<span class="token punctuation">)</span><span class="token keyword">WITH</span> <span class="token punctuation">(</span> format <span class="token operator">=</span> <span class="token string">'ORC'</span><span class="token punctuation">,</span> partitioned_by <span class="token operator">=</span> ARRAY<span class="token punctuation">[</span><span class="token string">'partition_date'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>        查看创建的库结构：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>SHOW CREATE TABLE table_1<span class="token punctuation">;</span> /*Only Presto*/
</code></pre></div><p>        带有分区的表创建完成之后，每天只要更新分区字段<code>partition_date</code>就可以了，聪明的Presto 就能将数据放置到规划好的分区了。</p> <p>        如果要查看一个数据表的分区字段是什么，可以下面的语句：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SHOW</span> PARTITIONS <span class="token keyword">FROM</span> table_1 <span class="token comment">/*Only Presto*/</span>
</code></pre></div><h4 id="_6-4-2-查询条件中尽量带上分区字段进行过滤"><a href="#_6-4-2-查询条件中尽量带上分区字段进行过滤" class="header-anchor">#</a> 6.4.2 查询条件中尽量带上分区字段进行过滤</h4> <p>        如果数据被规当到 HDFS 中，并带有分区字段。在每次查询归档表的时候，要带上分区字段作为过滤条件，这样可以加快查询速度。因为<strong>有了分区字段作为查询条件，就能帮助Presto避免全区扫描，减少Presto需要扫描的HDFS的文件数</strong>。</p> <h4 id="_6-4-3-多多使用-with-语句"><a href="#_6-4-3-多多使用-with-语句" class="header-anchor">#</a> 6.4.3 多多使用 WITH 语句</h4> <p>        使用 Presto 分析统计数据时，可考虑把多次查询合并为一次查询，用 Presto 提供的子查询完成。</p> <p>        这点和我们熟知的MySQL的使用不是很一样。</p> <p>        例如：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">WITH</span> subquery_1 <span class="token keyword">AS</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> a1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> a3 
    <span class="token keyword">FROM</span> Table_1 
    <span class="token keyword">WHERE</span> a3 <span class="token operator">between</span> <span class="token number">20180101</span> <span class="token operator">and</span> <span class="token number">20180131</span>
<span class="token punctuation">)</span><span class="token punctuation">,</span>               <span class="token comment">/*子查询subquery_1,注意：多个子查询需要用逗号分隔*/</span>
subquery_2 <span class="token keyword">AS</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> b1<span class="token punctuation">,</span> b2<span class="token punctuation">,</span> b3
    <span class="token keyword">FROM</span> Table_2
    <span class="token keyword">WHERE</span> b3 <span class="token operator">between</span> <span class="token number">20180101</span> <span class="token operator">and</span> <span class="token number">20180131</span>
<span class="token punctuation">)</span>                <span class="token comment">/*最后一个子查询后不要带逗号，不然会报错。*/</span>        
<span class="token keyword">SELECT</span> 
    subquery_1<span class="token punctuation">.</span>a1<span class="token punctuation">,</span> subquery_1<span class="token punctuation">.</span>a2<span class="token punctuation">,</span> 
    subquery_2<span class="token punctuation">.</span>b1<span class="token punctuation">,</span> subquery_2<span class="token punctuation">.</span>b2
<span class="token keyword">FROM</span> subquery_1
    <span class="token keyword">JOIN</span> subquery_2
    <span class="token keyword">ON</span> subquery_1<span class="token punctuation">.</span>a3 <span class="token operator">=</span> subquery_2<span class="token punctuation">.</span>b3<span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-4-4-利用子查询-减少读表的次数-尤其是大数据量的表"><a href="#_6-4-4-利用子查询-减少读表的次数-尤其是大数据量的表" class="header-anchor">#</a> 6.4.4 利用子查询，减少读表的次数，尤其是大数据量的表</h4> <p>        具体做法是，将使用频繁的表作为一个子查询抽离出来，避免多次 read。</p> <h4 id="_6-4-5-只查询需要的字段"><a href="#_6-4-5-只查询需要的字段" class="header-anchor">#</a> 6.4.5 只查询需要的字段</h4> <p>        一定要避免在查询中使用 SELECT * 这样的语句，就像只有告诉我们需要查询数据越具体，工作效率越高。</p> <p>        对于我们的数据库而言也是这样，任务越明确，工作效率越高。</p> <p>        对于要查询全部字段的需求也是这样，没有偷懒的捷径，把它们都写出来。</p> <h4 id="_6-4-6-join查询优化"><a href="#_6-4-6-join查询优化" class="header-anchor">#</a> 6.4.6 Join查询优化</h4> <p>        Join左边尽量放小数据量的表，而且最好是重复关联键少的表。</p> <h4 id="_6-4-7-字段名引用"><a href="#_6-4-7-字段名引用" class="header-anchor">#</a> 6.4.7 字段名引用</h4> <p>        避免字段名与关键字冲突：MySQL对于关键字冲突的字段名加<strong>反引号</strong>，Presto 对与关键字冲突的字段名加<strong>双引号</strong>。当然，如果字段名不与关键字冲突，则可以不加双引号。</p> <h4 id="_6-4-8-时间函数"><a href="#_6-4-8-时间函数" class="header-anchor">#</a> 6.4.8 时间函数</h4> <p>        对于 <code>timestamp</code>，需要进行比较的时候，需要添加 <code>timestamp</code> 关键字，而 MySQL 中对 <code>timestamp</code> 可以直接进行比较。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">/*MySQL的写法*/</span>
<span class="token keyword">SELECT</span> t <span class="token keyword">FROM</span> a <span class="token keyword">WHERE</span> t <span class="token operator">&gt;</span> <span class="token string">'2017-01-01 00:00:00'</span><span class="token punctuation">;</span> 

<span class="token comment">/*Presto中的写法*/</span>
<span class="token keyword">SELECT</span> t <span class="token keyword">FROM</span> a <span class="token keyword">WHERE</span> t <span class="token operator">&gt;</span> <span class="token keyword">timestamp</span> <span class="token string">'2017-01-01 00:00:00'</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-4-9-md5-函数的使用"><a href="#_6-4-9-md5-函数的使用" class="header-anchor">#</a> 6.4.9 MD5 函数的使用</h4> <p>        Presto 中 MD5 函数传入的 是 <code>binary</code> 类型，返回的也是<code>binary</code>类型，要对字符串进行 <code>MD5</code>操作时，需要转换：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> to_hex<span class="token punctuation">(</span>md5<span class="token punctuation">(</span>to_utf8<span class="token punctuation">(</span><span class="token string">'1212'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-4-10-不支持-insert-overwrite-语法"><a href="#_6-4-10-不支持-insert-overwrite-语法" class="header-anchor">#</a> 6.4.10 不支持 INSERT OVERWRITE 语法</h4> <p>        Presto中不支持 <code>insert overwrite</code>语法，只能先<code>delete</code>，然后<code>insert into</code></p> <h4 id="_6-4-11-orc-格式"><a href="#_6-4-11-orc-格式" class="header-anchor">#</a> 6.4.11 ORC 格式</h4> <p><strong>Presto 中对 ORC 文件格式进行了针对性优化，但在 impala 中目前不支持ORC格式的表，hive中支持 ORC 格式的表，所以想用列式存储的时候可以优先考虑ORC格式</strong></p> <h4 id="_6-4-12-parquet-格式"><a href="#_6-4-12-parquet-格式" class="header-anchor">#</a> 6.4.12 PARQUET 格式</h4> <p>         Presto 目前支持 parquet 格式，支持查询，但不支持 <code>insert</code></p> <h2 id="巨人的肩膀"><a href="#巨人的肩膀" class="header-anchor">#</a> 巨人的肩膀</h2> <blockquote><p>1、《大数据分析数据仓库项目实战》
2、《大数据技术实战》
3、《大数据私房菜_Presto的安装和使用》
4、 《impala与Presto的性能比较》https://blog.csdn.net/u012551524/article/details/79124532
5、《Presto踩坑指南》https://segmentfault.com/a/1190000013120454?utm_source=tag-newest</p></blockquote> <h2 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h2> <p>        本篇内容为大家介绍的是关于从 0 到 1 学习 Presto 的过程，内容算是比较的完整！包括从<strong>Presto的简介</strong>，<strong>安装部署</strong>，<strong>命令行 Client 的安装</strong>，<strong>基本使用</strong>，<strong>可视化客户端的安装与基本使用</strong>，以及使用任何一个组件我们都很注重的<strong>优化</strong> ...... 希望大家看完之后能够有所收获！<font color="RoyalBlue"><strong>你知道的越多，你不知道的也越多</strong></font>，我是大数据梦想家，我们下一期见！</p> <h2 id="彩蛋"><a href="#彩蛋" class="header-anchor">#</a> 彩蛋</h2> <p>        我在经历了太多技术群沦落为广告群，水文群，聊天群之后，立志打造一个真正的技术交流社区，于是和我现在的管理成立了「大数据梦想家」技术交流群，希望有更多热爱并渴望学习大数据技术的小伙伴加入到我们的队伍。以下是部分群规，群里设置有<strong>严格的制度</strong>以及<strong>不错的福利制度</strong>。
<img src="https://img-blog.csdnimg.cn/2021030800371162.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDMxODgzMA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">
        这是我整理的福利资料，🚀<a href="https://shimo.im/docs/C8Y6Jjtw9ryRpVJH" target="_blank" rel="noopener noreferrer">https://shimo.im/docs/C8Y6Jjtw9ryRpVJH<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>        想了解更多信息，可以加入我们的学习群，可以关注<strong>下方公众号</strong>，后台回复“<strong>加群</strong>”即可。
        
<img src="https://img-blog.csdnimg.cn/20210314112543633.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDMxODgzMA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="./assets/js/app.9ce0d262.js" defer></script><script src="./assets/js/2.fa5f1a4a.js" defer></script><script src="./assets/js/57.8263a106.js" defer></script>
  </body>
</html>
