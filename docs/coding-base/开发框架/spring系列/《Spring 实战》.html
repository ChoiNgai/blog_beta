<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>《Spring 实战》 | 大数据技术文档</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="./favicon.ico">
    <meta name="description" content="从入门到入土">
    
    <link rel="preload" href="./assets/css/0.styles.8b017a1a.css" as="style"><link rel="preload" href="./assets/js/app.dbe5dc78.js" as="script"><link rel="preload" href="./assets/js/2.fa5f1a4a.js" as="script"><link rel="preload" href="./assets/js/68.6a9fb92c.js" as="script"><link rel="prefetch" href="./assets/js/10.af7e6d14.js"><link rel="prefetch" href="./assets/js/100.f98d6b7c.js"><link rel="prefetch" href="./assets/js/101.3ebb2df2.js"><link rel="prefetch" href="./assets/js/102.bddf26fd.js"><link rel="prefetch" href="./assets/js/103.3c13d131.js"><link rel="prefetch" href="./assets/js/104.76e7b64f.js"><link rel="prefetch" href="./assets/js/105.b8907b13.js"><link rel="prefetch" href="./assets/js/106.26f679d0.js"><link rel="prefetch" href="./assets/js/107.7670ff83.js"><link rel="prefetch" href="./assets/js/108.c620cb38.js"><link rel="prefetch" href="./assets/js/109.394140cc.js"><link rel="prefetch" href="./assets/js/11.99d58157.js"><link rel="prefetch" href="./assets/js/110.8a03d1ab.js"><link rel="prefetch" href="./assets/js/111.709e74df.js"><link rel="prefetch" href="./assets/js/112.e7c7c661.js"><link rel="prefetch" href="./assets/js/113.b9c7ba9e.js"><link rel="prefetch" href="./assets/js/114.45aede8c.js"><link rel="prefetch" href="./assets/js/115.1ad69003.js"><link rel="prefetch" href="./assets/js/116.0f4944de.js"><link rel="prefetch" href="./assets/js/117.338b1f46.js"><link rel="prefetch" href="./assets/js/118.56fa4871.js"><link rel="prefetch" href="./assets/js/119.1374f6e2.js"><link rel="prefetch" href="./assets/js/12.2e190b00.js"><link rel="prefetch" href="./assets/js/120.7e3bde42.js"><link rel="prefetch" href="./assets/js/121.bf4c105b.js"><link rel="prefetch" href="./assets/js/122.9678e246.js"><link rel="prefetch" href="./assets/js/123.4f9c51b8.js"><link rel="prefetch" href="./assets/js/124.6ed32d31.js"><link rel="prefetch" href="./assets/js/125.c1c1f240.js"><link rel="prefetch" href="./assets/js/126.f7dae67d.js"><link rel="prefetch" href="./assets/js/127.aa5de251.js"><link rel="prefetch" href="./assets/js/128.7a097fcd.js"><link rel="prefetch" href="./assets/js/129.62b823c3.js"><link rel="prefetch" href="./assets/js/13.5d4714fa.js"><link rel="prefetch" href="./assets/js/130.04125268.js"><link rel="prefetch" href="./assets/js/131.f93632b5.js"><link rel="prefetch" href="./assets/js/132.8efcb3ab.js"><link rel="prefetch" href="./assets/js/133.045ade7e.js"><link rel="prefetch" href="./assets/js/134.82af04a6.js"><link rel="prefetch" href="./assets/js/135.06de65c0.js"><link rel="prefetch" href="./assets/js/136.3fc5ce45.js"><link rel="prefetch" href="./assets/js/137.ca4e288e.js"><link rel="prefetch" href="./assets/js/138.f8e9409a.js"><link rel="prefetch" href="./assets/js/139.51cc74b3.js"><link rel="prefetch" href="./assets/js/14.cd95effa.js"><link rel="prefetch" href="./assets/js/15.d7a053dc.js"><link rel="prefetch" href="./assets/js/16.241383de.js"><link rel="prefetch" href="./assets/js/17.cdf37f90.js"><link rel="prefetch" href="./assets/js/18.54a8e3ff.js"><link rel="prefetch" href="./assets/js/19.b1f41278.js"><link rel="prefetch" href="./assets/js/20.00809aa4.js"><link rel="prefetch" href="./assets/js/21.ed4af20e.js"><link rel="prefetch" href="./assets/js/22.d70e789f.js"><link rel="prefetch" href="./assets/js/23.4bd4acfc.js"><link rel="prefetch" href="./assets/js/24.b68c0ece.js"><link rel="prefetch" href="./assets/js/25.56ed8a43.js"><link rel="prefetch" href="./assets/js/26.6bcb257f.js"><link rel="prefetch" href="./assets/js/27.c00845f2.js"><link rel="prefetch" href="./assets/js/28.6badc057.js"><link rel="prefetch" href="./assets/js/29.9230aae3.js"><link rel="prefetch" href="./assets/js/3.b52d03f5.js"><link rel="prefetch" href="./assets/js/30.24beb61e.js"><link rel="prefetch" href="./assets/js/31.f2a94727.js"><link rel="prefetch" href="./assets/js/32.a3ba2747.js"><link rel="prefetch" href="./assets/js/33.c524bae4.js"><link rel="prefetch" href="./assets/js/34.163f85b3.js"><link rel="prefetch" href="./assets/js/35.c42df8de.js"><link rel="prefetch" href="./assets/js/36.03d4748a.js"><link rel="prefetch" href="./assets/js/37.07cd39b4.js"><link rel="prefetch" href="./assets/js/38.18db04a1.js"><link rel="prefetch" href="./assets/js/39.c1633a4e.js"><link rel="prefetch" href="./assets/js/4.1d0a3544.js"><link rel="prefetch" href="./assets/js/40.a49e9f5c.js"><link rel="prefetch" href="./assets/js/41.0490672b.js"><link rel="prefetch" href="./assets/js/42.03ff0a41.js"><link rel="prefetch" href="./assets/js/43.7567d202.js"><link rel="prefetch" href="./assets/js/44.e36ca589.js"><link rel="prefetch" href="./assets/js/45.5b0f064d.js"><link rel="prefetch" href="./assets/js/46.11d921c5.js"><link rel="prefetch" href="./assets/js/47.f961d914.js"><link rel="prefetch" href="./assets/js/48.ba14e041.js"><link rel="prefetch" href="./assets/js/49.566ddc43.js"><link rel="prefetch" href="./assets/js/5.cc194294.js"><link rel="prefetch" href="./assets/js/50.b70961ac.js"><link rel="prefetch" href="./assets/js/51.3c084f92.js"><link rel="prefetch" href="./assets/js/52.14662c12.js"><link rel="prefetch" href="./assets/js/53.c40aa86f.js"><link rel="prefetch" href="./assets/js/54.300e2058.js"><link rel="prefetch" href="./assets/js/55.3b06c210.js"><link rel="prefetch" href="./assets/js/56.227ea682.js"><link rel="prefetch" href="./assets/js/57.19a5d767.js"><link rel="prefetch" href="./assets/js/58.7fc8ce3f.js"><link rel="prefetch" href="./assets/js/59.9abc1a7f.js"><link rel="prefetch" href="./assets/js/6.a67b19a4.js"><link rel="prefetch" href="./assets/js/60.21e470b2.js"><link rel="prefetch" href="./assets/js/61.342c1882.js"><link rel="prefetch" href="./assets/js/62.b8d083e4.js"><link rel="prefetch" href="./assets/js/63.d98056bc.js"><link rel="prefetch" href="./assets/js/64.abb48239.js"><link rel="prefetch" href="./assets/js/65.06d2edcf.js"><link rel="prefetch" href="./assets/js/66.11f32f94.js"><link rel="prefetch" href="./assets/js/67.55fb49ed.js"><link rel="prefetch" href="./assets/js/69.ea206161.js"><link rel="prefetch" href="./assets/js/7.4db7fac4.js"><link rel="prefetch" href="./assets/js/70.19b21c67.js"><link rel="prefetch" href="./assets/js/71.6d30915f.js"><link rel="prefetch" href="./assets/js/72.c663480f.js"><link rel="prefetch" href="./assets/js/73.c64a8bc9.js"><link rel="prefetch" href="./assets/js/74.b4853538.js"><link rel="prefetch" href="./assets/js/75.ed723be5.js"><link rel="prefetch" href="./assets/js/76.bd2efea1.js"><link rel="prefetch" href="./assets/js/77.8e8632d7.js"><link rel="prefetch" href="./assets/js/78.69ef8849.js"><link rel="prefetch" href="./assets/js/79.9785ef8d.js"><link rel="prefetch" href="./assets/js/8.eace717d.js"><link rel="prefetch" href="./assets/js/80.5365bfc6.js"><link rel="prefetch" href="./assets/js/81.69b36a86.js"><link rel="prefetch" href="./assets/js/82.aad515c0.js"><link rel="prefetch" href="./assets/js/83.050ac97d.js"><link rel="prefetch" href="./assets/js/84.78bb8c43.js"><link rel="prefetch" href="./assets/js/85.feeffda7.js"><link rel="prefetch" href="./assets/js/86.f38af2cb.js"><link rel="prefetch" href="./assets/js/87.3c875b53.js"><link rel="prefetch" href="./assets/js/88.ccc36d1b.js"><link rel="prefetch" href="./assets/js/89.44e2573e.js"><link rel="prefetch" href="./assets/js/9.3a163afb.js"><link rel="prefetch" href="./assets/js/90.816482fc.js"><link rel="prefetch" href="./assets/js/91.9072f45b.js"><link rel="prefetch" href="./assets/js/92.858235e2.js"><link rel="prefetch" href="./assets/js/93.ef35de87.js"><link rel="prefetch" href="./assets/js/94.2701ba5d.js"><link rel="prefetch" href="./assets/js/95.666433f2.js"><link rel="prefetch" href="./assets/js/96.f2b93c96.js"><link rel="prefetch" href="./assets/js/97.cb6eb699.js"><link rel="prefetch" href="./assets/js/98.8f172db0.js"><link rel="prefetch" href="./assets/js/99.26797ef8.js">
    <link rel="stylesheet" href="./assets/css/0.styles.8b017a1a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/./" class="home-link router-link-active"><!----> <span class="site-name">大数据技术文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/./" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程基础" class="dropdown-title"><span class="title">编程基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程基础" class="mobile-dropdown-title"><span class="title">编程基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/java基础语法/" class="nav-link">
  Java基础语法
</a></li><li class="dropdown-subitem"><a href="/./coding-base/" class="nav-link router-link-active">
  Java基础实战
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶(选学)
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/java并发编程/java并发编程.html" class="nav-link">
  Java并发编程
</a></li><li class="dropdown-subitem"><a href="/./coding-base/" class="nav-link router-link-active">
  Java网络编程
</a></li><li class="dropdown-subitem"><a href="/./coding-base/java集合/Java集合（永盛）.html" class="nav-link">
  Java集合
</a></li><li class="dropdown-subitem"><a href="/./coding-base/java虚拟机/" class="nav-link">
  Java虚拟机
</a></li></ul></li><li class="dropdown-item"><h4>
          计算机基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-subitem"><a href="/./coding-base/数据结构与算法/" class="nav-link">
  数据结构（重要）
</a></li><li class="dropdown-subitem"><a href="/./coding-base/计算机网络/计算机网络（双祥）.html" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/./coding-base/操作系统/" class="nav-link">
  操作系统
</a></li></ul></li><li class="dropdown-item"><h4>
          Python（选学）
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/Python/python基础/" class="nav-link">
  Python基础语法
</a></li><li class="dropdown-subitem"><a href="/./coding-base/Python/python库/" class="nav-link">
  Python数据科学库
</a></li></ul></li><li class="dropdown-item"><h4>
          框架（选学）
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/框架/sprin系列/" class="nav-link">
  Spring系列
</a></li><li class="dropdown-subitem"><a href="/./coding-base/框架/flask/falsk.html" class="nav-link">
  Flask
</a></li><li class="dropdown-subitem"><a href="/./coding-base/框架/vue/flask.html" class="nav-link">
  Vue
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./database/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/./database/hbase/" class="nav-link">
  HBase
</a></li><li class="dropdown-item"><!----> <a href="/./database/tidb/" class="nav-link">
  TiDB
</a></li><li class="dropdown-item"><!----> <a href="/./database/clickhouse/" class="nav-link">
  ClickHouse
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据仓库" class="dropdown-title"><span class="title">数据仓库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据仓库" class="mobile-dropdown-title"><span class="title">数据仓库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./datahouse/sql/" class="nav-link">
  SQL
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/大数据基础/bigdata-base.html" class="nav-link">
  大数据基础
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/离线数仓/" class="nav-link">
  离线数仓
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/实时数仓/" class="nav-link">
  实时数仓
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/商业化技术/" class="nav-link">
  商业化技术
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/电商业务/" class="nav-link">
  电商业务
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据框架及组件" class="dropdown-title"><span class="title">大数据框架及组件</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据框架及组件" class="mobile-dropdown-title"><span class="title">大数据框架及组件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./bigdata/hadoop/" class="nav-link">
  Hadoop
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/hive/" class="nav-link">
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/zookeeper/" class="nav-link">
  Zookeeper
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/kafka/" class="nav-link">
  kafka
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/spark/" class="nav-link">
  Spark
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/flink/" class="nav-link">
  Flink
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./other/面经/" class="nav-link">
  面经
</a></li><li class="dropdown-item"><!----> <a href="/./other/机器学习/" class="nav-link">
  机器学习
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/./" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程基础" class="dropdown-title"><span class="title">编程基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程基础" class="mobile-dropdown-title"><span class="title">编程基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/java基础语法/" class="nav-link">
  Java基础语法
</a></li><li class="dropdown-subitem"><a href="/./coding-base/" class="nav-link router-link-active">
  Java基础实战
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶(选学)
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/java并发编程/java并发编程.html" class="nav-link">
  Java并发编程
</a></li><li class="dropdown-subitem"><a href="/./coding-base/" class="nav-link router-link-active">
  Java网络编程
</a></li><li class="dropdown-subitem"><a href="/./coding-base/java集合/Java集合（永盛）.html" class="nav-link">
  Java集合
</a></li><li class="dropdown-subitem"><a href="/./coding-base/java虚拟机/" class="nav-link">
  Java虚拟机
</a></li></ul></li><li class="dropdown-item"><h4>
          计算机基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-subitem"><a href="/./coding-base/数据结构与算法/" class="nav-link">
  数据结构（重要）
</a></li><li class="dropdown-subitem"><a href="/./coding-base/计算机网络/计算机网络（双祥）.html" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/./coding-base/操作系统/" class="nav-link">
  操作系统
</a></li></ul></li><li class="dropdown-item"><h4>
          Python（选学）
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/Python/python基础/" class="nav-link">
  Python基础语法
</a></li><li class="dropdown-subitem"><a href="/./coding-base/Python/python库/" class="nav-link">
  Python数据科学库
</a></li></ul></li><li class="dropdown-item"><h4>
          框架（选学）
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./coding-base/框架/sprin系列/" class="nav-link">
  Spring系列
</a></li><li class="dropdown-subitem"><a href="/./coding-base/框架/flask/falsk.html" class="nav-link">
  Flask
</a></li><li class="dropdown-subitem"><a href="/./coding-base/框架/vue/flask.html" class="nav-link">
  Vue
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./database/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/./database/hbase/" class="nav-link">
  HBase
</a></li><li class="dropdown-item"><!----> <a href="/./database/tidb/" class="nav-link">
  TiDB
</a></li><li class="dropdown-item"><!----> <a href="/./database/clickhouse/" class="nav-link">
  ClickHouse
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据仓库" class="dropdown-title"><span class="title">数据仓库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据仓库" class="mobile-dropdown-title"><span class="title">数据仓库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./datahouse/sql/" class="nav-link">
  SQL
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/大数据基础/bigdata-base.html" class="nav-link">
  大数据基础
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/离线数仓/" class="nav-link">
  离线数仓
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/实时数仓/" class="nav-link">
  实时数仓
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/商业化技术/" class="nav-link">
  商业化技术
</a></li><li class="dropdown-item"><!----> <a href="/./datahouse/电商业务/" class="nav-link">
  电商业务
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据框架及组件" class="dropdown-title"><span class="title">大数据框架及组件</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据框架及组件" class="mobile-dropdown-title"><span class="title">大数据框架及组件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./bigdata/hadoop/" class="nav-link">
  Hadoop
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/hive/" class="nav-link">
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/zookeeper/" class="nav-link">
  Zookeeper
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/kafka/" class="nav-link">
  kafka
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/spark/" class="nav-link">
  Spark
</a></li><li class="dropdown-item"><!----> <a href="/./bigdata/flink/" class="nav-link">
  Flink
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./other/面经/" class="nav-link">
  面经
</a></li><li class="dropdown-item"><!----> <a href="/./other/机器学习/" class="nav-link">
  机器学习
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>spring系列</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./coding-base/%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6/spring%E7%B3%BB%E5%88%97/" aria-current="page" class="sidebar-link">目录</a></li><li><a href="/./coding-base/开发框架/spring系列/《Spring Boot 实战》.html" class="sidebar-link">《Spring Boot 实战》</a></li><li><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html" class="active sidebar-link">《Spring 实战》</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_1-1-简化-java-开发" class="sidebar-link">1.1 简化 Java 开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_1-1-1-激发-pojo-的潜能" class="sidebar-link">1.1.1 激发 POJO 的潜能</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_1-1-2-依赖注入" class="sidebar-link">1.1.2 依赖注入</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_1-1-3-应用切面" class="sidebar-link">1.1.3 应用切面</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_1-1-4-使用模板消除样板式代码" class="sidebar-link">1.1.4 使用模板消除样板式代码</a></li></ul></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_1-2-容纳你的-bean" class="sidebar-link">1.2 容纳你的 Bean</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_1-2-1-使用应用上下文" class="sidebar-link">1.2.1 使用应用上下文</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_1-2-2-bean-的生命周期" class="sidebar-link">1.2.2 bean 的生命周期</a></li></ul></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_1-3-俯瞰-spring-风景线" class="sidebar-link">1.3 俯瞰 Spring 风景线</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_1-3-1-spring-模块" class="sidebar-link">1.3.1 Spring 模块</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_1-3-2-spring-portfolio" class="sidebar-link">1.3.2 Spring Portfolio</a></li></ul></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_2-1-spring-配置的可选方案" class="sidebar-link">2.1 Spring 配置的可选方案</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_2-2-自动化装配-bean" class="sidebar-link">2.2 自动化装配 bean</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_2-2-1-创建可被发现的-bean" class="sidebar-link">2.2.1 创建可被发现的 bean</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_2-2-2-为组件扫描的-bean-命名" class="sidebar-link">2.2.2 为组件扫描的 bean 命名</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_2-2-3-设置组件扫描的基础包" class="sidebar-link">2.2.3 设置组件扫描的基础包</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_2-2-4-通过为-bean-添加注解实现自动装配" class="sidebar-link">2.2.4 通过为 bean 添加注解实现自动装配</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_2-2-5-验证自动装配" class="sidebar-link">2.2.5 验证自动装配</a></li></ul></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_2-3-通过-java-代码装配-bean" class="sidebar-link">2.3 通过 Java 代码装配 bean</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_2-3-1-创建配置类" class="sidebar-link">2.3.1 创建配置类</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_2-3-2-声明简单的-bean" class="sidebar-link">2.3.2 声明简单的 bean</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_2-3-3-借助-javaconfig-实现注入" class="sidebar-link">2.3.3 借助 JavaConfig 实现注入</a></li></ul></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_2-4-通过-xml-装配-bean" class="sidebar-link">2.4 通过 XML 装配 bean</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_2-4-1-创建-xml-配置规范" class="sidebar-link">2.4.1 创建 XML 配置规范</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_2-4-2-声明一个简单的" class="sidebar-link">2.4.2 声明一个简单的</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_2-4-3-借助构造器注入初始化-bean" class="sidebar-link">2.4.3 借助构造器注入初始化 bean</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_2-4-4-设置属性" class="sidebar-link">2.4.4 设置属性</a></li></ul></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_2-5-导入和混合配置" class="sidebar-link">2.5 导入和混合配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_2-5-1-在-javaconfig-中引用-xml-配置" class="sidebar-link">2.5.1 在 JavaConfig 中引用 XML 配置</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_2-5-2-在-xml-配置中引用-javaconfig" class="sidebar-link">2.5.2 在 XML 配置中引用 JavaConfig</a></li></ul></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_3-1-环境与-profile" class="sidebar-link">3.1 环境与 profile</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_3-1-1-配置-profile-bean" class="sidebar-link">3.1.1 配置 profile bean</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_3-1-2-激活-profile" class="sidebar-link">3.1.2 激活 profile</a></li></ul></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_3-2-条件化的-bean" class="sidebar-link">3.2 条件化的 bean</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_3-3-处理自动装配的歧义性" class="sidebar-link">3.3 处理自动装配的歧义性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_3-3-1-标示首选的-bean" class="sidebar-link">3.3.1 标示首选的 bean</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_3-3-2-限定自动装配的-bean" class="sidebar-link">3.3.2 限定自动装配的 bean</a></li></ul></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_3-4-bean-的作用域" class="sidebar-link">3.4 bean 的作用域</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_3-4-1-使用会话和请求作用域" class="sidebar-link">3.4.1 使用会话和请求作用域</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_3-4-2-在-xml-中声明作用域代理" class="sidebar-link">3.4.2 在 XML 中声明作用域代理</a></li></ul></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_3-5-运行时注入" class="sidebar-link">3.5 运行时注入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_3-5-1-注入外部的值" class="sidebar-link">3.5.1 注入外部的值</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_3-5-2-使用-spring-表达式语言进行装配" class="sidebar-link">3.5.2 使用 Spring 表达式语言进行装配</a></li></ul></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_4-1-什么是面向切面编程" class="sidebar-link">4.1 什么是面向切面编程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_4-1-1-定义-aop-术语" class="sidebar-link">4.1.1 定义 AOP 术语</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_4-1-2-spring-对-aop-的支持" class="sidebar-link">4.1.2 Spring 对 AOP 的支持</a></li></ul></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_4-2-通过切点来选择连接点" class="sidebar-link">4.2 通过切点来选择连接点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_4-2-1-编写切点" class="sidebar-link">4.2.1 编写切点</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_4-2-2-在切点中选择-bean" class="sidebar-link">4.2.2 在切点中选择 bean</a></li></ul></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_4-3-使用注解创建切面" class="sidebar-link">4.3 使用注解创建切面</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_4-3-1-定义切面" class="sidebar-link">4.3.1 定义切面</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_4-3-2-环绕通知" class="sidebar-link">4.3.2 环绕通知</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_4-3-3-处理通知中的参数" class="sidebar-link">4.3.3 处理通知中的参数</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_4-3-4-通过注解引入新功能" class="sidebar-link">4.3.4 通过注解引入新功能</a></li></ul></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_4-4-在-xml-中声明切面" class="sidebar-link">4.4 在 XML 中声明切面</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_4-4-1-声明前置和后置通知" class="sidebar-link">4.4.1 声明前置和后置通知</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_4-4-2-声明环绕通知" class="sidebar-link">4.4.2 声明环绕通知</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_4-4-3-为通知传递参数" class="sidebar-link">4.4.3 为通知传递参数</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_4-4-4-通过切面引入新的功能" class="sidebar-link">4.4.4 通过切面引入新的功能</a></li></ul></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_4-5-注入-aspectj-切面" class="sidebar-link">4.5 注入 AspectJ 切面</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_5-1-spring-mvc-起步" class="sidebar-link">5.1 Spring MVC 起步</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_5-1-1-跟踪-spring-mvc-的请求" class="sidebar-link">5.1.1 跟踪 Spring MVC 的请求</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_5-1-2-搭建-spring-mvc" class="sidebar-link">5.1.2 搭建 Spring MVC</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_5-1-3-spittr-应用简介" class="sidebar-link">5.1.3 Spittr 应用简介</a></li></ul></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_5-2-编写基本的控制器" class="sidebar-link">5.2 编写基本的控制器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_5-2-1-测试控制器" class="sidebar-link">5.2.1 测试控制器</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_5-2-2-定义类级别的请求处理" class="sidebar-link">5.2.2 定义类级别的请求处理</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_5-2-3-传递模型数据到视图中" class="sidebar-link">5.2.3 传递模型数据到视图中</a></li></ul></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_5-3-接受请求的输入" class="sidebar-link">5.3 接受请求的输入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_5-3-1-处理查询参数" class="sidebar-link">5.3.1 处理查询参数</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_5-3-2-通过路径参数接受输入" class="sidebar-link">5.3.2 通过路径参数接受输入</a></li></ul></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_5-4-处理表单" class="sidebar-link">5.4 处理表单</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_5-4-1-编写处理表单的控制器" class="sidebar-link">5.4.1 编写处理表单的控制器</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_5-4-2-校验表单" class="sidebar-link">5.4.2 校验表单</a></li></ul></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_6-1-理解视图解析" class="sidebar-link">6.1 理解视图解析</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_6-2-创建-jsp-视图" class="sidebar-link">6.2 创建 JSP 视图</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_6-2-1-配置适用于-jsp-的视图解析器" class="sidebar-link">6.2.1 配置适用于 JSP 的视图解析器</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_6-2-2-使用-spring-的-jsp-库" class="sidebar-link">6.2.2 使用 Spring 的 JSP 库</a></li></ul></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_6-3-使用-apache-tiles-视图定义布局" class="sidebar-link">6.3 使用 Apache Tiles 视图定义布局</a></li><li class="sidebar-sub-header"><a href="/./coding-base/开发框架/spring系列/《Spring 实战》.html#_6-4-使用-thymeleaf" class="sidebar-link">6.4 使用 Thymeleaf</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="《spring-实战》"><a href="#《spring-实战》" class="header-anchor">#</a> 《Spring 实战》</h1> <blockquote><p>原文链接：https://www.yuque.com/beimingyouyu-9woka/computer/qh5fuu</p></blockquote> <h1 id="_1-spring-之旅"><a href="#_1-spring-之旅" class="header-anchor">#</a> 1 Spring 之旅</h1> <hr> <p>Spring 可以做很多事情，它为企业级开发提供了丰富的功能，但是这些功能的底层都依赖于它的两个核心特性，也就是依赖注入（dependency injection，DI）和面向切面编程（aspect-oriented programming，AOP）。</p> <p>Spring 是 Java 历史中很重要的组成部分。在诞生之初，创建 Spring 的主要目的是用来替代更加重量级的企业级 Java 技术，尤其是 EJB。相对于 EJB 来说，Spring 提供了更加轻量级和简单的编程模型。它增强了简单老式 Java 对象（Plain Old Java object，POJO）的功能，使其具备了之前只有 EJB 和其他企业级 Java 规范才具有的功能。</p> <h2 id="_1-1-简化-java-开发"><a href="#_1-1-简化-java-开发" class="header-anchor">#</a> 1.1 简化 Java 开发</h2> <p>Spring 是为了解决企业级应用开发的复杂性而创建的，使用 Spring 可以让简单的 JavaBean 实现之前只有 EJB 才能完成的事情。</p> <p>虽然 Spring 用 bean 或者 JavaBean 来表示应用组件，但并不意味着 Spring 组件必须要遵循 JavaBean 规范。一个 Spring 组件可以是任何形式的 POJO。</p> <p>为了降低 Java 开发的复杂性，Spring 采取了以下 4 种关键策略：</p> <ul><li><p>基于 POJO 的轻量级和最小侵入性编程</p></li> <li><p>通过依赖注入和面向接口实现松耦合</p></li> <li><p>基于切面和惯例进行声明式编程</p></li> <li><p>通过切面和模板减少样板式代码</p></li></ul> <h3 id="_1-1-1-激发-pojo-的潜能"><a href="#_1-1-1-激发-pojo-的潜能" class="header-anchor">#</a> 1.1.1 激发 POJO 的潜能</h3> <p>如果你从事 Java 编程有一段时间了，那么你或许会发现很多框架通过强迫应用继承它们的类或实现它们的接口从而导致应用与框架绑死。</p> <p>Spring 竭力避免因自身的 API 而弄乱你的应用代码。Spring 不会强迫你实现 Spring 规范的接口或继承 Spring 规范的类，相反，在基于 Spring 构建的应用中，它的类通常没有任何痕迹表明你使用了 Spring。最坏的场景是，一个类或许会使用 Spring 注解，但它依旧是 POJO。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Spring 不会在 HelloWorldBean 上有任何不合理的要求</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>habuma<span class="token punctuation">.</span>spring</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorldBean</span> <span class="token punctuation">{</span>
    
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到，这是一个简单普通的 Java 类——POJO。没有任何地方表明它是一个 Spring 组件。Spring 的非侵入式编程模型意味着这个类在 Spring 应用和非 Spring 应用中都可以发挥同样的作用。</p> <p>尽管形式看起来很简单，但 POJO 一样可以具有魔力。Spring 赋予 POJO 魔力的方式之一就是通过 DI 来装备它们。</p> <h3 id="_1-1-2-依赖注入"><a href="#_1-1-2-依赖注入" class="header-anchor">#</a> 1.1.2 依赖注入</h3> <h4 id="di-功能是如何实现的"><a href="#di-功能是如何实现的" class="header-anchor">#</a> DI 功能是如何实现的</h4> <p>任何一个有实际意义的应用都会由两个或者更多的类组成，这些类相互之间进行协作来完成特定的业务逻辑。按照传统的做法，每个对象负责管理与自己相互协作的对象的引用，这将会导致高度耦合和难以测试的代码。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// DamselRescuingKnight 只能执行 RescueDamselQuest 探险任务</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>springinaction<span class="token punctuation">.</span>knights</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DamselRescuingKnight</span> <span class="token keyword">implements</span> <span class="token class-name">Knight</span> <span class="token punctuation">{</span>
	
    <span class="token keyword">private</span> <span class="token class-name">RescueDamselQuest</span> quest<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">DamselRescuingKnight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>quest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RescueDamselQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">embarkOnQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	quest<span class="token punctuation">.</span><span class="token function">embark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到，<code>DamselRescuingKnight</code> 在它的构造函数中自行创建了 <code>RescueDamselQuest</code>。这使得 <code>DamselRescuingKnight</code> 紧密地和 <code>RescueDamselQuest</code> 耦合到了一起，因此极大地限制了这个骑士执行探险的能力。</p> <p>更糟糕的是，为这个 <code>DamselRescuingKnight</code> 编写单元测试将出奇地困难。在这样的一个测试中，你必须保证当骑士的 <code>embarkOnQuest()</code> 方法被调用的时候，探险的 <code>embark()</code> 方法也要被调用。但是没有一个简单明了的方式能够实现这一点。很遗憾，<code>DamselRescuingKnight</code> 将无法进行测试。</p> <p>耦合具有两面性。一方面，紧密耦合的代码难以测试、难以复用、难以理解，并且典型地表现出“打地鼠”式的 bug 特性。另一方面，一定程度的耦合又是必须的——完全没有耦合的代码什么也做不了。</p> <p>通过 DI，对象的依赖关系将由系统中负责协调各对象的第三方组件在创建对象的时候进行设定。对象无需自行创建或管理它们的依赖关系，依赖关系将被自动注入到需要它们的对象当中去。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// BraveKnight 足够灵活可以接受任何赋予他的探险任务</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>springinaction<span class="token punctuation">.</span>knights</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BraveKnight</span> <span class="token keyword">implements</span> <span class="token class-name">Knight</span> <span class="token punctuation">{</span>
	
    <span class="token keyword">private</span> <span class="token class-name">Quest</span> quest<span class="token punctuation">;</span>
    
    <span class="token comment">// Quest 被注入进来</span>
    <span class="token keyword">public</span> <span class="token class-name">BraveKnight</span><span class="token punctuation">(</span><span class="token class-name">Quest</span> quest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>quest <span class="token operator">=</span> quest<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">embarkOnQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	quest<span class="token punctuation">.</span><span class="token function">embark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre></div><p>我们可以看到，不同于之前的 <code>DamselRescuingKnight</code>，<code>BraveKnight</code> 没有自己创建探险任务，而是在构造的时候把探险任务作为构造器参数传入。这是依赖注入的方式之一，即构造器注入（constructor injection）。</p> <p>这里的要点是 <code>BraveKnight</code> 没有与任何特定的 <code>Quest</code> 实现发生耦合。对它来说，被要求挑战的探险任务只要实现了 <code>Quest</code> 接口，那么具体是哪种类型的探险就无关紧要了。这就是 DI 所带来的最大收益——松耦合。</p> <p>对依赖进行替换的一个最常用方法就是在测试的时候使用 mock 实现。我们无法充分地测试 <code>DamselRescuingKnight</code>，因为它是紧耦合的；但是可以轻松地测试 <code>BraveKnight</code>，只需给它一个 <code>Quest</code> 的 mock 实现即可。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>springinaction<span class="token punctuation">.</span>knights</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span></span><span class="token class-name">Mockito</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BraveKnightTest</span> <span class="token punctuation">{</span>
	
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">knightShouldEmbarkOnQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token class-name">Quest</span> mockQuest <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">Quest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BraveKnight</span> knight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BraveKnight</span><span class="token punctuation">(</span>mockQuest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        knight<span class="token punctuation">.</span><span class="token function">embarkOnQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>mockQuest<span class="token punctuation">,</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">embark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre></div><h4 id="将-quest-注入到-knight-中"><a href="#将-quest-注入到-knight-中" class="header-anchor">#</a> 将 Quest 注入到 Knight 中</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// SlayDragonQuest 是要注入到 BraveKnight 中的 Quest 实现</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>springinaction<span class="token punctuation">.</span>knights</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SlayDragonQuest</span> <span class="token keyword">implements</span> <span class="token class-name">Quest</span> <span class="token punctuation">{</span>
	
    <span class="token keyword">private</span> <span class="token class-name">PrintStream</span> stream<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">SlayDragonQuest</span><span class="token punctuation">(</span><span class="token class-name">PrintStream</span> stream<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>stream <span class="token operator">=</span> stream<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">embark</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	stream<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Embarking on quest to slay the dragon!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre></div><p>创建应用组件之间协作的行为通常称为装配（wiring）。Spring 有多种装配 bean 的方式，采用 XML 是很常见的一种装配方式。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 使用 Spring 将 SlayDragonQuest 注入到 BraveKnight 中 --&gt;</span>
<span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>knight<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.springinaction.knights.BraveKnight<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>quest<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>quest<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.springinaction.knights.SlayDragonQuest<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#{T(System).out}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在这里，<code>BraveKnight</code> 和 <code>SlayDragonQuest</code> 被声明为 Spring 中的 bean。就 <code>BraveKnight</code> bean 来讲，它在构造时传入了对 <code>SlayDragonQuest</code> bean的引用，将其作为构造器参数。同时，<code>SlayDragonQuest</code> bean 的声明使用了 Spring 表达式语言（Spring Expression Language），将 <code>System.out</code> 传入到了 <code>SlayDragonQuest</code> 的构造器中。</p> <p>Spring 还支持使用 Java 来描述配置。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Spring 提供了基于 Java 的配置，可作为 XML 的替代方案</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>springinaction<span class="token punctuation">.</span>knights<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>springinaction<span class="token punctuation">.</span>knights<span class="token punctuation">.</span></span><span class="token class-name">BraveKnight</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>springinaction<span class="token punctuation">.</span>knights<span class="token punctuation">.</span></span><span class="token class-name">Knight</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>springinaction<span class="token punctuation">.</span>knights<span class="token punctuation">.</span></span><span class="token class-name">Quest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>springinaction<span class="token punctuation">.</span>knights<span class="token punctuation">.</span></span><span class="token class-name">SlayDragonQuest</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KnightConfig</span> <span class="token punctuation">{</span>
	
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Knight</span> <span class="token function">knight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BraveKnight</span><span class="token punctuation">(</span><span class="token function">quest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Quest</span> <span class="token function">quest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SlayDragonQuest</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre></div><h4 id="观察它如何工作"><a href="#观察它如何工作" class="header-anchor">#</a> 观察它如何工作</h4> <p>Spring 通过应用上下文（Application Context）装载 bean 的定义并把它们组装起来。Spring 应用上下文全权负责对象的创建和组装。Spring 自带了多种应用上下文的实现，它们之间主要的区别仅仅在于如何加载配置。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// KnightMain.java 加载包含 Knight 的 Spring 上下文</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>springinaction<span class="token punctuation">.</span>knights</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KnightMain</span> <span class="token punctuation">{</span>
    
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    	<span class="token class-name">ClassPathXmlApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;META-INF/spring/knights.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Knight</span> knight <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">Knight</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        knight<span class="token punctuation">.</span><span class="token function">embarkOnQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre></div><p>这里的 main() 方法基于 knights.xml 文件创建了 Spring 应用上下文。随后它调用该应用上下文获取一个 ID 为 knight 的 bean。得到 Knight 对象的引用后，只需简单调用 <code>embarkOnQuest()</code> 方法就可以执行所赋予的探险任务了。注意这个类完全不知道我们的英雄骑士接受哪种探险任务，而且完全没有意识到这是由 <code>BraveKnight</code> 来执行的。只有 knights.xml 文件知道哪个骑士执行哪种探险任务。</p> <h3 id="_1-1-3-应用切面"><a href="#_1-1-3-应用切面" class="header-anchor">#</a> 1.1.3 应用切面</h3> <p>DI 能够让相互协作的软件组件保持松散耦合，而面向切面编程（aspect-oriented programming，AOP）允许你把遍布应用各处的功能分离出来形成可重用的组件。</p> <p>面向切面编程往往被定义为促使软件系统实现关注点分离的一项技术。系统由许多不同的组件组成，每一个组件各负责一块特定功能。除了实现自身核心的功能之外，这些组件还经常承担着额外的职责。诸如日志、事务管理和安全这样的系统服务经常融入到自身具有核心业务逻辑的组件中去，这些系统服务通常被称为横切关注点，因为它们会跨越系统的多个组件。</p> <p>如果将这些关注点分散到多个组件中去，你的代码将会带来双重的复杂性。</p> <ul><li>实现系统关注点功能的代码将会重复出现在多个组件中。这意味着如果你要改变这些关注点的逻辑，必须修改各个模块中的相关实现。即使你把这些关注点抽象为一个独立的模块，其他模块只是调用它的方法，但方法的调用还是会重复出现在各个模块中。</li> <li>组件会因为那些与自身核心业务无关的代码而变得混乱。</li></ul> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/1542472/1595217446267-e3fd5943-bd18-4621-9740-5652ca955769.png" alt="img"></p> <p>AOP 能够使这些服务模块化，并以声明的方式将它们应用到它们需要影响的组件中去。所造成的结果就是这些组件会具有更高的内聚性并且会更加关注自身的业务，完全不需要了解涉及系统服务所带来复杂性。总之，AOP 能够确保 POJO 的简单性。</p> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/1542472/1595217706950-cfddd105-c38d-4774-be15-c23903cd4b20.png" alt="img"></p> <p>我们可以把切面想象为覆盖在很多组件之上的一个外壳。应用是由那些实现各自业务功能的模块组成的。借助 AOP，可以使用各种功能层去包裹核心业务层。这些层以声明的方式灵活地应用到系统中，你的核心应用甚至根本不知道它们的存在。这是一个非常强大的理念，可以将安全、事务和日志关注点与核心业务逻辑相分离。</p> <h4 id="aop-应用"><a href="#aop-应用" class="header-anchor">#</a> AOP 应用</h4> <p>每一个人都熟知骑士所做的任何事情，这是因为吟游诗人用诗歌记载了骑士的事迹并将其进行传唱。假设我们需要使用吟游诗人这个服务类来记载骑士的所有事迹。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 吟游诗人是中世纪的音乐记录器</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>springinaction<span class="token punctuation">.</span>knights</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Minstrel</span> <span class="token punctuation">{</span>
	
    <span class="token keyword">private</span> <span class="token class-name">PrintStream</span> stream<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">Minstrel</span><span class="token punctuation">(</span><span class="token class-name">PrintStream</span> stream<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>stream <span class="token operator">=</span> stream<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">singBeforeQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	stream<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Fa la la, the knight is so brave!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">singAfterQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	stream<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Tee hee hee, the brave knight did embark on a quest!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// BraveKnight 必须要调用 Minstrel 的方法</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>springinaction<span class="token punctuation">.</span>knights</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BraveKnight</span> <span class="token keyword">implements</span> <span class="token class-name">Knight</span> <span class="token punctuation">{</span>
	
    <span class="token keyword">private</span> <span class="token class-name">Quest</span> quest<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Minstrel</span> minstrel<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">BraveKnight</span><span class="token punctuation">(</span><span class="token class-name">Quest</span> quest<span class="token punctuation">,</span> <span class="token class-name">Minstrel</span> minstrel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>quest <span class="token operator">=</span> quest<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>minstrel <span class="token operator">=</span> minstrel<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">embarkOnQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">QuestException</span> <span class="token punctuation">{</span>
        minstrel<span class="token punctuation">.</span><span class="token function">singBeforeQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	quest<span class="token punctuation">.</span><span class="token function">embark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        minstrel<span class="token punctuation">.</span><span class="token function">singAfterQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre></div><p>这应该可以达到预期效果。现在，你所需要做的就是回到 Spring 配置中，声明 <code>Minstrel</code> bean 并将其注入到 <code>BraveKinght</code> 的构造器之中。</p> <p>我们似乎感觉有些东西不太对。管理他的吟游诗人真的是骑士职责范围内的工作吗？在我看来，吟游诗人应该做他分内的事，根本不需要骑士命令他这么做。此外，因为骑士需要知道吟游诗人，所以就必须把吟游诗人注入到 <code>BraveKinght</code> 类中。这不仅使 <code>BraveKinght</code> 的代码复杂化了，而且还让我疑惑是否还需要一个不需要吟游诗人的骑士呢？如果 <code>Minstrel</code> 为 null 会发生什么呢？我是否应该引入一个空值校验逻辑来覆盖该场景？</p> <p>简单的 <code>BraveKinght</code> 类开始变得复杂，如果你还需要应对没有吟游诗人时的场景，那代码会变得更加复杂。但利用 AOP，你可以声明吟游诗人必须歌颂骑士的探险事迹，而骑士本身并不用直接访问 <code>Minstrel</code> 的方法。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 将 Minstrel 声明为一个切面 --&gt;</span>
<span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>aop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/aop<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop-3.2.xsd
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>knight<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.springinaction.knights.BraveKnight<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>quest<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>quest<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.springinaction.knights.SlayDragonQuest<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#{T(System).out}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>minstrel<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.springinaction.knights.Minstrel<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#{T(System).out}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
    	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspect</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>minstrel<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>pointcut</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>embark<span class="token punctuation">&quot;</span></span> <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>execution(* *.embarkOnQuest(..))<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
                
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>before</span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>embark<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>singBeforeQuest<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
                
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>after</span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>embark<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>singAfterQuest<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>aspect</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这里使用了 Spring 的 aop 配置命名空间把 <code>Minstrel</code> bean 声明为一个切面。</p> <p>这就是我们需要做的所有的事情！通过少量的 XML 配置，就可以把 <code>Minstrel</code> 声明为一个 Spring 切面。现在我们可以从这个示例中获得两个重要的观点。</p> <p>首先，<code>Minstrel</code> 仍然是一个 POJO，没有任何代码表明它要被作为一个切面使用。当我们按照上面那样进行配置后，在 Spring 的上下文中，<code>Minstrel</code> 实际上已经变成一个切面了。</p> <p>其次，也是最重要的，<code>Minstrel</code> 可以被应用到 <code>BraveKinght</code> 中，而 <code>BraveKinght</code> 不需要显示地调用它。实际上，<code>BraveKinght</code> 完全不知道 <code>Minstrel</code> 的存在。</p> <p>必须还要指出的是，尽管我们使用 Spring 魔法把 <code>Minstrel</code> 转变为一个切面，但首先要把它声明为一个 Spring bean。能够为其他 Spring bean 做到的事情都可以同样应用到 Spring 切面中。</p> <h3 id="_1-1-4-使用模板消除样板式代码"><a href="#_1-1-4-使用模板消除样板式代码" class="header-anchor">#</a> 1.1.4 使用模板消除样板式代码</h3> <p>Spring 旨在通过模板封装在消除样板式代码。</p> <h2 id="_1-2-容纳你的-bean"><a href="#_1-2-容纳你的-bean" class="header-anchor">#</a> 1.2 容纳你的 Bean</h2> <p>在基于 Spring 的应用中，你的应用对象生存于 Spring 容器（container）中。如图所示，Spring 容器负责创建对象，装配它们，配置它们并管理它们的整个生命周期，从生存到死亡。</p> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/1542472/1594171957675-c0659076-6d08-4f1a-b2c2-aa73fff1bc79.png" alt="img"></p> <p>容器是 Spring 框架的核心。Spring 容器使用 DI 管理构成应用的组件，它会创建相互协作的组件之间的关联。</p> <p>Spring 容器并不是只有一个。Spring 自带了多个容器实现，可以归为两种不同的类型。bean 工厂（由 org.springframework.beans.factory.BeanFactory 接口定义）是最简单的容器，提供基本的 DI 支持。应用上下文（由 org.springframework.context.ApplicationContext 接口定义）基于 BeanFactory 构建，并提供应用框架级别的服务，例如从属性文件解析文本信息以及发布应用事件给感兴趣的事件监听者。</p> <p>虽然我们可以在 bean 工厂和应用上下文之间任选一种，但 bean 工厂对大多数应用来说往往太低级了，因此，应用上下文要比 bean 工厂更受欢迎。</p> <h3 id="_1-2-1-使用应用上下文"><a href="#_1-2-1-使用应用上下文" class="header-anchor">#</a> 1.2.1 使用应用上下文</h3> <p>Spring 自带了多种类型的应用上下文。下面罗列的几个是最有可能遇到的。</p> <ul><li><p>AnnotationConfigApplicationContext：从一个或多个基于 Java 的配置类中加载 Spring 应用上下文。</p></li> <li><p>AnnotationConfigWebApplicationContext：从一个或多个基于 Java 的配置类中加载 Spring Web 应用上下文。</p></li> <li><p>ClassPathXmlApplicationContext：从类路径下的一个或多个 XML 配置文件中加载上下文定义，把应用上下文的定义文件作为类资源。</p></li> <li><p>FileSystemXmlApplicationContext：从文件系统下的一个或多个 XML 配置文件中加载上下文定义。</p></li> <li><p>XmlWebApplicationContext：从 Web 应用下的一个或多个 XML 配置文件中加载上下文定义。</p></li></ul> <p>应用上下文准备就绪后，我们就可以调用上下文的 getBean() 方法从 Spring 容器中获取 bean。</p> <h3 id="_1-2-2-bean-的生命周期"><a href="#_1-2-2-bean-的生命周期" class="header-anchor">#</a> 1.2.2 bean 的生命周期</h3> <p>在传统的 Java 应用中，bean 的生命周期很简单。使用 Java 关键字 new 进行 bean 实例化，然后该 bean 就可以使用了。一旦该 bean 不再被使用，则由 Java 自动进行垃圾回收。</p> <p>相比之下，Spring 容器中的 bean 的生命周期就显得相对复杂多了。</p> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/1542472/1594175752927-fa7c859c-2f50-458f-97cd-56fb8979e730.png" alt="img"></p> <p>正如你所见，在 bean 准备就绪之前，bean 工厂执行了若干启动步骤。我们对上图进行详细描述：</p> <ol><li><p>Spring 对 bean 进行实例化；</p></li> <li><p>Spring 将值和 bean 的引用注入到 bean 对应的属性中；</p></li> <li><p>如果 bean 实现了 BeanNameAware 接口，Spring 将 bean 的 ID 传递给 setBeanName() 方法；</p></li> <li><p>如果 bean 实现了 BeanFactoryAware 接口，Spring 将调用 setBeanFactory() 方法，将 BeanFactory 容器实例传入；</p></li> <li><p>如果 bean 实现了 ApplicationContextAware 接口，Spring 将调用 setApplicationContext() 方法，将 bean 所在的应用上下文的引用传入进来；</p></li> <li><p>如果 bean 实现了 BeanPostProcessor 接口，Spring 将调用它们的 postProcessBeforeInitialization() 方法；</p></li> <li><p>如果 bean 实现了 InitializingBean 接口，Spring 将调用它们的 afterPropertiesSet() 方法。类似地，如果 bean 使用 init-method 声明了初始化方法，该方法也会被调用；</p></li> <li><p>如果 bean 实现了 BeanPostProcessor 接口，Spring 将调用它们的 postProcessAfterInitialization() 方法；</p></li> <li><p>此时，bean 已经准备就绪，可以被应用程序使用了，它们将一直驻留在应用上下文中，直到该应用上下文被销毁；</p></li> <li><p>如果 bean 实现了 DisposableBean 接口，Spring 将调用它的 destroy() 接口方法。同样，如果 bean 使用 destroy-method 声明了销毁方法，该方法也会被调用。</p></li></ol> <h2 id="_1-3-俯瞰-spring-风景线"><a href="#_1-3-俯瞰-spring-风景线" class="header-anchor">#</a> 1.3 俯瞰 Spring 风景线</h2> <h3 id="_1-3-1-spring-模块"><a href="#_1-3-1-spring-模块" class="header-anchor">#</a> 1.3.1 Spring 模块</h3> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/1542472/1594186865447-8c5ced1d-6acf-49f1-b609-c349f4ba85e7.png" alt="img"></p> <p>Spring 模块依据其所属的功能可以划分为 6 类不同的功能，如上图所示。总体而言，这些模块为开发企业级应用提供了所需的一切。但是你也不必将应用建立在整个 Spring 框架之上，你可以自由地选择适合自身应用需求的 Spring 模块；当 Spring 不能满足需求时，完全可以考虑其他选择。事实上，Spring 甚至提供了与其他第三方框架和类库的集成点，这样你就不需要自己编写这样的代码了。</p> <h4 id="spring-核心容器"><a href="#spring-核心容器" class="header-anchor">#</a> Spring 核心容器</h4> <p>容器是 Spring 框架最核心的部分，它管理着 Spring 应用中 bean 的创建、配置和管理。所有的 Spring 模块都构建于核心容器之上。当你配置应用时，其实你隐式地使用了这些类。</p> <h4 id="spring-的-aop-模块"><a href="#spring-的-aop-模块" class="header-anchor">#</a> Spring 的 AOP 模块</h4> <p>在 AOP 模块中，Spring 对面向切面编程提供了丰富的支持。这个模块是 Spring 应用系统中开发切面的基础。与 DI 一样，AOP 可以帮助应用对象解耦。借助于 AOP，可以将遍布系统的关注点（例如事务和安全）从它们所应用的对象中解耦出来。</p> <h4 id="数据访问与集成"><a href="#数据访问与集成" class="header-anchor">#</a> 数据访问与集成</h4> <h4 id="web-与远程调用"><a href="#web-与远程调用" class="header-anchor">#</a> Web 与远程调用</h4> <h4 id="instrumentation"><a href="#instrumentation" class="header-anchor">#</a> Instrumentation</h4> <h4 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h4> <h3 id="_1-3-2-spring-portfolio"><a href="#_1-3-2-spring-portfolio" class="header-anchor">#</a> 1.3.2 Spring Portfolio</h3> <p>当谈论 Spring 时，其实它远远超出我们的想象。事实上，Spring 远不是 Spring 框架所下载的那些。整个 Spring Portfolio 包括多个构建于核心 Spring 框架之上的框架和类库。</p> <ul><li><p>Spring Web Flow</p></li> <li><p>Spring Web Service</p></li> <li><p>Spring Security</p></li> <li><p>Spring Integration</p></li> <li><p>Spring Batch</p></li> <li><p>Spring Data</p></li> <li><p>Spring Social</p></li> <li><p>Spring Mobile</p></li> <li><p>Spring for Android</p></li> <li><p>Spring Boot</p></li></ul> <h1 id="_2-装配-bean"><a href="#_2-装配-bean" class="header-anchor">#</a> 2 装配 Bean</h1> <hr> <p>正如我们第 1 章中所看到的，创建应用对象之间关联关系的传统方法（通过构造器或者查找）通常会导致结构复杂的代码，这些代码很难被复用也很难进行单元测试。如果情况不严重的话，这些对象所做的事情只是超出了它应该做的范围；而最坏的情况则是，这些对象彼此之间高度耦合，难以复用和测试。</p> <p>在 Spring 中，对象无需自己查找或创建与其所关联的其他对象。相反，容器负责把需要相互协作的对象引用赋予各个对象。创建应用对象之间协作关系的行为通常称为装配（wiring），这也是依赖注入（DI）的本质。</p> <h2 id="_2-1-spring-配置的可选方案"><a href="#_2-1-spring-配置的可选方案" class="header-anchor">#</a> 2.1 Spring 配置的可选方案</h2> <p>Spring 容器负责创建应用程序中的 bean 并通过 DI 来协调这些对象之间的关系。但是，作为开发人员，你需要告诉 Spring 要创建哪些 bean 并且如何将其装配在一起。当描述 bean 如何进行装配时，Spring 具有非常大的灵活性，它提供了三种主要的装配机制：</p> <ul><li><p>在 XML 中进行显式配置</p></li> <li><p>在 Java 中进行显式配置</p></li> <li><p>隐式的 bean 发现机制和自动装配</p></li></ul> <h2 id="_2-2-自动化装配-bean"><a href="#_2-2-自动化装配-bean" class="header-anchor">#</a> 2.2 自动化装配 bean</h2> <p>Spring 从两个角度来实现自动化装配：</p> <ul><li>组件扫描（component scanning）：Spring 会自动发现应用上下文中所创建的 bean。</li> <li>自动装配（autowiring）：Spring 自动满足 bean 之间的依赖。</li></ul> <h3 id="_2-2-1-创建可被发现的-bean"><a href="#_2-2-1-创建可被发现的-bean" class="header-anchor">#</a> 2.2.1 创建可被发现的 bean</h3> <p>在这个 MP3 和流式媒体音乐的时代，CD（compact disc）显得有点典雅甚至陈旧。尽管如此，CD 为我们阐述 DI 如何运行提供了一个很好的样例。如果你不将 CD 插入（注入）到 CD 播放器中，那么 CD 播放器其实是没有太大用处的。所以，可以这样说，CD 播放器依赖于 CD 才能完成它的使命。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// CompactDisc 接口在 Java 中定义了 CD 的概念</span>
<span class="token keyword">package</span> <span class="token namespace">soundsystem</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CompactDisc</span> <span class="token punctuation">{</span>
	<span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 带有 @Component 注解的 CompactDisc 实现类 SgtPeppers</span>
<span class="token keyword">package</span> <span class="token namespace">soundsystem</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SgtPeppers</span> <span class="token keyword">implements</span> <span class="token class-name">CompactDisc</span> <span class="token punctuation">{</span>
	
    <span class="token keyword">private</span> <span class="token class-name">String</span> title <span class="token operator">=</span> <span class="token string">&quot;Sgt. Pepper's Lonely Hearts Club Band&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> artist <span class="token operator">=</span> <span class="token string">&quot;The Beatles&quot;</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Playing &quot;</span> <span class="token operator">+</span> title <span class="token operator">+</span> <span class="token string">&quot; by&quot;</span> <span class="token operator">+</span> artist<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre></div><p>需要注意的是 SgtPeppers 类上使用了 <code>@Component</code> 注解。这个简单的注解表明该类会作为组件类，并告知 Spring 要为这个类创建 bean。</p> <p>不过，组件扫描默认是不启用的。我们还需要显式配置一下 Spring，从而命令它去寻找带有 <code>@Component</code> 注解的类，并为其创建 bean。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">soundsystem</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ComponentScan</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span> <span class="token comment">// 该注解能够在 Spring 中启用组件扫描</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayerConfig</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>如果没有其他配置的话，<code>@Component</code> 默认会扫描与配置类相同的包。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 通过 XML 启用组件扫描 --&gt;</span>
<span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/aop/spring-context.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>soundsystem<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 测试组件扫描能够发现 CompactDisc</span>
<span class="token keyword">package</span> <span class="token namespace">soundsystem</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Assert</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ContextConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>classes<span class="token operator">=</span><span class="token class-name">CDPlayerConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayerTest</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">CompactDisc</span> cd<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cdShouldNotBeNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token function">assertNotNull</span><span class="token punctuation">(</span>cd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-2-2-为组件扫描的-bean-命名"><a href="#_2-2-2-为组件扫描的-bean-命名" class="header-anchor">#</a> 2.2.2 为组件扫描的 bean 命名</h3> <p>Spring 应用上下文中所有的 bean 都会给定一个 ID。在前面的例子中，尽管我们没有明确地为 <code>SgtPeppers</code> bean 设置 ID，但 Spring 会根据类名为其指定一个 ID。具体来讲，这个 bean 所给定的 ID 为 <code>sgtPeppers</code>，也就是将类名的第一个字母变为小写。</p> <p>如果想为这个 bean 设置不同的 ID，你所要做的就是将期望的 ID 作为值传递给 <code>@Component</code> 注解。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">&quot;lonelyHeartClub&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SgtPeppers</span> <span class="token keyword">implements</span> <span class="token class-name">CompactDisc</span> <span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-2-3-设置组件扫描的基础包"><a href="#_2-2-3-设置组件扫描的基础包" class="header-anchor">#</a> 2.2.3 设置组件扫描的基础包</h3> <p>到现在为止，我们没有为 <code>@ComponentScan</code> 设置任何属性。这意味着，按照默认规则，它会以配置类所在的包作为基础包（base package）来扫描组件。但是，如果你想扫描不同的包，那该怎么办呢？或者，如果你想扫描多个基础包，那又该怎么办呢？</p> <p>为了指定不同的基础包，你所需要做的就是在 <code>@ComponentScan</code> 的 value 属性中指明包的名称：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;soundsystem&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 等价于@ComponentScan(basePackages=&quot;soundsystem&quot;)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayerConfig</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>如果想要设置多个基础包，只需要将 basePackages 属性设置为要扫描包的一个数组即可：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;soundsystem&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;video&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayerConfig</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>在上面的例子中，所设置的基础包是以 String 类型表示的，这种方法是类型不安全的。如果你重构代码的话，那么所指定的基础包可能就会出现错误了。</p> <p>除了将包设置为简单的 String 类型之外，<code>@ComponentScan</code> 还提供了另外一种方法，那就是将其指定为包中所包含的类或接口：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackageClasses<span class="token operator">=</span><span class="token punctuation">{</span><span class="token class-name">CDPlayer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">DVDPlayer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayerConfig</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>在你的应用程序中，如果所有的对象都是独立的，彼此之间没有任何依赖，就像 <code>SgtPeppers</code> bean 这样，那么你所需要的可能就是组件扫描而已。但是，很多对象会依赖其他的对象才能完成任务。这样的话，我们就需要有一种方法能够将组件扫描得到的 bean 和它们的依赖装配在一起。要完成这项任务，我们需要了解一下 Spring 自动化配置的另外一方面内容，那就是自动装配。</p> <h3 id="_2-2-4-通过为-bean-添加注解实现自动装配"><a href="#_2-2-4-通过为-bean-添加注解实现自动装配" class="header-anchor">#</a> 2.2.4 通过为 bean 添加注解实现自动装配</h3> <p>简单来说，自动装配就是让 Spring 自动满足 bean 依赖的一种方法，在满足依赖的过程中，会在 Spring 应用上下文中寻找匹配某个 bean 需求的其他 bean。为了声明要进行自动装配，我们可以借助 Spring 的 <code>@Autowired</code> 注解。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 通过自动装配，将一个 CompactDisc 注入到 CDPlayer之中</span>
<span class="token keyword">package</span> <span class="token namespace">soundsystem</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayer</span> <span class="token keyword">implements</span> <span class="token class-name">MediaPlayer</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">CompactDisc</span> cd<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">CDPlayer</span><span class="token punctuation">(</span><span class="token class-name">CompactDisc</span> cd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>cd <span class="token operator">=</span> cd<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	cd<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面程序清单中的 CDPlayer 类。它的构造器上添加了 <code>@Autowired</code> 注解，这表明当 Spring 创建 CDPlayer bean 的时候，会通过这个构造器来进行实例化并且会传入一个可设置给 CompactDisc 类型的 bean。</p> <p><code>@Autowired</code> 注解不仅能够用在构造器上，还能用在属性的 Setter 方法上。比如说，如果 CDPlayer 有一个 <code>setCompactDisc()</code> 方法，那么可以采用如下的注解形式进行自动装配：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCompactDisc</span><span class="token punctuation">(</span><span class="token class-name">CompactDisc</span> cd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>cd <span class="token operator">=</span> cd<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在 Spring 初始化 bean 之后，它会尽可能得去满足 bean 得依赖，在本例中，依赖是通过带有 <code>@Autowired</code> 注解的方法进行声明的。</p> <p>实际上，Setter 方法并没有什么特殊之处。<code>@Autowired</code> 注解可以用在类的任何方法上。</p> <p>不管是构造器、Setter 方法还是其他的方法，Spring 都会尝试满足方法参数上所声明的依赖。假如有且只有一个 bean 匹配依赖需求的话，那么这个 bean 将会被装配进来。</p> <p>如果没有匹配的 bean，那么在应用上下文创建的时候，Spring 会抛出一个异常。为了避免异常的出现，你可以将 <code>@Autowired</code> 的 <code>required</code> 属性设置为 <code>false</code>：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span><span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCompactDisc</span><span class="token punctuation">(</span><span class="token class-name">CompactDisc</span> cd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>cd <span class="token operator">=</span> cd<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>将 <code>required</code> 属性设置为 <code>false</code> 时，Spring 会尝试执行自动装配，但是如果没有匹配的 bean 的话，Spring 将会让这个 bean 处于未装配的状态。但是，把 <code>required</code> 属性设置为 <code>false</code> 时，你需要谨慎对待。如果在你的代码中没有进行 null 检查的话，这个处于为装配状态的属性有可能会出现 <code>NullPointerException</code>。</p> <p>如果有多个 bean 能够满足依赖关系的话，Spring 将会抛出一个异常，表明没有明确指定要选择哪个 bean 进行自动装配。</p> <h3 id="_2-2-5-验证自动装配"><a href="#_2-2-5-验证自动装配" class="header-anchor">#</a> 2.2.5 验证自动装配</h3> <h2 id="_2-3-通过-java-代码装配-bean"><a href="#_2-3-通过-java-代码装配-bean" class="header-anchor">#</a> 2.3 通过 Java 代码装配 bean</h2> <p>尽管在很多场景下通过组件扫描和自动装配实现 Spring 的自动化配置是跟更为推荐的方式，但有时候自动化配置的方案行不通，因此需要明确配置 Spring。比如说，你想要将第三方库中的组件装配到你的应用中，在这种情况下，是没有办法在它的类上添加 <code>@Component</code> 和 <code>@Autowired</code> 注解的，因此就不能使用自动化装配的方案了。</p> <p>在这种情况下，你必须要采用显式装配的方式。在进行显式配置的时候，有两种可选方案：Java 和 XML。在进行显式配置时，JavaConfig 是更好的方案，因为它更为强大、类型安全并且对重构友好。</p> <h3 id="_2-3-1-创建配置类"><a href="#_2-3-1-创建配置类" class="header-anchor">#</a> 2.3.1 创建配置类</h3> <p>创建 JavaConfig 类的关键在于为其添加 <code>@Configuration</code> 注解，<code>@Configuration</code> 注解表明这个类是一个配置类。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">soundsystem</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ComponentScan</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayerConfig</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>为了展示显式配置，我们移除了 <code>@ComponentScan</code> 注解，此时的 CDPlayerConfig 类就没有任何作用了。如果现在运行 CDPlayerTest 的话，测试会失败，并且会出现 BeanCreationException 异常。</p> <h3 id="_2-3-2-声明简单的-bean"><a href="#_2-3-2-声明简单的-bean" class="header-anchor">#</a> 2.3.2 声明简单的 bean</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">CompactDisc</span> <span class="token function">sgtPeppers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SgtPeppers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>默认情况下，bean 的 ID 与带有 <code>@Bean</code> 注解的方法名是一样的。在本例中，bean 的名字将会是 sgtPeppers。如果你想为其设置成一个不同的名字的话，那么可以重命名该方法，也可以通过 name 属性指定一个不同的名字：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;lonelyHeartsClubBand&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CompactDisc</span> <span class="token function">sgtPeppers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SgtPeppers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-3-3-借助-javaconfig-实现注入"><a href="#_2-3-3-借助-javaconfig-实现注入" class="header-anchor">#</a> 2.3.3 借助 JavaConfig 实现注入</h3> <p>在 JavaConfig 中装配 bean 的最简单方式就是引用创建 bean 的方法。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">CDPlayer</span> <span class="token function">cdPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CDPlayer</span><span class="token punctuation">(</span><span class="token function">sgtPeppers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>cdPlayer()</code> 方法像 <code>sgtPeppers()</code> 方法一样，同样使用了 <code>@Bean</code> 注解，这表明这个方法会创建一个 bean 实例并将其注册到 Spring 应用上下文中。所创建的 bean ID 为 cdPlayer，与方法的名字相同。</p> <p>看起来，<code>CompactDisc</code> 是通过调用 <code>sgtPeppers()</code> 得到的，但情况并非完全如此。因为 <code>sgtPeppers()</code> 方法上添加了 <code>@Bean</code> 注解，Spring 将会拦截所有对它的调用，并确保直接返回该方法所创建的 bean，而不是每次都对其进行实际的调用。</p> <p>比如说，假设你引入了一个其他的 CDPlayer bean，它和之前的那个 bean 完全一样：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">CDPlayer</span> <span class="token function">cdPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CDPlayer</span><span class="token punctuation">(</span><span class="token function">sgtPeppers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">CDPlayer</span> <span class="token function">anotherCDPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CDPlayer</span><span class="token punctuation">(</span><span class="token function">sgtPeppers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>假如对 <code>sgtPeppers()</code> 的调用就像其他的 Java 方法调用一样的话，那么每个 CDPlayer 实例都会有一个自己特有的 SgtPeppers 实例。</p> <p>但是，在软件领域中，我们完全可以将同一个 SgtPeppers 实例注入到任意数量的其他 bean 之中。默认情况下，Spring 中的 bean 都是单例的，我们并没有必要为第二个 CDPlayer bean 创建完全相同的 SgtPeppers 实例。所以，Spring 会拦截对 <code>sgtPeppers()</code> 的调用并确保返回的是 Spring 所创建的 bean，也就是 Spring 本身在调用 <code>sgtPeppers()</code> 时所创建的 CompactDisc bean。因此，两个 CDPlayer bean 会得到相同的 SgtPeppers 实例。</p> <p>可以看到，通过调用方法来引用 bean 的方式有点令人困惑。其实还有一种理解起来更为简单的方式：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">CDPlayer</span> <span class="token function">cdPlayer</span><span class="token punctuation">(</span><span class="token class-name">CompactDisc</span> compactDisc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CDPlayer</span><span class="token punctuation">(</span>compactDisc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_2-4-通过-xml-装配-bean"><a href="#_2-4-通过-xml-装配-bean" class="header-anchor">#</a> 2.4 通过 XML 装配 bean</h2> <h3 id="_2-4-1-创建-xml-配置规范"><a href="#_2-4-1-创建-xml-配置规范" class="header-anchor">#</a> 2.4.1 创建 XML 配置规范</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 最简单的 Spring XML 配置 --&gt;</span>
<span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	
	<span class="token comment">&lt;!-- configuration details go here --&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>作为起步，在 JavaConfig 中所需要的只是 <code>@Configuration</code>，但在使用 XML 时，需要在配置文件的顶部声明多个 XML 模式（XSD）文件，这些文件定义了配置 Spring 的 XML 元素。</p> <p>用来装配 bean 的最基本的 XML 元素包含在 spring-beans模式之中，在上面这个 XML 文件中，它被定义为根命名空间。<beans>是该模式中的一个元素，它是所有 Spring 配置文件的根元素。</beans></p> <h3 id="_2-4-2-声明一个简单的"><a href="#_2-4-2-声明一个简单的" class="header-anchor">#</a> 2.4.2 声明一个简单的<bean></bean></h3> <p>要在基于 XML 的 Spring 配置中声明一个 bean，我们要使用 spring-beans 模式中的另外一个元素：<bean>。</bean></p> <p>我们可以按照如下的方式声明 CompactDisc bean：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;bean class=&quot;soundsystem.SgtPeppers&quot; /&gt;
</code></pre></div><p>因为没有明确给定 ID，所以这个 bean 将会根据全限定类名来进行命名。在本例中，bean 的 ID 将会是“soundsystem.SgtPeppers#0”。其中，“#0”是一个计数的形式，用来区分相同类型的其他 bean。如果声明了另外一个 SgtPeppers，并且没有明确进行标识，那么它自动得到的 ID 将会是“soundsystem.SgtPeppers#1”。</p> <p>尽管自动化的 bean 命名方式非常方便，但如果你要稍后引用它的话，那自动产生的名字就没有多大的用处了。因此，通常来讲更好的办法是借助 id 属性，为每个 bean 设置一个你自己选择的名字：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;bean id=&quot;compactDisc&quot; class=&quot;soundsystem.SgtPeppers&quot; /&gt;
</code></pre></div><h3 id="_2-4-3-借助构造器注入初始化-bean"><a href="#_2-4-3-借助构造器注入初始化-bean" class="header-anchor">#</a> 2.4.3 借助构造器注入初始化 bean</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cdPlayer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>soundsystem.CDPlayer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>compactDisc<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="将字面量注入到构造器中"><a href="#将字面量注入到构造器中" class="header-anchor">#</a> 将字面量注入到构造器中</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">soundsystem</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlankDisc</span> <span class="token keyword">implements</span> <span class="token class-name">CompactDisc</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> artist<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">BlankDisc</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> artist<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>artist <span class="token operator">=</span> artist<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Playing &quot;</span> <span class="token operator">+</span> title <span class="token operator">+</span> <span class="token string">&quot; by &quot;</span> <span class="token operator">+</span> artist<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在 SgtPeppers 中，唱片名称和艺术家的名字都是硬编码的，但是这个 CompactDisc 实现与之不同，它更加灵活。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>compactDisc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>soundsystem.BlankDisc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Sgt. Pepper<span class="token punctuation">'</span>s Lonely Hearts Club Band<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>The Beatles<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="装配集合"><a href="#装配集合" class="header-anchor">#</a> 装配集合</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">soundsystem<span class="token punctuation">.</span>collections</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">soundsystem<span class="token punctuation">.</span></span><span class="token class-name">CompactDisc</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlankDisc</span> <span class="token keyword">implements</span> <span class="token class-name">CompactDisc</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> artist<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> tracks<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">BlankDisc</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> artist<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> tracks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>artist <span class="token operator">=</span> artist<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>tracks <span class="token operator">=</span> tracks<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Playing &quot;</span> <span class="token operator">+</span> title <span class="token operator">+</span> <span class="token string">&quot; by &quot;</span> <span class="token operator">+</span> artist<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> track <span class="token operator">:</span> tracks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-Track: &quot;</span> <span class="token operator">+</span> track<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>compactDisc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>soundsystem.BlankDisc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Sgt. Pepper<span class="token punctuation">'</span>s Lonely Hearts Club Band<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>The Beatles<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>Sgt. Pepper's Lonely Hearts Club Band<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>With a Little Help from My Friends<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>Lucy in the Sky with Diamonds<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>Getting Better<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>constructor-arg</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_2-4-4-设置属性"><a href="#_2-4-4-设置属性" class="header-anchor">#</a> 2.4.4 设置属性</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cdPlayer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>soundsystem.CDPlayer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>compactDisc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>compactDisc<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="将字面量注入到属性中"><a href="#将字面量注入到属性中" class="header-anchor">#</a> 将字面量注入到属性中</h4> <h2 id="_2-5-导入和混合配置"><a href="#_2-5-导入和混合配置" class="header-anchor">#</a> 2.5 导入和混合配置</h2> <h3 id="_2-5-1-在-javaconfig-中引用-xml-配置"><a href="#_2-5-1-在-javaconfig-中引用-xml-配置" class="header-anchor">#</a> 2.5.1 在 JavaConfig 中引用 XML 配置</h3> <div class="language- extra-class"><pre class="language-text"><code>@Import(CDPlayerConfig.class)
@ImportResource(&quot;classpath:cd-config.xml&quot;)
</code></pre></div><h3 id="_2-5-2-在-xml-配置中引用-javaconfig"><a href="#_2-5-2-在-xml-配置中引用-javaconfig" class="header-anchor">#</a> 2.5.2 在 XML 配置中引用 JavaConfig</h3> <div class="language- extra-class"><pre class="language-text"><code>&lt;import resource=&quot;cd-config.xml&quot; /&gt;
&lt;bean class=&quot;soundsystem.CDConfig&quot; /&gt;
</code></pre></div><h1 id="_3-高级装配"><a href="#_3-高级装配" class="header-anchor">#</a> 3 高级装配</h1> <hr> <h2 id="_3-1-环境与-profile"><a href="#_3-1-环境与-profile" class="header-anchor">#</a> 3.1 环境与 profile</h2> <p>在开发软件的时候，有一个很大的挑战就是将应用程序从一个环境迁移到另外一个环境。</p> <h3 id="_3-1-1-配置-profile-bean"><a href="#_3-1-1-配置-profile-bean" class="header-anchor">#</a> 3.1.1 配置 profile bean</h3> <p>Spring 为环境相关的 bean 所提供的解决方案其实与构建时的方案没有太大的差别。当然，在这个过程中需要根据环境决定该创建哪个 bean 和不创建哪个 bean。不过 Spring 并不是在构建的时候做出这样的决策，而是等到运行时再来确定。这样的结果就是同一个部署单元能够适用于所有的环境，没有必要进行重新构建。</p> <p>要使用 profile，你首先要将所有不同的 bean 定义整理到一个或多个 profile 之中，在将应用部署到每个环境时，要确保对应的 profile 处于激活的状态。</p> <p>在 Java 配置中，可以使用 <code>@Profile</code> 注解指定某个 bean 属于哪一个 profile。</p> <h4 id="在-xml-中配置-profile"><a href="#在-xml-中配置-profile" class="header-anchor">#</a> 在 XML 中配置 profile</h4> <p>我们也可以通过 <beans> 元素的 profile 属性，在 XML 中配置 profile bean。</beans></p> <p>所有的配置文件都会放到部署单元之中，但是只有 profile 属性与当前激活 profile 相匹配的配置文件才会被用到。</p> <h3 id="_3-1-2-激活-profile"><a href="#_3-1-2-激活-profile" class="header-anchor">#</a> 3.1.2 激活 profile</h3> <p>Spring 在确定哪个 profile 处于激活状态时，需要依赖两个独立的属性：spring.profiles.active 和 spring.profiles.default。</p> <p>如果设置了 spring.profiles.active 属性的话，那么它的值就会用来确定哪个 profile 是激活的。但如果没有设置 spring.profiles.active 属性的话，那 Spring 将会查找 spring.profiles.default 的值。如果 spring.profiles.active 和 spring.profiles.default 均没有设置的话，那就没有激活的 profile，因此只会创建那些没有定义在 profile 中的 bean。</p> <p>有多种方式来设置这两个属性：</p> <ul><li><p>作为 DispatcherServlet 的初始化参数</p></li> <li><p>作为 Web 应用的上下文参数</p></li> <li><p>作为 JNDI 条目</p></li> <li><p>作为环境变量</p></li> <li><p>作为 JVM 的系统属性</p></li> <li><p>在集成测试类上，使用 <code>@ActiveProfiles</code> 注解设置</p></li></ul> <h2 id="_3-2-条件化的-bean"><a href="#_3-2-条件化的-bean" class="header-anchor">#</a> 3.2 条件化的 bean</h2> <p><code>@Conditional</code> 注解可以用到带有 <code>@Bean</code> 注解的方法上，如果给定的条件计算结果为 <code>true</code>，就会创建这个 bean，否则的话，这个 bean 会被忽略。</p> <p><code>@Conditional</code> 将会通过 Condition 接口进行条件对比：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Condition</span> <span class="token punctuation">{</span>
	<span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> ctxt<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>设置给 <code>@Conditional</code> 的类可以是任意实现了 Condition 接口的类型。如果 <code>matches()</code> 方法返回 <code>true</code>，那么就会创建带有 <code>@Conditional</code> 注解的 bean。</p> <h2 id="_3-3-处理自动装配的歧义性"><a href="#_3-3-处理自动装配的歧义性" class="header-anchor">#</a> 3.3 处理自动装配的歧义性</h2> <p>如果不仅有一个 bean 能够匹配结果的话，这种歧义性会阻碍 Spring 自动装配属性、构造器参数或方法参数。</p> <p>为了阐述自动装配的歧义性，假设我们使用 <code>@Autowired</code> 注解标注了 <code>setDessert()</code> 方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDessert</span><span class="token punctuation">(</span><span class="token class-name">Dessert</span> dessert<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>dessert <span class="token operator">=</span> dessert<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在本例中，Dessert 是一个接口，并且有三个类实现了这个接口，分别为 Cake、Cookies 和 IceCream：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cake</span> <span class="token keyword">implements</span> <span class="token class-name">Dessert</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cookies</span> <span class="token keyword">implements</span> <span class="token class-name">Dessert</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IceCream</span> <span class="token keyword">implements</span> <span class="token class-name">Dessert</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div><p>因为这三个实现均使用了 <code>@Component</code> 注解，在组件扫描的时候，能够发现它们并将其创建为 Spring 应用上下文里面的 bean。然后，当 Spring 试图自动装配 <code>setDessert()</code> 中的 Dessert 参数时，它并没有唯一、无歧义的可选值。</p> <h3 id="_3-3-1-标示首选的-bean"><a href="#_3-3-1-标示首选的-bean" class="header-anchor">#</a> 3.3.1 标示首选的 bean</h3> <p>在声明 bean 的时候，通过将其中一个可选的 bean 设置为首选（primary）bean 能够避免自动装配时的歧义性。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Primary</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IceCream</span> <span class="token keyword">implements</span> <span class="token class-name">Dessert</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-3-2-限定自动装配的-bean"><a href="#_3-3-2-限定自动装配的-bean" class="header-anchor">#</a> 3.3.2 限定自动装配的 bean</h3> <p><code>@Qualifier</code> 注解是使用限定符的主要方式。它可以与 <code>@Autowired</code> 和 <code>@Inject</code> 协同使用，在注入的时候指定想要注入进去的是哪个 bean。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;iceCream&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDessert</span><span class="token punctuation">(</span><span class="token class-name">Dessert</span> dessert<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>dessert <span class="token operator">=</span> dessert<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="创建自定义的限定符"><a href="#创建自定义的限定符" class="header-anchor">#</a> 创建自定义的限定符</h4> <p>我们可以为 bean 设置自己的限定符，而不是依赖于将 bean ID 作为限定符。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;cold&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IceCream</span> <span class="token keyword">implements</span> <span class="token class-name">Dessert</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;cold&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDessert</span><span class="token punctuation">(</span><span class="token class-name">Dessert</span> dessert<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>dessert <span class="token operator">=</span> dessert<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="使用自定义的限定符注解"><a href="#使用自定义的限定符注解" class="header-anchor">#</a> 使用自定义的限定符注解</h4> <h2 id="_3-4-bean-的作用域"><a href="#_3-4-bean-的作用域" class="header-anchor">#</a> 3.4 bean 的作用域</h2> <p>在默认情况下，Spring 应用上下文中所有 bean 都是作为以单例（singleton）的形式创建。也就是说，不管给定的一个 bean 被注入到其他 bean 多少次，每次所注入的都是同一个实例。</p> <p>有时候，可能会发现，你所使用的类是易变的，它们会保持一些状态，因此重用是不安全的。</p> <p>Spring 定义了多种作用域，可以基于这些作用域创建 bean，包括：</p> <ul><li><p>单例（Singleton）：在整个应用中，只创建 bean 的一个实例。</p></li> <li><p>原型（Prototype）：每次注入或者通过 Spring 应用上下文获取的时候，都会创建一个新的 bean 实例。</p></li> <li><p>会话（Session）：在 Web 应用中，为每个会话创建一个 bean 实例。</p></li> <li><p>请求（Request）：在 Web 应用中，为每个请求创建一个 bean 实例。</p></li></ul> <p>单例是默认的作用域，但是正如之前所述，对于易变的类型，这并不合适。如果选择其他的作用域，要使用 <code>@Scope</code> 注解，它可以与 <code>@Component</code> 或 <code>@Bean</code> 一起使用。</p> <p>自动装配：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableBeanFactory</span><span class="token punctuation">.</span>SCOPE_PROTOTYPE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Notepad</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div><p>Java 配置：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableBeanFactory</span><span class="token punctuation">.</span>SCOPE_PROTOTYPE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Notepad</span> <span class="token function">notepad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Notepad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>XML 配置：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>notepad<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.myapp.Notepad<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>prototype<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><h3 id="_3-4-1-使用会话和请求作用域"><a href="#_3-4-1-使用会话和请求作用域" class="header-anchor">#</a> 3.4.1 使用会话和请求作用域</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token class-name">WebApplicationContext</span><span class="token punctuation">.</span>SCOPE_SESSION<span class="token punctuation">,</span>
       proxyMode<span class="token operator">=</span><span class="token class-name">ScopedProxyMode</span><span class="token punctuation">.</span>INTERFACES<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ShoppingCart</span> <span class="token function">cart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div><p>要注意的是，<code>@Scope</code> 除了value，同时还有一个 proxyMode 属性，它被设置成了 ScopedProxyMode.INTERFACES。这个属性解决了将会话或请求作用域的 bean 注入到单例 bean 中所遇到的问题。</p> <p>假设我们要将 ShoppingCart bean 注入到单例 StoreService bean 的 Setter 方法中，如下所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StoreService</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setShoppingCart</span><span class="token punctuation">(</span><span class="token class-name">ShoppingCart</span> shoppingCart<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>shoppingCart <span class="token operator">=</span> shoppingCart<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>因为 StoreService 是一个单例的 bean，会在 Spring 应用上下文加载的时候创建。当它创建的时候，Spring 会试图将 shoppingCart bean 注入到 <code>setShoppingCart()</code> 方法中。但是，ShoppingCart bean 是会话作用域的，此时并不存在。直到某个用户进入系统，创建了会话之后，才会出现 ShoppingCart 实例。</p> <p>另外，系统中将会有多个 ShoppingCart 实例：每个用户一个。我们并不想让 Spring 注入某个固定的 ShoppingCart 实例到 StoreService 中。我们希望的是当 StoreService 处理购物车功能时，它所使用的 ShoppingCart 实例恰好是当前会话所对应的那一个。</p> <p>Spring 并不会将实际的 ShoppingCart bean 注入到 StoreService 中，Spring 会注入一个到 ShoppingCart bean 的代理，如图所示。</p> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/1542472/1595903327349-113dc7f9-29a5-4f22-bf6d-e138fc782d37.png" alt="img"></p> <p>这个代理会暴露与 ShoppingCart 相同的方法，所以 StoreService 会认为它就是一个购物车。但是，当 StoreService 调用 ShoppingCart 的方法时，代理会对其进行懒解析并将调用委托给会话作用域内真正的 ShoppingCart bean。</p> <p>proxyMode 属性被设置成了 ScopedProxyMode.INTERFACES，这表明这个代理要实现 ShoppingCart 接口，并将调用委托给实现 bean。但如果 ShoppingCart 是一个具体的类的话，Spring 就没有办法创建基于接口的代理了。此时，它必须使用 CGLib 来生成基于类的代理。所以 proxyMode 属性应该设置为 ScopedProxyMode.TARGET_CLASS，以此来表明要以生成目标类扩展的方式创建代理。</p> <h3 id="_3-4-2-在-xml-中声明作用域代理"><a href="#_3-4-2-在-xml-中声明作用域代理" class="header-anchor">#</a> 3.4.2 在 XML 中声明作用域代理</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cart<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.myapp.ShoppingCart<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>session<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>scoped-proxy</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>默认情况下，它会使用 CGLib 创建目标类的代理。但是我们可以将 proxy-target-class 属性设置为 false，进而要求它生成基于接口的代理：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cart<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.myapp.ShoppingCart<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>session<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>scoped-proxy</span> <span class="token attr-name">proxy-target-class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="_3-5-运行时注入"><a href="#_3-5-运行时注入" class="header-anchor">#</a> 3.5 运行时注入</h2> <p>Spring 提供了两种在运行时求值的方式：</p> <ul><li>属性占位符</li> <li>Spring 表达式语言</li></ul> <h3 id="_3-5-1-注入外部的值"><a href="#_3-5-1-注入外部的值" class="header-anchor">#</a> 3.5.1 注入外部的值</h3> <p>在 Spring 中，处理外部值的最简单方式就是声明属性源并通过 Spring 的 Environment 来检索属性。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>soundsystem</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PropertySource</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>env<span class="token punctuation">.</span></span><span class="token class-name">Environment</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:/com/soundsystem/app.properties&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExpressiveConfig</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">Environment</span> env<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">BlankDisc</span> <span class="token function">disc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BlankDisc</span><span class="token punctuation">(</span>env<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;disc.title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> env<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;disc.artist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="深入学习-spring-的-environment"><a href="#深入学习-spring-的-environment" class="header-anchor">#</a> 深入学习 Spring 的 Environment</h4> <h4 id="解析属性占位符"><a href="#解析属性占位符" class="header-anchor">#</a> 解析属性占位符</h4> <p>Spring 一直支持将属性定义到外部的属性的文件中，并使用占位符值将其插入到 Spring bean 中。在 Spring 装配中，占位符的形式为使用 &quot;${...}&quot; 包装的属性名称。</p> <h3 id="_3-5-2-使用-spring-表达式语言进行装配"><a href="#_3-5-2-使用-spring-表达式语言进行装配" class="header-anchor">#</a> 3.5.2 使用 Spring 表达式语言进行装配</h3> <p>SpEL 表达式要放到 &quot;#{...}&quot; 之中。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 计算表达式的那一刻当前时间的毫秒数</span>
#<span class="token punctuation">{</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
</code></pre></div><p>T() 表达式会将 java.lang.System 视为 Java 中对应的类型，因此可以调用其 static 修饰的 <code>currentTimeMillis()</code> 方法。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 得到 ID 为 sgtPeppers 的 bean 的 artist 属性</span>
#<span class="token punctuation">{</span>sgtPeppers<span class="token punctuation">.</span>artist<span class="token punctuation">}</span>
</code></pre></div><h4 id="表示字面值"><a href="#表示字面值" class="header-anchor">#</a> 表示字面值</h4> <h4 id="引用-bean、属性和方法"><a href="#引用-bean、属性和方法" class="header-anchor">#</a> 引用 bean、属性和方法</h4> <div class="language-java extra-class"><pre class="language-java"><code>#<span class="token punctuation">{</span>sgtPeppers<span class="token punctuation">}</span> <span class="token comment">// 通过 ID 引用 bean</span>
#<span class="token punctuation">{</span>sgtPeppers<span class="token punctuation">.</span>artist<span class="token punctuation">}</span> <span class="token comment">// 引用属性</span>
#<span class="token punctuation">{</span>artistSelector<span class="token punctuation">.</span><span class="token function">selectArtist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token comment">// 引用方法</span>
</code></pre></div><h4 id="在表达式中使用类型"><a href="#在表达式中使用类型" class="header-anchor">#</a> 在表达式中使用类型</h4> <p>如果要在 SpEL 中访问类作用域的方法和常量的话，要依赖 T() 这个关键的运算符。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Math</span><span class="token punctuation">)</span>
<span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Math</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PI
</code></pre></div><h4 id="spel-运算符"><a href="#spel-运算符" class="header-anchor">#</a> SpEL 运算符</h4> <h4 id="计算正则表达式"><a href="#计算正则表达式" class="header-anchor">#</a> 计算正则表达式</h4> <h4 id="计算集合"><a href="#计算集合" class="header-anchor">#</a> 计算集合</h4> <h1 id="_4-面向切面的-spring"><a href="#_4-面向切面的-spring" class="header-anchor">#</a> 4 面向切面的 Spring</h1> <hr> <p>在软件开发中，散布于应用中多处的功能被称为横切关注点。通常来讲，这些横切关注点从概念上是与应用的业务逻辑相分离的（但是往往会直接嵌入到应用的业务逻辑之中）。把这些横切关注点与业务逻辑相分离正是面向切面编程（AOP）所要解决的问题。</p> <h2 id="_4-1-什么是面向切面编程"><a href="#_4-1-什么是面向切面编程" class="header-anchor">#</a> 4.1 什么是面向切面编程</h2> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/1542472/1595984057031-a7175cc8-c568-47b1-9f68-386615969507.png" alt="img"></p> <p>上图展现了一个被划分为模块的典型应用。每个模块的核心功能都是为特定业务领域提供服务，但是这些模块都需要类似的辅助功能，例如安全和事务管理。</p> <p>横切关注点可以被模块化为特殊的类，这些类被称为切面（aspect）。这样做有两个好处：首先，现在每个关注点都集中于一个地方，而不是分散到多处代码中；其次，服务模块更加简洁，因为它们只包含主要关注点（或核心功能）的代码，而次要关注点的代码被转移到切面中了。</p> <h3 id="_4-1-1-定义-aop-术语"><a href="#_4-1-1-定义-aop-术语" class="header-anchor">#</a> 4.1.1 定义 AOP 术语</h3> <h4 id=""><a href="#" class="header-anchor">#</a> <img src="https://cdn.nlark.com/yuque/0/2020/png/1542472/1596026477482-4681ab93-9149-4bb8-8a2a-8edbc057308d.png" alt="img"></h4> <h4 id="通知-advice"><a href="#通知-advice" class="header-anchor">#</a> 通知（Advice）</h4> <p>在 AOP 术语中，切面的工作被称为通知。通知定义了切面是什么以及何时使用。</p> <p>Spring 切面可以应用 5 种类型的通知：</p> <ul><li><p>前置通知</p></li> <li><p>后置通知</p></li> <li><p>返回通知</p></li> <li><p>异常通知</p></li> <li><p>环绕通知</p></li></ul> <h4 id="连接点-join-point"><a href="#连接点-join-point" class="header-anchor">#</a> 连接点（Join point）</h4> <p>连接点是在应用执行过程中能够插入切面的一个点。</p> <h4 id="切点-poincut"><a href="#切点-poincut" class="header-anchor">#</a> 切点（Poincut）</h4> <p>如果说通知定义了切面的“什么”和“何时”的话，那么切点就定义了“何处”。切点的定义会匹配通知所要织入的一个或多个连接点。</p> <h4 id="切面-aspect"><a href="#切面-aspect" class="header-anchor">#</a> 切面（Aspect）</h4> <p>切面是通知和切点的结合。</p> <h4 id="引入-introduction"><a href="#引入-introduction" class="header-anchor">#</a> 引入（Introduction）</h4> <p>引入允许我们向现有的类添加新方法或属性。</p> <h4 id="织入-weaving"><a href="#织入-weaving" class="header-anchor">#</a> 织入（Weaving）</h4> <p>织入是把切面应用到目标对象并创建新的代理对象的过程。切面在指定的连接点被织入到目标对象中。在目标对象的生命周期里有多个点可以进行织入：</p> <ul><li><p>编译期：切面在目标类编译时被织入。这种方式需要特殊的编译器。AspectJ 的织入编译器就是以这种方式织入切面的。</p></li> <li><p>类加载期：切面在目标类加载到 JVM 时被织入。这种方式需要特殊的类加载器，它可以在目标类被引入应用之前增强该目标类的字节码。AspectJ 5 的加载时织入就支持以这种方式织入切面。</p></li> <li><p>运行期：切面在应用运行的某个时刻被织入。一般情况下，在织入切面时，AOP 容器会为目标对象动态的创建一个代理对象。Spring AOP 就是以这种方式织入切面的。</p></li></ul> <h3 id="_4-1-2-spring-对-aop-的支持"><a href="#_4-1-2-spring-对-aop-的支持" class="header-anchor">#</a> 4.1.2 Spring 对 AOP 的支持</h3> <p>Spring 提供了 4 种类型的 AOP 支持：</p> <ul><li><p>基于代理的经典 Spring AOP</p></li> <li><p>纯 POJO 切面</p></li> <li><p>@AspectJ 注解驱动的切面</p></li> <li><p>注入式 AspectJ 切面</p></li></ul> <p>前三种都是 Spring AOP 实现的变体，Spring AOP 构建在动态代理基础之上，因此，Spring 对 AOP 的支持局限于方法拦截。</p> <h4 id="spring-在运行时通知对象"><a href="#spring-在运行时通知对象" class="header-anchor">#</a> Spring 在运行时通知对象</h4> <p>通过在代理类中包裹切面，Spring 在运行期把切面织入到 Spring 管理的 bean 中。如下图所示，代理类封装了目标类，并拦截被通知方法的调用，再把调用转发给真正的目标 bean。当代理拦截到方法调用时，在调用目标 bean 方法之前，会执行切面逻辑。</p> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/1542472/1596028986527-13424d89-c50b-4d63-9958-99590e14eb38.png" alt="img"></p> <p>直到应用需要被代理的 bean 时，Spring 才创建代理对象。</p> <h4 id="spring-只支持方法级别的连接点"><a href="#spring-只支持方法级别的连接点" class="header-anchor">#</a> Spring 只支持方法级别的连接点</h4> <h2 id="_4-2-通过切点来选择连接点"><a href="#_4-2-通过切点来选择连接点" class="header-anchor">#</a> 4.2 通过切点来选择连接点</h2> <p>切点用于准确定位应该在什么地方应用切面的通知。通知和切点是切面的最基本元素。在 Spring AOP 中，要使用 AspectJ 的切点表达式语言来定义切点。</p> <h3 id="_4-2-1-编写切点"><a href="#_4-2-1-编写切点" class="header-anchor">#</a> 4.2.1 编写切点</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">concert</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Performance</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1542472/1596034312501-4401d3e9-cac5-495d-94fb-4cb666c47b7f.png" alt="img"></p> <p>我们使用 <code>execution()</code> 指示器选择 Performance 的 <code>perform()</code> 方法。方法表达式以 &quot;*&quot; 开始，表明了我们不关心方法返回值的类型。然后，我们指定了全限定类名和方法名。对于方法参数列表，我们使用两个点号 (..) 表明切点要选择任意的 <code>perform()</code> 方法，无论该方法的入参是什么。</p> <h3 id="_4-2-2-在切点中选择-bean"><a href="#_4-2-2-在切点中选择-bean" class="header-anchor">#</a> 4.2.2 在切点中选择 bean</h3> <h2 id="_4-3-使用注解创建切面"><a href="#_4-3-使用注解创建切面" class="header-anchor">#</a> 4.3 使用注解创建切面</h2> <h3 id="_4-3-1-定义切面"><a href="#_4-3-1-定义切面" class="header-anchor">#</a> 4.3.1 定义切面</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Audience 类：观看演出的切面</span>
<span class="token keyword">package</span> <span class="token namespace">concert</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">AfterReturing</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">AfterThrowing</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Aspect</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Before</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Audience</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;execution(** concert.Performance.perform(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">silenceCellPhones</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Silencing cell phones&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;execution(** concert.Performance.perform(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">takeSeats</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Taking seats&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span><span class="token string">&quot;execution(** concert.Performance.perform(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">applause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;CLAP CLAP CLAP!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span><span class="token string">&quot;execution(** concert.Performance.perform(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demandRefund</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Demanding a refund&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Audience 类使用 <code>@Aspect</code> 注解进行了标注。该注解表明 Audience 不仅仅是一个 POJO，还是一个切面。Audience 类中的方法都使用注解来定义切面的具体行为。</p> <p>可以看到，这些方法都使用了通知注解来表明它们应该在什么时候调用。AspectJ 提供了五个注解来定义通知，如表所示。</p> <table><thead><tr><th>注解</th> <th>通知</th></tr></thead> <tbody><tr><td>@After</td> <td>通知方法会在目标方法返回或抛出异常后调用</td></tr> <tr><td>@AfterReturning</td> <td>通知方法会在目标方法返回后调用</td></tr> <tr><td>@AfterThrowing</td> <td>通知方法会在目标方法抛出异常后调用</td></tr> <tr><td>@Around</td> <td>通知方法会将目标方法封装起来</td></tr> <tr><td>@Before</td> <td>通知方法会在目标方法调用之前执行</td></tr></tbody></table> <p>上例中，相同的表达式我们重复了四遍，这样的重复让人感觉有些不对劲。如果我们只定义这个切点一次，然后每次需要的时候引用它，那么这会是一个很好的方案。</p> <p><code>@Pointcut</code> 注解能够在一个 <code>@AspectJ</code> 切面内定义可重用的切点。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">concert</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">AfterReturing</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">AfterThrowing</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Aspect</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Before</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Pointcut</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Audience</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(** concert.Performance.perform(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">performance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
	<span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;performance()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">silenceCellPhones</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Silencing cell phones&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;performance()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">takeSeats</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Taking seats&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span><span class="token string">&quot;performance()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">applause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;CLAP CLAP CLAP!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span><span class="token string">&quot;performance()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demandRefund</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Demanding a refund&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 在 JavaConfig 中启用 AspectJ 注解的自动代理</span>
<span class="token keyword">package</span> <span class="token namespace">concert</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ComponentScan</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableAspectJAutoProxy</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableAspectJAutoProxy</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcertConfig</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Audience</span> <span class="token function">audience</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Audience</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-3-2-环绕通知"><a href="#_4-3-2-环绕通知" class="header-anchor">#</a> 4.3.2 环绕通知</h3> <p>环绕通知能够让你所编写的逻辑将被通知的目标方法完全包装起来，实际上就像在一个通知方法中同时编写前置通知和后置通知。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 使用环绕通知重新实现 Audience 切面</span>
<span class="token keyword">package</span> <span class="token namespace">concert</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">ProceedingJoinPoint</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Aspect</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Around</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Pointcut</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Audience</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(** concert.Performance.perform(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">performance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
	<span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;performance()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">watchPerformance</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> jp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">try</span> <span class="token punctuation">{</span>
        	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Silencing cell phones&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Taking seats&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;CLAP CLAP CLAP!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Demanding a refund&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-3-3-处理通知中的参数"><a href="#_4-3-3-处理通知中的参数" class="header-anchor">#</a> 4.3.3 处理通知中的参数</h3> <h3 id="_4-3-4-通过注解引入新功能"><a href="#_4-3-4-通过注解引入新功能" class="header-anchor">#</a> 4.3.4 通过注解引入新功能</h3> <h2 id="_4-4-在-xml-中声明切面"><a href="#_4-4-在-xml-中声明切面" class="header-anchor">#</a> 4.4 在 XML 中声明切面</h2> <p>在本书前面的内容中，我曾经建立过这样一种原则，那就是基于注解的配置要优于基于 Java 的配置，基于 Java 的配置要优于基于 XML 的配置。但是，如果你需要声明切面，但是又不能为通知类添加注解的时候，那么就必须转向 XML 配置了。</p> <h3 id="_4-4-1-声明前置和后置通知"><a href="#_4-4-1-声明前置和后置通知" class="header-anchor">#</a> 4.4.1 声明前置和后置通知</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspect</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>audience<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>before</span> <span class="token attr-name">pointcut</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>execution(** concert.Performance.perform(..))<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>silenceCellPhones<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>before</span> <span class="token attr-name">pointcut</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>execution(** concert.Performance.perform(..))<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>takeSeats<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>after-returning</span> <span class="token attr-name">pointcut</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>execution(** concert.Performance.perform(..))<span class="token punctuation">&quot;</span></span>
                				 <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>applause<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>after-throwing</span> <span class="token attr-name">pointcut</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>execution(** concert.Performance.perform(..))<span class="token punctuation">&quot;</span></span>
                				<span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>demandRefund<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>aspect</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspect</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>audience<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>pointcut</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>performance<span class="token punctuation">&quot;</span></span>
                  <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>execution(** concert.Performance.perform(..))<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>before</span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>performance<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>silenceCellPhones<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>before</span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>performance<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>takeSeats<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>after-returning</span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>performance<span class="token punctuation">&quot;</span></span>
                				 <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>applause<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>after-throwing</span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>performance<span class="token punctuation">&quot;</span></span>
                				<span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>demandRefund<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>aspect</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_4-4-2-声明环绕通知"><a href="#_4-4-2-声明环绕通知" class="header-anchor">#</a> 4.4.2 声明环绕通知</h3> <h3 id="_4-4-3-为通知传递参数"><a href="#_4-4-3-为通知传递参数" class="header-anchor">#</a> 4.4.3 为通知传递参数</h3> <h3 id="_4-4-4-通过切面引入新的功能"><a href="#_4-4-4-通过切面引入新的功能" class="header-anchor">#</a> 4.4.4 通过切面引入新的功能</h3> <h2 id="_4-5-注入-aspectj-切面"><a href="#_4-5-注入-aspectj-切面" class="header-anchor">#</a> 4.5 注入 AspectJ 切面</h2> <p>虽然 Spring AOP 能够满足许多应用的切面需求，但是与 AspectJ 相比，Spring AOP 是一个功能比较弱的 AOP 解决方案。AspectJ 提供了 Spring AOP 所不能支持的许多类型的切点。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 使用 AspectJ 实现表演的评论员</span>
<span class="token keyword">package</span> <span class="token namespace">concert</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> aspect <span class="token class-name">CriticAspect</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token class-name">CriticAspect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    pointcut <span class="token function">performance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">afterReturing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">performance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>criticismEngine<span class="token punctuation">.</span><span class="token function">getCriticism</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token class-name">CriticismEngine</span> criticismEngine<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCriticismEngine</span><span class="token punctuation">(</span><span class="token class-name">CriticismEngine</span> criticismEngine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>criticismEngine <span class="token operator">=</span> criticismEngine<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="_5-构建-spring-web-应用程序"><a href="#_5-构建-spring-web-应用程序" class="header-anchor">#</a> 5 构建 Spring Web 应用程序</h1> <hr> <h2 id="_5-1-spring-mvc-起步"><a href="#_5-1-spring-mvc-起步" class="header-anchor">#</a> 5.1 Spring MVC 起步</h2> <h3 id="_5-1-1-跟踪-spring-mvc-的请求"><a href="#_5-1-1-跟踪-spring-mvc-的请求" class="header-anchor">#</a> 5.1.1 跟踪 Spring MVC 的请求</h3> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/1542472/1596190421556-512c5755-e0e6-430a-8c39-e2566cc9040b.png" alt="img"></p> <p>在请求离开浏览器时，会带有用户所请求内容的信息，至少会包含请求的URL。</p> <p>请求的第一站是 Spring 的 DispatcherServlet。与大多数基于 Java 的 Web 框架一样，Spring MVC 所有的请求都会通过一个前端控制器 Servlet。前端控制器是常用的 Web 应用程序模式，在这里一个单实例的 Servlet 将请求委托给应用程序的其他组件来执行实际的处理。在 Spring MVC 中，DispatcherServlet 就是前端控制器。</p> <p>DispatcherServlet 的任务是将请求发送给 Spring MVC 控制器。控制器（controller）是一个用于处理请求的 Spring 组件。在典型的应用程序中可能会有多个控制器，DispatcherServlet 需要知道应该将请求发送给哪个控制器。所以 DispatcherServlet 会查询一个或多个处理器映射来确定请求的下一站在哪里。处理器映射会根据请求所携带的 URL 信息来进行决策。</p> <p>一旦选择了合适的控制器，DispatcherServlet 会将请求发送给选中的控制器。到了控制器，请求会卸下其负载（用户提交的信息）并耐心等待控制器处理这些信息。（实际上，设计良好的控制器本身只处理很少甚至不处理工作，而是将业务逻辑委托给一个或多个服务对象进行处理。）</p> <p>控制器在完成逻辑处理后，通常会产生一些信息，这些信息需要返回给用户并在浏览器上显示。这些信息被称为模型（model）。不过仅仅给用户返回原始的信息是不够的——这些信息需要以用户友好的方式进行格式化，一般会是 HTML。所以，信息需要发送给一个视图（view），通常会是 JSP。</p> <p>控制器所做的最后一件事就是将模型数据打包，并且标示出用于渲染输出的视图名。它接下来会将请求连同模型和视图名发送回 DispatcherServlet。</p> <p>这样，控制器就不会与特定的视图相耦合，传递给 DispatcherServlet 的视图名并不直接表示某个特定的 JSP。实际上，它甚至并不能确定视图就是 JSP。相反，它仅仅传递了一个逻辑名称，这个名字将会用来查找产生结果的真正视图。DispatcherServlet 将会使用视图解析器来将逻辑视图名匹配为一个特定的视图实现，他可能是也可能不是 JSP。</p> <p>既然 DispatcherServlet 已经知道由哪个视图渲染结果，那请求的任务基本上也就完成了。它的最后一站是视图的实现（可能是 JSP），在这里它交付模型数据。请求的任务就完成了。视图将使用模型数据渲染输出，这个输出会通过响应对象传递给客户端。</p> <h3 id="_5-1-2-搭建-spring-mvc"><a href="#_5-1-2-搭建-spring-mvc" class="header-anchor">#</a> 5.1.2 搭建 Spring MVC</h3> <h4 id="配置-dispatcherservlet"><a href="#配置-dispatcherservlet" class="header-anchor">#</a> 配置 DispatcherServlet</h4> <p>DispatcherServlet 是 Spring MVC 的核心。在这里请求会第一次接触到框架，它要负责将请求路由到其他的组件之中。</p> <p>按照传统的方式，像 DispatcherServlet 这样的 Servlet 会配置在 web.xml 文件中，这个文件会放到应用的 WAR 包里面。当然，这是配置 DispatcherServlet 的方法之一。但是，借助于 Servlet 3 规范和 Spring 3.1 的功能增强，这种方式已经不是唯一的方案了。</p> <p>我们会使用 Java 将 DispatcherServlet 配置在 Servlet 容器中，而不会再使用 web.xml 文件。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 配置 DispatcherServlet</span>
<span class="token keyword">package</span> <span class="token namespace">spittr<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">AbstractAnnotationConfigDispatcherServletInitializer</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpittrWebAppInitializer</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractAnnotationConfigDispatcherServletInitializer</span> <span class="token punctuation">{</span>
	<span class="token comment">// 将 DispatcherServlet 映射到 &quot;/&quot;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getRootConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token class-name">RootConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 指定配置类</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token class-name">WebConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>扩展 AbstractAnnotationConfigDispatcherServletInitializer 的任意类都会自动地配置 DispatcherServlet 和 Spring 应用上下文，Spring 的应用上下文会位于应用程序的 Servlet 上下文之中。</p> <h4 id="两个应用上下文之间的故事"><a href="#两个应用上下文之间的故事" class="header-anchor">#</a> 两个应用上下文之间的故事</h4> <p>当 DispatcherServlet 启动的时候，它会创建 Spring 应用上下文，并加载配置文件或配置类中所声明的 bean。在上述程序清单的 <code>getServletConfigClasses()</code> 方法中，我们要求 DispatcherServlet 加载应用上下文时，使用定义在 WebConfig 配置类（使用 Java 配置）中的 bean。</p> <p>但是在 Spring Web 应用中，通常还会有另外一个应用上下文。另外的这个应用上下文是由 ContextLoaderListener 创建的。</p> <p>我们希望 DispatcherServlet 加载包含 Web 组件的 bean，如控制器、视图解析器以及处理器映射，而 ContextLoaderListener 要加载应用中的其他 bean。这些 bean 通常是驱动应用后端的中间层和数据层组件。</p> <p>实际上，AbstractAnnotationConfigDispatcherServletInitializer 会同时创建 DispatcherServlet 和 ContextLoaderListener。</p> <h4 id="启用-spring-mvc"><a href="#启用-spring-mvc" class="header-anchor">#</a> 启用 Spring MVC</h4> <p>我们所能创建的最简单的 Spring MVC 配置就是一个带有 <code>@EnableWebMvc</code> 注解的类：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">spittr<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ComponentScan</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ViewResolver</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">DefaultServletHandlerConfigurer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableWebMvc</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebMvcConfigurerAdapter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">InternalResourceViewResolver</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableWebMvc</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;spitter.web&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebMvcConfigurerAdapter</span> <span class="token punctuation">{</span>
    <span class="token comment">// 配置 JSP 视图解析器</span>
	<span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ViewResolver</span> <span class="token function">viewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token class-name">InternalResourceViewResolver</span> resolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InternalResourceViewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        resolver<span class="token punctuation">.</span><span class="token function">setPrefix</span><span class="token punctuation">(</span><span class="token string">&quot;/WEB-INF/views/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resolver<span class="token punctuation">.</span><span class="token function">setSuffix</span><span class="token punctuation">(</span><span class="token string">&quot;.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resolver<span class="token punctuation">.</span><span class="token function">setExposeContextBeansAsAttributes</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> resolver<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 配置静态资源的处理</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> configureDefaultServletHandling <span class="token punctuation">(</span><span class="token class-name">DefaultServletHandlerConfigurer</span> configurer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	configurer<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">spittr<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ComponentScan</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ComponentScan<span class="token punctuation">.</span>Filter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">FilterType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableWebMvc</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;spittr&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> excludeFilters<span class="token operator">=</span><span class="token punctuation">{</span><span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token class-name">FilterType</span><span class="token punctuation">.</span>ANNOTATION<span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token class-name">EnableWebMvc</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RootConfig</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-1-3-spittr-应用简介"><a href="#_5-1-3-spittr-应用简介" class="header-anchor">#</a> 5.1.3 Spittr 应用简介</h3> <h2 id="_5-2-编写基本的控制器"><a href="#_5-2-编写基本的控制器" class="header-anchor">#</a> 5.2 编写基本的控制器</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// HomeController：超级简单的控制器</span>
<span class="token keyword">package</span> <span class="token namespace">spittr<span class="token punctuation">.</span>web</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMethod</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HomeController</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token string">&quot;home&quot;</span><span class="token punctuation">;</span> <span class="token comment">//视图名为 home</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上例是一个构造型（stereotype）的注解，它基于 <code>@Component</code> 注解。在这里，它的目的就是辅助实现组件扫描。因为 HomeController 带有 <code>@Controller</code> 注解，因此组件扫描器会自动找到 HomeController，并将其声明为 Spring 应用上下文中的一个 bean。</p> <p>其实，也可以让 HomeController 带有 <code>@Component</code> 注解，它所实现的效果是一样的，但是在表意性上可能会差一些，无法确定 HomeController 是什么组件类型。</p> <p>HomeController 唯一的一个方法，也就是 <code>home()</code> 方法，带有 <code>@RequestMapping</code> 注解。它的 value 属性指定了这个方法所要处理的请求路径，method 属性细化了它所处理的 HTTP 方法。</p> <p>鉴于我们配置 InternalResourceViewResolver 的方式，视图名 &quot;home&quot;将会解析为 &quot;/WEB-INF/views/home.jsp&quot; 路径的 JSP。</p> <div class="language-plain extra-class"><pre class="language-plain"><code>&lt;!-- Spittr 应用的首页，定义为一个简单的 JSP --&gt;
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot; %&gt;
&lt;%@ page session=&quot;false&quot; %&gt;

&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Spittr&lt;/title&gt;
        &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&lt;c:url value=&quot;/resources/style.css&quot; /&gt;&quot; &gt;
    &lt;/head&gt;
  	&lt;body&gt;
        &lt;h1&gt;Welcome to Spittr&lt;/h1&gt;
        &lt;a href=&quot;&lt;c:url value=&quot;/spittles&quot; /&gt;&quot;&gt;Spittles&lt;/a&gt;
        |
        &lt;a href=&quot;&lt;c:url value=&quot;/spitter/register&quot; /&gt;&quot;&gt;Register&lt;/a&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1542472/1596464058960-cc0aebac-3941-4d98-8408-0b42f9e21c9d.png" alt="img"></p> <h3 id="_5-2-1-测试控制器"><a href="#_5-2-1-测试控制器" class="header-anchor">#</a> 5.2.1 测试控制器</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">spittr<span class="token punctuation">.</span>web</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>request<span class="token punctuation">.</span></span><span class="token class-name">MockMvcRequestBuilders</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>result<span class="token punctuation">.</span></span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>setup<span class="token punctuation">.</span></span><span class="token class-name">MockMvcBuilders</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">MockMvc</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">spittr<span class="token punctuation">.</span>web<span class="token punctuation">.</span></span><span class="token class-name">HomeController</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HomeControllerTest</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testHomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    	<span class="token class-name">HomeController</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HomeController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MockMvc</span> mockMvc <span class="token operator">=</span> <span class="token function">standaloneSetup</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//搭建 MockMvc</span>
        mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">view</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;home&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-2-2-定义类级别的请求处理"><a href="#_5-2-2-定义类级别的请求处理" class="header-anchor">#</a> 5.2.2 定义类级别的请求处理</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">spittr<span class="token punctuation">.</span>web</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMethod</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HomeController</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>method<span class="token operator">=</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token string">&quot;home&quot;</span><span class="token punctuation">;</span> <span class="token comment">//视图名为 home</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在这个新版本的 HomeController 中，路径现在被转移到类级别的 <code>@RequestMapping</code> 上，而 HTTP 方法依然映射在方法级别上。当控制器在类级别上添加 <code>@RequestMapping</code> 注解时，这个注解会应用到控制器的所有处理器方法上。处理器方法上的 <code>@RequestMapping</code> 注解会对类级别上的 <code>@RequestMapping</code> 的声明进行补充。</p> <h3 id="_5-2-3-传递模型数据到视图中"><a href="#_5-2-3-传递模型数据到视图中" class="header-anchor">#</a> 5.2.3 传递模型数据到视图中</h3> <p>在 Spittr 应用中，我们需要有一个页面展现最近提交的 Spittr 列表。因此，我们需要一个新的方法来处理这个页面。</p> <p>首先，需要定义一个数据访问的 Repository。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 定义一个数据访问的 Repository</span>
<span class="token keyword">package</span> <span class="token namespace">spittr<span class="token punctuation">.</span>data</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">spittr<span class="token punctuation">.</span></span><span class="token class-name">Spittle</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SpittleRepository</span> <span class="token punctuation">{</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spittle</span><span class="token punctuation">&gt;</span></span> <span class="token function">findSpittles</span><span class="token punctuation">(</span><span class="token keyword">long</span> max<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//max代表所返回的 Spittle 中，ID 属性的最大值 count 表明要返回多少个对象</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Spittle 类：包含消息内容、时间戳和位置信息</span>
<span class="token keyword">package</span> <span class="token namespace">spittr</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Spittle</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Date</span> time<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Double</span> latitude<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Double</span> longitude<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">Spittle</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">Date</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">this</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> time<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">Spittle</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">Date</span> time<span class="token punctuation">,</span> <span class="token class-name">Double</span> longitude<span class="token punctuation">,</span> <span class="token class-name">Double</span> latitude<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> time<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>longitude <span class="token operator">=</span> longitude<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>latitude <span class="token operator">=</span> latitude<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">Date</span> <span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> time<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">Double</span> <span class="token function">getLongitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> longitude<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">Double</span> <span class="token function">getLatitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> latitude<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> that<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token class-name">EqualsBuilder</span><span class="token punctuation">.</span><span class="token function">reflectionEquals</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> that<span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token class-name">HashCodeBuilder</span><span class="token punctuation">.</span><span class="token function">reflectionHashCode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 测试 SpittleController 处理针对 &quot;/spittles&quot; 的 GET 请求</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shouldShowRecentSpittles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spittle</span><span class="token punctuation">&gt;</span></span> expectedSpittles <span class="token operator">=</span> <span class="token function">createSpittleList</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SpittleRepository</span> mockRepository <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">SpittleRepository</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">when</span><span class="token punctuation">(</span>mockRepository<span class="token punctuation">.</span><span class="token function">findSpittles</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>expectedSpittles<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SpittleController</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpittleController</span><span class="token punctuation">(</span>mockRepository<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">MockMvc</span> mockMvc <span class="token operator">=</span> <span class="token function">standaloneSetup</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSingleView</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InternalResourceView</span><span class="token punctuation">(</span><span class="token string">&quot;/WEB-INF/views/spittles.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/spittles&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">view</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;spittles&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attributeExists</span><span class="token punctuation">(</span><span class="token string">&quot;spittleList&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attributeExists</span><span class="token punctuation">(</span><span class="token string">&quot;spittleList&quot;</span><span class="token punctuation">,</span> <span class="token function">hasItems</span><span class="token punctuation">(</span>expectedSpittles<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spittle</span><span class="token punctuation">&gt;</span></span> <span class="token function">createSpittleList</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spittle</span><span class="token punctuation">&gt;</span></span> spittles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spittle</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	spittles<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Spittle</span><span class="token punctuation">(</span><span class="token string">&quot;Spittle&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> spittles<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">SpittleController</span>：在模型中放入最新的 spittle 列表
<span class="token keyword">package</span> <span class="token namespace">spittr<span class="token punctuation">.</span>web</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMethod</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">spittr<span class="token punctuation">.</span></span><span class="token class-name">Spittle</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">spittr<span class="token punctuation">.</span>data<span class="token punctuation">.</span></span><span class="token class-name">SpittleRepository</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/spittles&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpittleController</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">SpittleRepository</span> spittleRepository<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">SpittleController</span><span class="token punctuation">(</span><span class="token class-name">SpittleRepository</span> spittleRepository<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>spittleRepository <span class="token operator">=</span> spittleRepository<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">spittles</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;spittleList&quot;</span><span class="token punctuation">,</span> spittleRepository<span class="token punctuation">.</span><span class="token function">findSpittles</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;spittles&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>需要注意的是，我们在 <code>spittles()</code> 方法中给定了一个 Model 作为参数。这样，<code>spittles()</code> 方法就能将 Repository中获取到的 Spittle 列表填充到模型中。Model 实际上就是一个 Map，它会传递给视图，这样数据就能渲染到客户端了。</p> <p>现在，数据已经放到模型中，在 JSP 中该如何访问它呢？实际上，当视图是 JSP 的时候，模型数据会作为请求属性放到请求（request）之中。因此，在 spittles.jsp 文件中可以使用 JSTL（JavaServer Pages Standard Tag Library）的 <code>&lt;c:forEach&gt;</code> 标签渲染 spittle 列表：</p> <div class="language-plain extra-class"><pre class="language-plain"><code>&lt;c:forEach item=&quot;${spittleList}&quot; var=&quot;spittle&quot;&gt;
    &lt;li id=&quot;spittle_&lt;c:out value=&quot;spittle.id&quot; /&gt;&quot;&gt;
        &lt;div class=&quot;spittleMessage&quot;&gt;
            &lt;c:out value=&quot;${spittle.message}&quot; /&gt;
        &lt;/div&gt;
        &lt;div&gt;
            &lt;span class=&quot;spittleTime&quot;&gt;&lt;c:out value=&quot;${spilttle.time}&quot; /&gt;&lt;/span&gt;
            &lt;span class=&quot;spittleLocation&quot;&gt;
                (&lt;c:out value=&quot;${spilttle.latitude}&quot; /&gt;,
                &lt;c:out value=&quot;${spilttle.longitude}&quot; /&gt;)
            &lt;/span&gt;
        &lt;/div&gt;
    &lt;/li&gt;
&lt;/c:forEach&gt;
</code></pre></div><h2 id="_5-3-接受请求的输入"><a href="#_5-3-接受请求的输入" class="header-anchor">#</a> 5.3 接受请求的输入</h2> <p>Spring MVC 允许以多种方式将客户端中的数据传送到控制器的处理器方法中，包括：</p> <ul><li><p>查询参数</p></li> <li><p>表单参数</p></li> <li><p>路径变量</p></li></ul> <h3 id="_5-3-1-处理查询参数"><a href="#_5-3-1-处理查询参数" class="header-anchor">#</a> 5.3.1 处理查询参数</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 用来测试分页 Spittle 列表的新方法</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shouldShowPagedSpittles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spittle</span><span class="token punctuation">&gt;</span></span> expectedSpittles <span class="token operator">=</span> <span class="token function">createSpittleList</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SpittleRepository</span> mockRepository <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">SpittleRepository</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">when</span><span class="token punctuation">(</span>mockRepository<span class="token punctuation">.</span><span class="token function">findSpittles</span><span class="token punctuation">(</span><span class="token number">238900</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>expectedSpittles<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SpittleController</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpittleController</span><span class="token punctuation">(</span>mockRepository<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">MockMvc</span> mockMvc <span class="token operator">=</span> <span class="token function">standaloneSetup</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSingleView</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InternalResourceView</span><span class="token punctuation">(</span><span class="token string">&quot;/WEB-INF/views/spittles.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/spittles?max=238900&amp;count=50&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">view</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;spittles&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attributeExists</span><span class="token punctuation">(</span><span class="token string">&quot;spittleList&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attributeExists</span><span class="token punctuation">(</span><span class="token string">&quot;spittleList&quot;</span><span class="token punctuation">,</span> <span class="token function">hasItems</span><span class="token punctuation">(</span>expectedSpittles<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spittle</span><span class="token punctuation">&gt;</span></span> <span class="token function">createSpittleList</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spittle</span><span class="token punctuation">&gt;</span></span> spittles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spittle</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	spittles<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Spittle</span><span class="token punctuation">(</span><span class="token string">&quot;Spittle&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> spittles<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spittle</span><span class="token punctuation">&gt;</span></span> <span class="token function">spittles</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;max&quot;</span><span class="token punctuation">,</span> defaultValue<span class="token operator">=</span><span class="token class-name">Long</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">)</span> <span class="token keyword">long</span> max<span class="token punctuation">,</span>
                              <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span> defaultValue<span class="token operator">=</span><span class="token string">&quot;20&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> spittleRepository<span class="token punctuation">.</span><span class="token function">findSpittles</span><span class="token punctuation">(</span>max<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-3-2-通过路径参数接受输入"><a href="#_5-3-2-通过路径参数接受输入" class="header-anchor">#</a> 5.3.2 通过路径参数接受输入</h3> <p>假设我们的应用程序需要根据给定的 ID 来展示某一个 Spittle 记录。其中一种方案就是编写处理器方法，通过使用 <code>@RequestParam</code> 注解让它接受 ID 作为查询参数：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;/show&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">showSpittle</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;spittle_id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">long</span> spittleId<span class="token punctuation">,</span> <span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span>spittleRepository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>spittleId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token string">&quot;spittle&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个处理器方法将会处理形如 &quot;/spittles/show?spittle_id=12345&quot; 这样的请求。尽管这也可以正常工作，但是从面向资源的角度来看这并不理想。在理想情况下，要识别的资源应该通过 URL 路径进行标示，而不是通过查询参数。对 &quot;/spittles/12345&quot; 发起 GET 请求要优于对 &quot;/spittles/show?spittle_id=12345&quot; 发起请求。</p> <p>但目前为止，我们编写的控制器中，所有的方法都映射到了静态定义好的路径上。但是，想要通过路径参数接受输入，我们编写的 <code>@RequestMapping</code> 要包含变量部分，这部分代表了 Spittle ID。为了实现这种路径变量，Spring MVC 允许我们在 <code>@RequestMapping</code> 中添加占位符。占位符的名称要用大括号括起来。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;/{spittleId}&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">spittle</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;spittleId&quot;</span><span class="token punctuation">)</span> <span class="token keyword">long</span> spittleId<span class="token punctuation">,</span> <span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span>spittleRepository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>spittleId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token string">&quot;spittle&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样 Spittle 对象中的数据就可以渲染到视图中了，此时需要引用请求中的 key 为 spittle 的属性（与模型的 key 一致）。</p> <div class="language-plain extra-class"><pre class="language-plain"><code>&lt;div class=&quot;spittleView&quot;&gt;
    &lt;div class=&quot;spittleMessage&quot;&gt;
        &lt;c:out value=&quot;${spittle.message}&quot; /&gt;
    &lt;/div&gt;
    &lt;div&gt;
        &lt;span class=&quot;spittleTime&quot;&gt;
            &lt;c:out value=&quot;${spittle.time}&quot; /&gt;
        &lt;/span&gt;
    &lt;/div&gt;
&lt;/div&gt;
</code></pre></div><p>如果传递请求中少量的数据，那查询参数和路径变量是很合适的。但通常我们还需要传递很多的数据（也许是表单提交的数据），那查询参数显得有些笨拙和受限了。</p> <h2 id="_5-4-处理表单"><a href="#_5-4-处理表单" class="header-anchor">#</a> 5.4 处理表单</h2> <p>使用表单分为两个方面：展现表单以及处理用户通过表单提交的数据。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// SpittleController：展现一个表单，允许用户注册该应用</span>
<span class="token keyword">package</span> <span class="token namespace">spittr<span class="token punctuation">.</span>web</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>ui<span class="token punctuation">.</span></span><span class="token class-name">Model</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMethod</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">spittr<span class="token punctuation">.</span></span><span class="token class-name">Spittle</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">spittr<span class="token punctuation">.</span>data<span class="token punctuation">.</span></span><span class="token class-name">SpittleRepository</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/spitter&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpitterController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>vlaue<span class="token operator">=</span><span class="token string">&quot;/register&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">showRegistrationForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;registerForm&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 渲染注册表单的 JSP <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>@ taglib uri<span class="token operator">=</span><span class="token string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> prefix<span class="token operator">=</span><span class="token string">&quot;c&quot;</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>@ page session<span class="token operator">=</span><span class="token string">&quot;false&quot;</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>html<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>head<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>title<span class="token punctuation">&gt;</span></span><span class="token class-name">Spittr</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">&quot;stylesheet&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;text/css&quot;</span> href<span class="token operator">=</span><span class="token string">&quot;&lt;c:url value=&quot;</span>resources<span class="token operator">/</span>style<span class="token punctuation">.</span>css<span class="token string">&quot; /&gt;&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>body<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>h1<span class="token punctuation">&gt;</span></span><span class="token class-name">Register</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>form method<span class="token operator">=</span><span class="token string">&quot;POST&quot;</span><span class="token operator">&gt;</span>
            <span class="token class-name">First</span> <span class="token class-name">Name</span><span class="token operator">:</span> <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;firstName&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token class-name">Last</span> <span class="token class-name">Name</span><span class="token operator">:</span> <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;lastName&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token class-name">Username</span><span class="token operator">:</span> <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token class-name">Password</span><span class="token operator">:</span> <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;password&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;password&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;submit&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;Register&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre></div><p>需要注意的是：这里的 </p><form> 标签中并没有设置 action 属性。在这种情况下，当表单提交时，它会提交到与展现时相同的 URL 路径上。也就是说，它会提交到 &quot;/spitter/register&quot; 上。<p></p> <h3 id="_5-4-1-编写处理表单的控制器"><a href="#_5-4-1-编写处理表单的控制器" class="header-anchor">#</a> 5.4.1 编写处理表单的控制器</h3> <p>在处理 POST 类型的请求时，在请求处理完成后，最好进行一下重定向，这样浏览器的刷新就不会重复提交表单了。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 处理所提交的表单并注册新用户</span>
<span class="token keyword">package</span> <span class="token namespace">spittr<span class="token punctuation">.</span>web</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>ui<span class="token punctuation">.</span></span><span class="token class-name">Model</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMethod</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">spittr<span class="token punctuation">.</span></span><span class="token class-name">Spittle</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">spittr<span class="token punctuation">.</span>data<span class="token punctuation">.</span></span><span class="token class-name">SpittleRepository</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/spitter&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpitterController</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">SpitterRepository</span> spitterRepository<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">SpitterController</span><span class="token punctuation">(</span><span class="token class-name">SpitterRepository</span> spitterRepository<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>spitterRepository <span class="token operator">=</span> spitterRepository<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>vlaue<span class="token operator">=</span><span class="token string">&quot;/register&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">showRegistrationForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;registerForm&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>vlaue<span class="token operator">=</span><span class="token string">&quot;/register&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span>POST<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">processRegistration</span><span class="token punctuation">(</span><span class="token class-name">Spitter</span> spitter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        spitterRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>spitter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> <span class="token string">&quot;redirect:/spitter&quot;</span> <span class="token operator">+</span> spitter<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当 InternalResourceViewResolver 看到视图格式中的 &quot;redirect:&quot; 前缀时，它就知道要将其解析为重定向的规则，而不是视图的名称。需要注意的是，除了 &quot;redirect:&quot;，InternalResourceViewResolver 还能识别 &quot;forward:&quot; 前缀。当它发现视图格式中以 &quot;forward:&quot; 作为前缀时，请求将会前往指定的 URL 路径，而不再是重定向。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;/{username}&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span>GET<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">showSpitterProfile</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">Spitter</span> spitter <span class="token operator">=</span> spitterRepository<span class="token punctuation">.</span><span class="token function">findByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span>spitter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token string">&quot;profile&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-4-2-校验表单"><a href="#_5-4-2-校验表单" class="header-anchor">#</a> 5.4.2 校验表单</h3> <p>从 Spring 3.0 开始，在 Spring MVC 中提供了对 Java 校验 API 的支持。在 Spring MVC 中要使用 Java 校验 API 的话，并不需要什么额外的配置，只要保证在类路径下包含这个 Java API 的实现即可。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Spitter：包含了要提交到 Spittle POST 请求中的域</span>
<span class="token keyword">package</span> <span class="token namespace">spittr</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>validation<span class="token punctuation">.</span>constraints<span class="token punctuation">.</span></span><span class="token class-name">NotNull</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>validation<span class="token punctuation">.</span>constraints<span class="token punctuation">.</span></span><span class="token class-name">Size</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span>builder<span class="token punctuation">.</span></span><span class="token class-name">EqualsBuilder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span>builder<span class="token punctuation">.</span></span><span class="token class-name">HashCodeBuilder</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Spitter</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@NotNull</span>
    <span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> max<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@NotNull</span>
    <span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> max<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@NotNull</span>
    <span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> max<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> firstName<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@NotNull</span>
    <span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> max<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> lastName<span class="token punctuation">;</span>
    
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// processRegistration()：确保所提交的数据是合法的</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>vlaue<span class="token operator">=</span><span class="token string">&quot;/register&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span>POST<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">processRegistration</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> <span class="token class-name">Spitter</span> spitter<span class="token punctuation">,</span> <span class="token class-name">Errors</span> errors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	<span class="token keyword">return</span> <span class="token string">&quot;registerForm&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        spitterRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>spitter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> <span class="token string">&quot;redirect:/spitter&quot;</span> <span class="token operator">+</span> spitter<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h1 id="_6-渲染-web-视图"><a href="#_6-渲染-web-视图" class="header-anchor">#</a> 6 渲染 Web 视图</h1> <hr> <h2 id="_6-1-理解视图解析"><a href="#_6-1-理解视图解析" class="header-anchor">#</a> 6.1 理解视图解析</h2> <p>将控制器中请求处理的逻辑和视图中的渲染实现解耦是 Spring MVC 的一个重要特性。如果控制器中的方法直接负责产生 HTML 的话，就很难在不影响请求处理逻辑的前提下，维护和更新视图。控制器方法和视图的实现会在模型内容上达成一致，这是两者的最大关联，除此之外，两者应该保持足够的距离。</p> <p>但是，如果控制器只通过逻辑视图名来了解视图的话，那 Spring 该如何确定使用哪一个视图实现来渲染模型呢？这就是 Spring 视图解析器的任务了。</p> <p>在第 5 章中，我们使用名为 InternalResourceViewResolver 的视图解析器。在它的配置中，为了得到视图的名字，会使用 &quot;/WEB-INF/views/&quot; 前缀和 &quot;.jsp&quot; 后缀，从而确定来渲染模型的 JSP 文件的物理位置。</p> <p>Spring MVC 定义了一个名为 ViewResolver 接口，它大致如下所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ViewResolver</span> <span class="token punctuation">{</span>
	<span class="token class-name">View</span> <span class="token function">resolveViewName</span><span class="token punctuation">(</span><span class="token class-name">String</span> viewName<span class="token punctuation">,</span> <span class="token class-name">Locale</span> locale<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当给 <code>resolveViewName()</code> 方法传入一个视图名和 Locale 对象时，它会返回一个 View 实例。View 是另外一个接口，如下所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
	<span class="token class-name">String</span> <span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">void</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> model<span class="token punctuation">,</span>
                <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>
                <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>View 接口的任务就是接受模型以及 Servlet 的 request 和 response 对象，并将输出结果渲染到 response 中。</p> <h2 id="_6-2-创建-jsp-视图"><a href="#_6-2-创建-jsp-视图" class="header-anchor">#</a> 6.2 创建 JSP 视图</h2> <p>Spring 提供了两种支持 JSP 视图的方式：</p> <ul><li>InternalresourceViewResolver 会将视图名解析为 JSP 文件。另外，如果使用了 JSP 标准标签库 JSTL 的话，InternalresourceViewResolver 能够将视图名解析为 JstlView 形式的 JSP 文件，从而将 JSTL 本地化和资源 bundle 变量暴露给 JSTL 的格式化和信息标签。</li> <li>Spring 提供了两个 JSP 标签库，一个用于表单到模型的绑定，另一个提供了通用的工具类特性。</li></ul> <h3 id="_6-2-1-配置适用于-jsp-的视图解析器"><a href="#_6-2-1-配置适用于-jsp-的视图解析器" class="header-anchor">#</a> 6.2.1 配置适用于 JSP 的视图解析器</h3> <p>有一些视图解析器，如 ResourceBundleViewResolver 会直接将逻辑视图名映射为特定的 View 接口实现，而 InternalresourceViewResolver 所采用的方式并不那么直接。它遵循一种约定，会在视图名上添加前缀和后缀，进而确定一个 Web 应用中视图资源的物理路径。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ViewResolver</span> <span class="token function">viewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">InternalResourceViewResolver</span> resolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InternalResourceViewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    resolver<span class="token punctuation">.</span><span class="token function">setPrefix</span><span class="token punctuation">(</span><span class="token string">&quot;/WEB-INF/views&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resolver<span class="token punctuation">.</span><span class="token function">setSuffix</span><span class="token punctuation">(</span><span class="token string">&quot;.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> resolver<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewResolver<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.web.servlet.view.InternalResourceViewResolver<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name"><span class="token namespace">p:</span>prefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/WEB-INF/views/<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name"><span class="token namespace">p:</span>suffix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.jsp<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>上述视图解析器最终会将逻辑视图名解析为 InternalResourceView 实例，这个实例会引用 JSP 文件。</p> <h4 id="解析-jstl-视图"><a href="#解析-jstl-视图" class="header-anchor">#</a> 解析 JSTL 视图</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ViewResolver</span> <span class="token function">viewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">InternalResourceViewResolver</span> resolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InternalResourceViewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    resolver<span class="token punctuation">.</span><span class="token function">setPrefix</span><span class="token punctuation">(</span><span class="token string">&quot;/WEB-INF/views&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resolver<span class="token punctuation">.</span><span class="token function">setSuffix</span><span class="token punctuation">(</span><span class="token string">&quot;.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resolver<span class="token punctuation">.</span><span class="token function">setViewClass</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span>JstlView</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> resolver<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewResolver<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.web.servlet.view.InternalResourceViewResolver<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name"><span class="token namespace">p:</span>prefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/WEB-INF/views/<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name"><span class="token namespace">p:</span>suffix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.jsp<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name"><span class="token namespace">p:</span>viewClass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.web.servlet.view.JstlView<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><h3 id="_6-2-2-使用-spring-的-jsp-库"><a href="#_6-2-2-使用-spring-的-jsp-库" class="header-anchor">#</a> 6.2.2 使用 Spring 的 JSP 库</h3> <p>当为 JSP 添加功能时，标签库是一种很强大的方式，能够避免在脚本块中直接编写 Java 代码。Spring 提供了两个 JSP 标签库，用来帮助定义 Spring MVC Web 的视图。</p> <h4 id="将表单绑定到模型上"><a href="#将表单绑定到模型上" class="header-anchor">#</a> 将表单绑定到模型上</h4> <p>为了使用表单绑定库，需要在 JSP 页面中对其进行声明：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;%@ taglib uri=&quot;http://www.springframework.org/tags/form&quot; prefix=&quot;sf&quot;%&gt;
</code></pre></div><div class="language-plain extra-class"><pre class="language-plain"><code>&lt;sf:form method=&quot;POST&quot; commandName=&quot;spitter&quot;&gt;
    First Name: &lt;sf:input path=&quot;firstName&quot; /&gt;&lt;br /&gt;
    Last Name: &lt;sf:input path=&quot;lastName&quot; /&gt;&lt;br /&gt;
    Email: &lt;sf:input path=&quot;email&quot; /&gt;&lt;br /&gt;
    Username: &lt;sf:input path=&quot;username&quot; /&gt;&lt;br /&gt;
    Password: &lt;sf:password path=&quot;password&quot; /&gt;&lt;br /&gt;
    &lt;inpur type=&quot;submit&quot; value=&quot;Register&quot; /&gt;
&lt;/sf:form&gt;
</code></pre></div><p>我们将 commandName 属性设置为 spitter。因此，在模型中必须要有一个 key 为 spitter 的对象，否则的话，表单不能正常渲染。</p> <h4 id="展现错误"><a href="#展现错误" class="header-anchor">#</a> 展现错误</h4> <div class="language-plain extra-class"><pre class="language-plain"><code>&lt;sf:form method=&quot;POST&quot; commandName=&quot;spitter&quot;&gt;
    First Name: &lt;sf:input path=&quot;firstName&quot; /&gt;
    &lt;sf:errors path=&quot;firstName&quot; /&gt;&lt;br /&gt;
    ...
&lt;/sf:form&gt;
</code></pre></div><div class="language-plain extra-class"><pre class="language-plain"><code>&lt;sf:form method=&quot;POST&quot; commandName=&quot;spitter&quot;&gt;
    &lt;sf:errors path=&quot;*&quot; element=&quot;div&quot; /&gt;&lt;br /&gt;
    ...
&lt;/sf:form&gt;
</code></pre></div><h4 id="spring-通用的标签库"><a href="#spring-通用的标签库" class="header-anchor">#</a> Spring 通用的标签库</h4> <p>要使用 Spring 通用的标签库，我们必须要在页面上对其进行声明：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;%@ taglib uri=&quot;http://www.springframework.org/tags&quot; prefix=&quot;s&quot; %&gt;
</code></pre></div><h4 id="展现国际化信息"><a href="#展现国际化信息" class="header-anchor">#</a> 展现国际化信息</h4> <h4 id="创建-url"><a href="#创建-url" class="header-anchor">#</a> 创建 URL</h4> <h4 id="转义内容"><a href="#转义内容" class="header-anchor">#</a> 转义内容</h4> <h2 id="_6-3-使用-apache-tiles-视图定义布局"><a href="#_6-3-使用-apache-tiles-视图定义布局" class="header-anchor">#</a> 6.3 使用 Apache Tiles 视图定义布局</h2> <h2 id="_6-4-使用-thymeleaf"><a href="#_6-4-使用-thymeleaf" class="header-anchor">#</a> 6.4 使用 Thymeleaf</h2></form></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/./coding-base/开发框架/spring系列/《Spring Boot 实战》.html" class="prev">
        《Spring Boot 实战》
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="./assets/js/app.dbe5dc78.js" defer></script><script src="./assets/js/2.fa5f1a4a.js" defer></script><script src="./assets/js/68.6a9fb92c.js" defer></script>
  </body>
</html>
