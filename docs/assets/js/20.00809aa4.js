(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{415:function(s,t,a){"use strict";a.r(t);var r=a(30),e=Object(r.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"hive-高频考点讲解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hive-高频考点讲解"}},[s._v("#")]),s._v(" Hive 高频考点讲解")]),s._v(" "),a("h1",{attrs:{id:"_1-hive"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-hive"}},[s._v("#")]),s._v(" 1 Hive")]),s._v(" "),a("p",[s._v("Hive 是 FaceBook 开源的一款基于 Hadoop 数据仓库工具，它可以将结构化的数据文件映射为一张表，并提供类SQL查询功能。")]),s._v(" "),a("blockquote",[a("p",[s._v("The Apache Hive ™ data warehouse software facilitates reading, writing, and managing large datasets residing in distributed storage using SQL 。")])]),s._v(" "),a("h3",{attrs:{id:"_1-1-hive-优缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-hive-优缺点"}},[s._v("#")]),s._v(" 1.1 Hive 优缺点")]),s._v(" "),a("h5",{attrs:{id:"_1-1-1-优点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-优点"}},[s._v("#")]),s._v(" 1.1.1 优点")]),s._v(" "),a("ol",[a("li",[s._v("操作接口采用类SQL语法，提供快速开发的能力（简单、容易上手）。")]),s._v(" "),a("li",[s._v("避免了去写MapReduce，减少开发人员的学习成本。")]),s._v(" "),a("li",[s._v("Hive的执行延迟比较高，因此Hive常用于数据分析，对实时性要求不高的场合。")]),s._v(" "),a("li",[s._v("Hive优势在于处理大数据，对于处理小数据没有优势，因为Hive的执行延迟比较高。")]),s._v(" "),a("li",[s._v("Hive支持用户自定义函数，用户可以根据自己的需求来实现自己的函数。")])]),s._v(" "),a("h5",{attrs:{id:"_1-1-2-缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-2-缺点"}},[s._v("#")]),s._v(" 1.1.2 缺点")]),s._v(" "),a("ol",[a("li",[s._v("Hive 的 HQL 表达能力有限，无法表达迭代式算法，不擅长数据挖掘方面。")]),s._v(" "),a("li",[s._v("Hive 的效率比较低，Hive 自动生成的 MapReduce 作业，通常情况下不够智能化。")]),s._v(" "),a("li",[s._v("Hive 查询无法做到跟 MySQL 一样毫秒返回。")])]),s._v(" "),a("h3",{attrs:{id:"_1-2-hive-跟-mysql-比较"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-hive-跟-mysql-比较"}},[s._v("#")]),s._v(" 1.2 Hive 跟 MySQL 比较")]),s._v(" "),a("h5",{attrs:{id:"_1-2-1-对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-对比"}},[s._v("#")]),s._v(" 1.2.1 对比")]),s._v(" "),a("p",[s._v("Hive 采用了类SQL 的查询语言 HQL(Hive Query Language)，因此很容易将 Hive 理解为数据库。其实从结构上来看，Hive 和数据库除了拥有类似的查询语言，再无类似之处。本文将从多个方面来阐述 Hive 和数据库的差异。数据库可以用在 Online 的应用中，但是Hive 是为数据仓库而设计的，清楚这一点，有助于从应用角度理解 Hive 的特性。")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[s._v("方向")]),s._v(" "),a("th",{staticStyle:{"text-align":"left"}},[s._v("Hive")]),s._v(" "),a("th",{staticStyle:{"text-align":"left"}},[s._v("MySQL")])])]),s._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("应用方向")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("数仓")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("Online")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("查询语言")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("HQL")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("SQL")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("数据存储位置")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("HDFS")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("本地文件系统")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("数据更新")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("读多写少，无法修改")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("正常CRUD")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("索引")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("无索引，暴力查询")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("各种索引")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("执行")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("底层MapReduce")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("自己执行引擎")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("延迟")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("高延迟")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("低延迟")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("可扩展性")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("优秀扩展能力")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("扩展力有限")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("数据量")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("超大规模")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("小规模")])])])]),s._v(" "),a("h3",{attrs:{id:"_1-2-2-hive-不支持那些"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-hive-不支持那些"}},[s._v("#")]),s._v(" 1.2.2 Hive 不支持那些")]),s._v(" "),a("ol",[a("li",[s._v("支持等值查询，不支持非等值连接")]),s._v(" "),a("li",[s._v("支持 and 多条件过滤，不支持 or 多条件过滤。")]),s._v(" "),a("li",[s._v("不支持 update 跟 delete。")])]),s._v(" "),a("h3",{attrs:{id:"_1-3-hive-底层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-hive-底层"}},[s._v("#")]),s._v(" 1.3 Hive 底层")]),s._v(" "),a("p",[s._v("Hive 底层是 MapReduce 计算框架，Hive 只是将通读性强且容易编程的SQL语句通过 Hive 软件转换成MapReduce 程序在集群上执行，Hive 可以看做 MapReduce 客户端。操作的数据还是存储在HDFS上的，而用户定义的表结构等元信息被存储到 MySQL 上了。以前要写八股文 MapReduce 程序，现在只需要HQL查询就可！")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUIzkNGFzMg64FLrfTWrHgMAuzhuty98Jl1iaGDM68NrrlgqmAj5W6IicReoD8OEt14GSAaYU0ADEwg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}}),s._v("Hive整体框架")]),s._v(" "),a("ol",[a("li",[s._v("用户接口 Client")])]),s._v(" "),a("blockquote",[a("p",[s._v("CLI（hive shell）、JDBC/ODBC(java访问hive)、WEBUI（浏览器访问hive）")]),s._v(" "),a("ol",[a("li",[s._v("元数据 Metastore")]),s._v(" "),a("li",[s._v("元数据包括 表名、表所属的数据库（默认是default）、表的拥有者、列/分区字段、表的类型（是否是外部表）、表的数据所在目录等。")]),s._v(" "),a("li",[s._v("默认存储在自带的derby数据库中(单客户连接)，推荐使用MySQL存储Metastore。")]),s._v(" "),a("li",[s._v("Hadoop\n使用HDFS进行存储，使用MapReduce进行计算。")])])]),s._v(" "),a("ol",[a("li",[s._v("驱动器 Driver")])]),s._v(" "),a("blockquote",[a("ol",[a("li",[s._v("解析器 SQL Parser：将SQL字符串转换成"),a("strong",[s._v("抽象语法树")]),s._v("AST，这一步一般都用第三方工具库完成，比如antlr；对AST进行语法分析，比如表是否存在、字段是否存在、SQL语义是否有误。")]),s._v(" "),a("li",[s._v("编译器 Physical Plan：将AST编译生成逻辑执行计划。")]),s._v(" "),a("li",[s._v("优化器 Query Optimizer：对逻辑执行计划进行优化。")]),s._v(" "),a("li",[s._v("执行器 Execution：把逻辑执行计划转换成可以运行的物理计划。对于Hive来说就是MR/Spark。")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUIzkNGFzMg64FLrfTWrHgMgq06r2r76sFd4HPqgCPFNXQUicibibjMLibh94Xk8mozMMqRlic5gqPnDbg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}}),s._v("HQL执行流程")]),s._v(" "),a("p",[s._v("不要把 Hive 想的多么神秘，你可以用简单的load方式将数据加载到创建的表里，也可以直接用hadoop指令将数据放入到指定目录，这两种方式都可以直接让你通过SQL查询到数据。")]),s._v(" "),a("h3",{attrs:{id:"_1-4-hql-底层执行举例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-hql-底层执行举例"}},[s._v("#")]),s._v(" 1.4  HQL 底层执行举例")]),s._v(" "),a("h5",{attrs:{id:"_1-4-1-join"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-1-join"}},[s._v("#")]),s._v(" 1.4.1 Join")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUIzkNGFzMg64FLrfTWrHgMIiaXqLHNnabYYaXsBcGlZDjGnWYrbJL81NI8QSK48ia8AkBSbZ8NEhKw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}}),s._v("Join流程")]),s._v(" "),a("h5",{attrs:{id:"_1-4-2-group-by"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-2-group-by"}},[s._v("#")]),s._v(" 1.4.2 group by")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUIzkNGFzMg64FLrfTWrHgMNjF1AEjV3QcLWsjAfzWpU9cjQyIOM8cVZL4lEftr4Ggyz9vCic3zhTg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}}),s._v("group by 流程")]),s._v(" "),a("h5",{attrs:{id:"_1-4-3-distinct"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-3-distinct"}},[s._v("#")]),s._v(" 1.4.3 distinct")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUIzkNGFzMg64FLrfTWrHgMZEbMqvODNs1CUb5cr690xFjH4wWA2U9MuzD4OMXElSU1MVyDru5HoQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}}),s._v("distinct 流程")]),s._v(" "),a("h1",{attrs:{id:"_2-开窗函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-开窗函数"}},[s._v("#")]),s._v(" 2 开窗函数")]),s._v(" "),a("p",[s._v("有时想要同时显示聚集前后的数据，这时引入了窗口函数，在SQL处理中，窗口函数都是"),a("code",[s._v("最后一步执行")]),s._v("，而且仅位于 Order by 字句之前。")]),s._v(" "),a("h3",{attrs:{id:"_2-1-数据准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-数据准备"}},[s._v("#")]),s._v(" 2.1  数据准备")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("cost\njack"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\ntony"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\njack"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("03")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("\ntony"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v("\njack"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("\njack"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("\ntony"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\njack"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v("\nmart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v("\nmart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("09")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("68")]),s._v("\nneil"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("\nmart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("75")]),s._v("\nneil"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\nmart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v("\n")])])]),a("p",[s._v("建表 导数据")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" business"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\nname string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \norderdate string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\ncost "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ROW")]),s._v(" FORMAT DELIMITED "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FIELDS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TERMINATED")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("load")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("local")]),s._v(" inpath "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/module/datas/business.txt"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" business"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"_2-2-用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-用法"}},[s._v("#")]),s._v(" 2.2 用法")]),s._v(" "),a("p",[s._v("相关函数说明")]),s._v(" "),a("ol",[a("li",[s._v("OVER()：指定分析函数工作的数据窗口大小，这个数据窗口大小可能会随着行的变而变化")]),s._v(" "),a("li",[s._v("CURRENT ROW：当前行")]),s._v(" "),a("li",[s._v("n PRECEDING：往前 n 行数据")]),s._v(" "),a("li",[s._v("n FOLLOWING：往后 n 行数据")]),s._v(" "),a("li",[s._v("UNBOUNDED：起点，UNBOUNDED PRECEDING 表示从前面的起点， UNBOUNDED FOLLOWING 表示到后面的终点")])]),s._v(" "),a("p",[s._v("上面写 over 里面，下面写 over 前面。")]),s._v(" "),a("ol",[a("li",[s._v("LAG(col,n)：往前"),a("code",[s._v("第")]),s._v(" n 行数据")]),s._v(" "),a("li",[s._v("LEAD(col,n)：往后"),a("code",[s._v("第")]),s._v(" n 行数据")]),s._v(" "),a("li",[s._v("NTILE(n)：把有序分区中的行分发到指定数据的组中，各个组有编号，编号从1开始，对于每一行，NTILE 返回此行所属的组的编号。注意：n必须为int类型。")])]),s._v(" "),a("h3",{attrs:{id:"_2-3-开窗函数demo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-开窗函数demo"}},[s._v("#")]),s._v(" 2.3 开窗函数demo")]),s._v(" "),a("ol",[a("li",[s._v("查询在2017年4月份购买过的顾客及总人数")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" business "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" substring"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2017-04'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("group")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n结果：\nmart    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])])]),a("ol",[a("li",[s._v("查询顾客的购买明细及月购买总额")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("partition")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("month")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" business"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n解释：按照月划分数据  然后统计这个月的cost总和\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("205")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("205")]),s._v("\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("205")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("205")]),s._v("\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("205")]),s._v("\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("205")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("03")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("\nmart    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("341")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("341")]),s._v("\nmart    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("75")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("341")]),s._v("\nmart    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("09")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("68")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("341")]),s._v("\nmart    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("341")]),s._v("\nneil    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("\nneil    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])])]),a("ol",[a("li",[s._v("查看顾客上次的购买时间")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \nlag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'defaulttime'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("partition")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" orderdate "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" time1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \nlag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'defaulttime'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("over")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("partition")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" time2  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" business"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n结果 : \n姓名      日期      价格  前一天日期    前两天日期\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  defaulttime defaulttime\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v("  defaulttime\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("03")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("03")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),s._v("\nmart    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v("  defaulttime defaulttime\nmart    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("09")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("68")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),s._v("  defaulttime\nmart    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("75")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("09")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),s._v("\nmart    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("09")]),s._v("\nneil    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("  defaulttime defaulttime\nneil    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  defaulttime\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("  defaulttime defaulttime\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),s._v("  defaulttime\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),s._v("\n")])])]),a("ol",[a("li",[s._v("查询前20%时间的订单信息")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ntile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" sorted "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" business "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" t "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" sorted "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n结果 : \njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("03")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nmart    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nmart    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("09")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("68")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\nmart    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("75")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\nmart    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\nneil    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\nneil    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])])]),a("p",[a("strong",[s._v("以下实验均关注最后一列")])]),s._v(" "),a("ol",[a("li",[s._v("所有行相加")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" sample1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" business"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n结果 : \nmart    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("661")]),s._v("\nneil    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("661")]),s._v("\nmart    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("75")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("661")]),s._v("\nneil    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("661")]),s._v("\nmart    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("09")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("68")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("661")]),s._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("按name分组，组内数据相加")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("partition")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" sample2\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" business"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n结果 : \njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("176")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("176")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("176")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("176")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("03")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("176")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v("\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v("\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v("\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("按name分组，组内数据累加")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("partition")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" sample3\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" business"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n跟下面类似\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("distribute "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" name sort "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" sample3 \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" business"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("03")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("134")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("176")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("和sample3一样,由起点到当前行的聚合")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("partition")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" orderdate "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("between")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNBOUNDED")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRECEDING")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("current")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" sample4 \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" business"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n结果 : \njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("03")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("134")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("176")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])])]),a("ol",{attrs:{start:"5"}},[a("li",[s._v("当前行和前面一行做聚合")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("partition")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" orderdate "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("between")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRECEDING")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("current")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" sample5 \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" business"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n结果 : \njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("03")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("78")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v("\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("79")]),s._v("\n")])])]),a("ol",{attrs:{start:"6"}},[a("li",[s._v("当前行和前边一行及后面一行")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("partition")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" orderdate "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("between")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRECEDING")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOLLOWING")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" sample6\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" business"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n结果 : \njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("124")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("03")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("120")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v("\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v("\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("79")]),s._v("\n")])])]),a("ol",{attrs:{start:"7"}},[a("li",[s._v("当前行及后面所有行")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("partition")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" orderdate "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("between")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("current")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNBOUNDED")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOLLOWING")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" sample7 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" business"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n结果 : \njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("176")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("166")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("120")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("03")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("\njack    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("\nmart    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("299")]),s._v("\nmart    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("09")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("68")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("237")]),s._v("\nmart    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("75")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("169")]),s._v("\nmart    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v("\nneil    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("92")]),s._v("\nneil    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v("\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("79")]),s._v("\ntony    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n")])])]),a("h3",{attrs:{id:"_2-4-rank"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-rank"}},[s._v("#")]),s._v(" 2.4 Rank")]),s._v(" "),a("p",[s._v("函数说明")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("rank()")]),s._v("：排序相同时会重复，总数不会变\n"),a("strong",[s._v("dense_rank()")]),s._v("：排序相同时会重复，总数会减少\n"),a("strong",[s._v("row_number()")]),s._v("：会根据顺序计算")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("subject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("score"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nrank"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("partition")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" subject "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" score "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" rp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\ndense_rank"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("partition")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" subject "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" score "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" drp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nrow_number"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("partition")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" subject "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" score "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" rmp\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" score"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n结果 : \nname   subject score    rp      drp     rmp\n孙悟空   数学    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("95")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n宋宋    数学    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("86")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n婷婷    数学    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n大海    数学    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n宋宋    英语    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n大海    英语    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n婷婷    英语    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("78")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("（跳过"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("）"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n孙悟空  英语    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("68")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("总数少"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n大海    语文    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n孙悟空  语文    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("87")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n婷婷    语文    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n宋宋    语文    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n")])])]),a("h4",{attrs:{id:"_2-5-行转列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-行转列"}},[s._v("#")]),s._v(" 2.5 行转列")]),s._v(" "),a("ol",[a("li",[s._v("CONCAT(string A, string B)：")])]),s._v(" "),a("blockquote",[a("p",[s._v("返回输入字符串"),a("code",[s._v("连接后")]),s._v("的结果，支持任意个输入字符串;")]),s._v(" "),a("ol",[a("li",[s._v("CONCAT_WS(separator, str1, str2,…)：\n特殊形式的 CONCAT()。第一个参数剩余参数间的分隔符。分隔符可以是与剩余参数一样的字符串。如果分隔符是 NULL，返回值也将为 NULL。")]),s._v(" "),a("li",[s._v("COLLECT_SET(col)：\n只接受基本数据类型，主要作用是将某字段的值进行去重汇总，产生array类型字段。多行汇总成一个array类型。")])])]),s._v(" "),a("h3",{attrs:{id:"_2-6-列转行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-列转行"}},[s._v("#")]),s._v(" 2.6 列转行")]),s._v(" "),a("ol",[a("li",[s._v("EXPLODE(col)：")])]),s._v(" "),a("blockquote",[a("p",[s._v("将hive一列中复杂的array或者map结构拆分成多行。")]),s._v(" "),a("ol",[a("li",[s._v("LATERAL VIEW\n用法：LATERAL VIEW udtf(expression) table Alias AS columnAlias\n解释：用于和split, explode等UDTF一起使用，它能够将一列数据拆成多行数据，在此基础上可以对拆分后的数据进行聚合。")])])]),s._v(" "),a("h1",{attrs:{id:"_3-hive-调优"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-hive-调优"}},[s._v("#")]),s._v(" 3 Hive 调优")]),s._v(" "),a("h3",{attrs:{id:"_3-1-mapjoin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-mapjoin"}},[s._v("#")]),s._v(" 3.1 MapJoin")]),s._v(" "),a("p",[s._v("如果不指定 MapJoin 或者不符合 MapJoin 的条件，那么 Hive 解析器会将 Join 操作转换成 Common Join，也就是在Reduce阶段完成join。容易发生数据倾斜。可以用 MapJoin 把小表全部加载到内存在map 端进行 join，避免 reducer 处理。")]),s._v(" "),a("h3",{attrs:{id:"_3-2-行列过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-行列过滤"}},[s._v("#")]),s._v(" 3.2 行列过滤")]),s._v(" "),a("p",[s._v("列处理：在SELECT时只拿需要的列，尽量使用分区过滤，少用SELECT *。\n行处理：在分区剪裁中，当使用外关联时，如果将副表的过滤条件写在 Where后面，那么就会先全表关联，之后再过滤。")]),s._v(" "),a("h3",{attrs:{id:"_3-3-合理设置map数跟reduce数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-合理设置map数跟reduce数"}},[s._v("#")]),s._v(" 3.3 合理设置Map数跟Reduce数")]),s._v(" "),a("h5",{attrs:{id:"_3-3-1-map数不是越多越好"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-map数不是越多越好"}},[s._v("#")]),s._v(" 3.3.1  map数不是越多越好")]),s._v(" "),a("p",[s._v("如果一个任务有很多小文件（远远小于块大小128m），则每个小文件也会被当做一个块，用一个map任务来完成，而一个map任务启动和初始化的时间远远大于逻辑处理的时间，就会造成很大的资源浪费 。而且，同时可执行的map数是受限的。此时我们就应该减少map数量。")]),s._v(" "),a("h5",{attrs:{id:"_3-3-2-reduce数不是越多越好"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-reduce数不是越多越好"}},[s._v("#")]),s._v(" 3.3.2 Reduce数不是越多越好")]),s._v(" "),a("ol",[a("li",[s._v("过多的启动和初始化Reduce也会消耗时间和资源；")]),s._v(" "),a("li",[s._v("有多少个Reduce，就会有多少个输出文件，如果生成了很多个小文件，那么如果这些小文件作为下一个任务的输入，则也会出现小文件过多的问题；")]),s._v(" "),a("li",[s._v("Reduce个数设置考虑这两个原则：处理大数据量利用合适的Reduce数；使单个Reduce任务处理数据量大小要合适；")])]),s._v(" "),a("h3",{attrs:{id:"_3-4-严格模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-严格模式"}},[s._v("#")]),s._v(" 3.4 严格模式")]),s._v(" "),a("p",[s._v("严格模式 strict 下会有以下特点：")]),s._v(" "),a("ol",[a("li",[s._v("对于分区表，用户不允许扫描所有分区。")]),s._v(" "),a("li",[s._v("使用了order by语句的查询，要求必须使用limit语句。")]),s._v(" "),a("li",[s._v("限制笛卡尔积的查询。")])]),s._v(" "),a("h3",{attrs:{id:"_3-5-开启map端combiner"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-开启map端combiner"}},[s._v("#")]),s._v(" 3.5 开启map端combiner")]),s._v(" "),a("p",[s._v("在不影响最终业务逻辑前提下，手动开启 set hive.map.aggr=true；")]),s._v(" "),a("h3",{attrs:{id:"_3-6-压缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-压缩"}},[s._v("#")]),s._v(" 3.6 压缩")]),s._v(" "),a("p",[s._v("设置map端输出中间结果压缩，加速网络传输。")]),s._v(" "),a("h3",{attrs:{id:"_3-7-小文件进行合并"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-7-小文件进行合并"}},[s._v("#")]),s._v(" 3.7 小文件进行合并")]),s._v(" "),a("p",[s._v("在Map执行前合并小文件，减少Map数，"),a("strong",[s._v("CombineHiveInputFormat")]),s._v(" 具有对小文件进行合并的功能（系统默认的格式）。HiveInputFormat没有对小文件合并功能。")]),s._v(" "),a("h3",{attrs:{id:"_3-8-其他"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-8-其他"}},[s._v("#")]),s._v(" 3.8 其他")]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("Fetch抓取")]),s._v("：指的是 Hive中对某些情况的查询可以不必使用MapReduce计算。")]),s._v(" "),a("li",[a("strong",[s._v("本地模式")]),s._v("：Hive可以通过本地模式在单台机器上处理所有的任务。")]),s._v(" "),a("li",[a("strong",[s._v("数据分区")]),s._v("：数据细化存储方便访问。")]),s._v(" "),a("li",[a("strong",[s._v("JVM重用")]),s._v("：JVM实例在同一个job中重新使用N次。")]),s._v(" "),a("li",[a("strong",[s._v("推测执行")]),s._v("：根据一定的法则推测出拖后腿的任务，并为这样的任务启动一个备份任务。")]),s._v(" "),a("li",[a("strong",[s._v("并行执行")]),s._v("：一个Hive查询被分解成多个阶段，阶段之间并非完全互相依赖的。")])]),s._v(" "),a("h1",{attrs:{id:"_4-hive-高频考点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-hive-高频考点"}},[s._v("#")]),s._v(" 4 Hive 高频考点")]),s._v(" "),a("h3",{attrs:{id:"_4-1-数据倾斜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-数据倾斜"}},[s._v("#")]),s._v(" 4.1 数据倾斜")]),s._v(" "),a("h5",{attrs:{id:"_4-1-1-定义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-1-定义"}},[s._v("#")]),s._v(" 4.1.1 定义")]),s._v(" "),a("p",[s._v("数据分布不平衡，某些地方特别多，某些地方又特别少，导致的在处理数据的时候，有些很快就处理完了，而有些又迟迟未能处理完，导致整体任务最终迟迟无法完成，这种现象就是数据倾斜。")]),s._v(" "),a("h5",{attrs:{id:"_4-1-2-产生"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-2-产生"}},[s._v("#")]),s._v(" 4.1.2 产生")]),s._v(" "),a("ol",[a("li",[s._v("key的分布不均匀或者说某些key太集中")]),s._v(" "),a("li",[s._v("业务数据自身的特性，例如不同数据类型关联产生数据倾斜")]),s._v(" "),a("li",[s._v("SQL语句导致的数据倾斜")])]),s._v(" "),a("h5",{attrs:{id:"_4-1-3-解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-3-解决"}},[s._v("#")]),s._v(" 4.1.3 解决")]),s._v(" "),a("ol",[a("li",[s._v("不影响最终业务逻辑前提下开启map端combiner。")]),s._v(" "),a("li",[s._v("开启数据倾斜时负载均衡。")]),s._v(" "),a("li",[s._v("手动抽查做好分区规则。")]),s._v(" "),a("li",[s._v("使用mapjoin，小表进内存 在Map端完成Reduce。")])]),s._v(" "),a("h3",{attrs:{id:"_4-2-分区表和分桶表对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-分区表和分桶表对比"}},[s._v("#")]),s._v(" 4.2 分区表和分桶表对比？")]),s._v(" "),a("h5",{attrs:{id:"_4-2-1-分区表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-1-分区表"}},[s._v("#")]),s._v(" 4.2.1 分区表")]),s._v(" "),a("ol",[a("li",[s._v("分区使用的是"),a("code",[s._v("表外")]),s._v("字段，需要指定字段类型")]),s._v(" "),a("li",[s._v("分区通过"),a("code",[s._v("关键字")]),s._v(" "),a("strong",[s._v("partitioned")]),s._v(" by(partition_name string)声明")]),s._v(" "),a("li",[s._v("分区划分粒度"),a("code",[s._v("较粗")])]),s._v(" "),a("li",[s._v("将数据按区域划分开，查询时不用扫描无关的数据，加快查询速度")])]),s._v(" "),a("h5",{attrs:{id:"_4-2-2-分桶表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-2-分桶表"}},[s._v("#")]),s._v(" 4.2.2 分桶表")]),s._v(" "),a("p",[s._v("分桶逻辑：对分桶字段求哈希值，用哈希值与分桶的数量取余决定数据放到哪个桶里。")]),s._v(" "),a("ol",[a("li",[s._v("分桶使用的是"),a("code",[s._v("表内")]),s._v("字段，已经知道字段类型，不需要再指定。")]),s._v(" "),a("li",[s._v("分桶表通过关键字 "),a("strong",[s._v("clustered")]),s._v(" by(column_name) into … buckets声明")]),s._v(" "),a("li",[s._v("分桶是"),a("code",[s._v("更细")]),s._v("粒度的划分、管理数据，可以对表进行先分区再分桶的划分策略")]),s._v(" "),a("li",[s._v("优点在于用于数据取样时候能够起到优化加速的作用")])]),s._v(" "),a("h3",{attrs:{id:"_4-3-动态分区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-动态分区"}},[s._v("#")]),s._v(" 4.3 动态分区")]),s._v(" "),a("ol",[a("li",[s._v("静态分区与动态分区的主要区别在于静态分区是手动指定，而动态分区是通过数据来进行判断。")]),s._v(" "),a("li",[s._v("静态分区的列是在编译时期，通过用户传递来决定的，动态分区只有在 SQL 执行时才能决定。")]),s._v(" "),a("li",[s._v("系统默认开启，非严格模式，动态分区最大值。")])]),s._v(" "),a("h3",{attrs:{id:"_4-4-hive-中视图跟索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-hive-中视图跟索引"}},[s._v("#")]),s._v(" 4.4 Hive 中视图跟索引")]),s._v(" "),a("h5",{attrs:{id:"_4-4-1-视图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-1-视图"}},[s._v("#")]),s._v(" 4.4.1 视图")]),s._v(" "),a("p",[s._v("视图是一种使用查询语句定义的虚拟表，是数据的一种逻辑结构，创建视图时不会把视图存储到磁盘上，定义视图的查询语句只有在执行视图的语句时才会被执行。视图是只读的，不能向视图中插入或是加载数据")]),s._v(" "),a("h5",{attrs:{id:"_4-4-2-hive索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-2-hive索引"}},[s._v("#")]),s._v(" 4.4.2 Hive索引")]),s._v(" "),a("p",[s._v("Hive支持在表中建立索引。但是索引需要额外的存储空间，因此在创建索引时需要考虑索引的必要性。")]),s._v(" "),a("p",[s._v("Hive不支持直接使用 DROP TABLE 语句删除索引表。如果创建索引的表被删除了，则其对应的索引和索引表也会被删除；如果表的某个分区被删除了，则该分区对应的分区索引也会被删除。")]),s._v(" "),a("h3",{attrs:{id:"_4-5-sort-by、order-by、distrbute-by、cluster-by"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-sort-by、order-by、distrbute-by、cluster-by"}},[s._v("#")]),s._v(" 4.5 Sort By、Order By、Distrbute By、Cluster By")]),s._v(" "),a("ol",[a("li",[s._v("Sort By：分区内有序")]),s._v(" "),a("li",[s._v("Order By：全局排序，只有一个Reducer")]),s._v(" "),a("li",[s._v("Distrbute By：类似MR中Partition，进行分区，结合sort by使用")]),s._v(" "),a("li",[s._v("Cluster By：当Distribute by和Sorts by字段相同时，可以使用Cluster by方式。Cluster by 还兼具 Sort by 的功能，但只能是升序排序。")])]),s._v(" "),a("h3",{attrs:{id:"_4-6-内部表-跟外部表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-内部表-跟外部表"}},[s._v("#")]),s._v(" 4.6  内部表 跟外部表")]),s._v(" "),a("h5",{attrs:{id:"_4-6-1-内部表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-1-内部表"}},[s._v("#")]),s._v(" 4.6.1 内部表")]),s._v(" "),a("p",[s._v("如果Hive中没有特别指定，则默认创建的表都是管理表，也称内部表。由Hive负责管理表中的数据，管理表不共享数据。删除管理表时，会删除管理表中的数据和元数据信息。")]),s._v(" "),a("h5",{attrs:{id:"_4-6-2-外部表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-2-外部表"}},[s._v("#")]),s._v(" 4.6.2 外部表")]),s._v(" "),a("p",[s._v("当一份数据需要被共享时，可以创建一个外部表指向这份数据。删除该表并不会删除掉原始数据，删除的是表的元数据。")]),s._v(" "),a("h3",{attrs:{id:"_4-7-udf-、udaf、udtf"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-udf-、udaf、udtf"}},[s._v("#")]),s._v(" 4.7 UDF 、UDAF、UDTF")]),s._v(" "),a("ol",[a("li",[s._v("UDF ：一进一出，类似 upper，trim")]),s._v(" "),a("li",[s._v("UDAF：多进一出，聚集函数，类似 count、max、min。")]),s._v(" "),a("li",[s._v("UDTF：一进多出，如 lateral view explore()")])]),s._v(" "),a("h3",{attrs:{id:"_4-8-hql-如何转变为mapreduce"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-8-hql-如何转变为mapreduce"}},[s._v("#")]),s._v(" 4.8 HQL 如何转变为MapReduce")]),s._v(" "),a("ol",[a("li",[s._v("Antlr定义SQL语法规则，完成SQL词法，语法解析，SQL转化为 抽象语法树 AST Tree。")]),s._v(" "),a("li",[s._v("遍历AST Tree，抽象出查询的基本组成单元QueryBlock。")]),s._v(" "),a("li",[s._v("遍历QueryBlock，翻译为执行操作树OperatorTree。")]),s._v(" "),a("li",[s._v("逻辑层优化OperatorTree变换，合并不必要的ReduceSinkOperator，减少Shuffle数量。")]),s._v(" "),a("li",[s._v("遍历OperatorTree 翻译为MapReduce任务。")]),s._v(" "),a("li",[s._v("物理层优化器进行MapReduce任务变换，生成最终执行计划。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/wJvXicD0z2dUIzkNGFzMg64FLrfTWrHgM9J2iaLic42gnMXicMsTLO6o83icLIhbBn6LNzbA8FIKWicyFm6XFYWibibwGg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}})])])}),[],!1,null,null,null);t.default=e.exports}}]);