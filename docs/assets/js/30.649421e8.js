(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{420:function(e,t,a){"use strict";a.r(t);var r=a(30),s=Object(r.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"hive性能调优-并行执行-严格模式-jvm重用-推测执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hive性能调优-并行执行-严格模式-jvm重用-推测执行"}},[e._v("#")]),e._v(" Hive性能调优 | 并行执行/严格模式/JVM重用/推测执行")]),e._v(" "),a("h4",{attrs:{id:"并行执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#并行执行"}},[e._v("#")]),e._v(" 并行执行")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2OSOAdfBZNfFANIR3DG9407e3bvbGuuZEJB1jTUdA6Pu8mKfQYmYayOFUgNibJpXvmJiawB6Glqaz2A/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}})]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("set hive.exec.parallel=true;              //打开任务并行执行\nset hive.exec.parallel.thread.number=16;  //同一个sql允许最大并行度，默认为8。\n")])])]),a("p",[e._v("当然，得是在系统资源比较空闲的时候才有优势，否则，没资源，并行也起不来。")]),e._v(" "),a("h4",{attrs:{id:"严格模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#严格模式"}},[e._v("#")]),e._v(" 严格模式")]),e._v(" "),a("p",[e._v("Hive提供了一个严格模式，可以防止用户执行“高危”的查询。")]),e._v(" "),a("p",[e._v("通过设置属性hive.mapred.mode值为默认是非严格模式nonstrict 。开启严格模式需要修改hive.mapred.mode值为strict，开启严格模式可以禁止3种类型的查询。")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("<property>\n    <name>hive.mapred.mode</name>\n    <value>strict</value>\n    <description>\n      The mode in which the Hive operations are being performed. \n      In strict mode, some risky queries are not allowed to run. They include:\n        Cartesian Product.\n        No partition being picked up for a query.\n        Comparing bigints and strings.\n        Comparing bigints and doubles.\n        Orderby without limit.\n    </description>\n  </property>\n")])])]),a("ol",[a("li",[e._v("对于分区表，用户不允许扫描所有分区，除非where语句中含有分区字段过滤条件来限制范围，否则不允许执行。进行这个限制的原因是，通常分区表都拥有非常大的数据集，而且数据增加迅速。没有进行分区限制的查询可能会消耗令人不可接受的巨大资源来处理这个表。")]),e._v(" "),a("li",[e._v("对于使用了order by语句的查询，要求必须使用limit语句。因为order by为了执行排序过程会将所有的结果数据分发到同一个Reducer中进行处理，强制要求用户增加这个LIMIT语句可以防止Reducer额外执行很长一段时间。")]),e._v(" "),a("li",[e._v("限制笛卡尔积的查询。对关系型数据库非常了解的用户可能期望在执行JOIN查询的时候不使用ON语句而是使用where语句，这样关系数据库的执行优化器就可以高效地将WHERE语句转化成那个ON语句。不幸的是，Hive并不会执行这种优化，因此，如果表足够大，那么这个查询就会出现不可控的情况。")])]),e._v(" "),a("h4",{attrs:{id:"jvm重用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jvm重用"}},[e._v("#")]),e._v(" JVM重用")]),e._v(" "),a("p",[e._v("JVM重用是Hadoop调优参数的内容，其对Hive的性能具有非常大的影响，特别是对于很难避免小文件的场景或task特别多的场景，这类场景大多数执行时间都很短。")]),e._v(" "),a("p",[e._v("Hadoop的默认配置通常是使用派生JVM来执行map和Reduce任务的。这时JVM的启动过程可能会造成相当大的开销，尤其是执行的job包含有成百上千task任务的情况。JVM重用可以使得JVM实例在同一个job中重新使用N次。N的值可以在Hadoop的mapred-site.xml文件中进行配置。通常在10-20之间，具体多少需要根据具体业务场景测试得出。")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("<property>\n  <name>mapreduce.job.jvm.numtasks</name>\n  <value>10</value>\n  <description>How many tasks to run per jvm. If set to -1, there is\n  no limit. \n  </description>\n</property>\n")])])]),a("p",[e._v("我们也可以在hive当中通过")]),e._v(" "),a("blockquote",[a("p",[e._v("set mapred.job.reuse.jvm.num.tasks=10;")])]),e._v(" "),a("p",[e._v("这个设置来设置我们的jvm重用 当然，这个功能也是有它的缺点的。开启JVM重用将一直占用使用到的task插槽，以便进行重用，直到任务完成后才能释放。如果某个“不平衡的”job中有某几个reduce task执行的时间要比其他Reduce task消耗的时间多的多的话，那么保留的插槽就会一直空闲着却无法被其他的job使用，直到所有的task都结束了才会释放。")]),e._v(" "),a("h4",{attrs:{id:"推测执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#推测执行"}},[e._v("#")]),e._v(" 推测执行")]),e._v(" "),a("p",[e._v("在分布式集群环境下，因为程序Bug（包括Hadoop本身的bug），负载不均衡或者资源分布不均等原因，会造成同一个作业的多个任务之间运行速度不一致，有些任务的运行速度可能明显慢于其他任务（比如一个作业的某个任务进度只有50%，而其他所有任务已经运行完毕），则这些任务会拖慢作业的整体执行进度。为了避免这种情况发生，Hadoop采用了推测执行（Speculative Execution）机制，它根据一定的法则推测出“拖后腿”的任务，并为这样的任务启动一个备份任务，让该任务与原始任务同时处理同一份数据，并最终选用最先成功运行完成任务的计算结果作为最终结果。")]),e._v(" "),a("p",[e._v("Hive 同样可以开启推测执行")]),e._v(" "),a("p",[e._v("设置开启推测执行参数：Hadoop的mapred-site.xml文件中进行配置")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("<property>\n  <name>mapreduce.map.speculative</name>\n  <value>true</value>\n  <description>If true, then multiple instances of some map tasks \n               may be executed in parallel.</description>\n</property>\n\n<property>\n  <name>mapreduce.reduce.speculative</name>\n  <value>true</value>\n  <description>If true, then multiple instances of some reduce tasks \n               may be executed in parallel.</description>\n</property>\n")])])]),a("p",[e._v("不过hive本身也提供了配置项来控制reduce-side的推测执行：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("<property>\n    <name>hive.mapred.reduce.tasks.speculative.execution</name>\n    <value>true</value>\n    <description>Whether speculative execution for reducers should be turned on. </description>\n  </property>\n")])])]),a("p",[e._v("关于调优这些推测执行变量，还很难给一个具体的建议。如果用户对于运行时的偏差非常敏感的话，那么可以将这些功能关闭掉。如果用户因为输入数据量很大而需要执行长时间的map或者Reduce task的话，那么启动推测执行造成的浪费是非常巨大大。")])])}),[],!1,null,null,null);t.default=s.exports}}]);