(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{444:function(t,s,a){"use strict";a.r(s);var n=a(30),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"实时读方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实时读方案"}},[t._v("#")]),t._v(" 实时读方案")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/345375/1632828761505-67972d89-3c8e-44db-a66d-84c164e527c0.png#clientId=uc91b8047-c4d8-4&from=paste&height=740&id=u71db9fe8&margin=%5Bobject%20Object%5D&name=image.png&originHeight=740&originWidth=544&originalType=binary&ratio=1&size=31668&status=done&style=none&taskId=ue4961fbb-b9d7-490c-b080-8e486a68351&width=544",alt:"image.png"}})]),t._v(" "),a("h1",{attrs:{id:"实时写方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实时写方案"}},[t._v("#")]),t._v(" 实时写方案")]),t._v(" "),a("h2",{attrs:{id:"解决两个问题-哪些店铺需要同步到ck-如何将tidb数据同步到ck"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决两个问题-哪些店铺需要同步到ck-如何将tidb数据同步到ck"}},[t._v("#")]),t._v(" 解决两个问题，哪些店铺需要同步到CK，如何将tidb数据同步到CK")]),t._v(" "),a("h2",{attrs:{id:"_1-哪些店铺需要同步到ck"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-哪些店铺需要同步到ck"}},[t._v("#")]),t._v(" 1.哪些店铺需要同步到CK")]),t._v(" "),a("p",[a("strong",[t._v("统计规则（ck统计，并排除已经在同步表的店铺）：")]),t._v("\n（1）当天数据量>50w\n或\n（2）最近一个月数据量>100w")]),t._v(" "),a("h2",{attrs:{id:"_2-如何将tidb数据同步到ck"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-如何将tidb数据同步到ck"}},[t._v("#")]),t._v(" 2.如何将tidb数据同步到CK")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/345375/1632831172083-7cfe96af-cf09-43f6-b9e8-a06877213568.png#clientId=uc91b8047-c4d8-4&from=paste&height=776&id=ua55b3d67&margin=%5Bobject%20Object%5D&name=image.png&originHeight=776&originWidth=523&originalType=binary&ratio=1&size=47208&status=done&style=none&taskId=u1706bb0c-ab37-4e94-bb2e-20396215bda&width=523",alt:"image.png"}}),t._v("\n使用ck原生SQL写入到ck分布式表\n举例：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("insert")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("into")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sl_dm_store_behavior_session_distributed\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" dt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("app_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("row_key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("store_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ua_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ua_browser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ua_os_version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nua_os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("city"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("province"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("region"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("pv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("uv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("visit_checkout_cnt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("completed_checkout_cnt \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" mysql_db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sl_dm_store_behavior_session_hourly_rt\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" dt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v("toDateTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2021-08-01'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" dt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("oDateTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("08")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("02")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("​")]),t._v(" "),a("p",[a("strong",[t._v("CK分布式全量表（随机分片+dt分区）")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sl_dm_store_behavior_session_local "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" cluster cluster_01\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    dt                     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DateTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    app_id                 String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    row_key                String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    store_id               Int64"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    ua_type                Nullable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    ua_browser             Nullable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    ua_os_version          Nullable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    ua_os                  Nullable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    city                   Nullable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    province               Nullable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    region                 Nullable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    pv                     Nullable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Int64"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    uv                     Nullable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Int32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    visit_checkout_cnt     Nullable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Int32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    completed_checkout_cnt Nullable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Int32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ReplicatedReplacingMergeTree"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/clickhouse/tables/{layer}-{shard}/sl_dm_store_behavior_session_local'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{replica}'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PARTITION")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" toYYYYMM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ORDER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("store_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("dt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("row_key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("primary")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("key")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("store_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("dt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("row_key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    \n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sl_dm_store_behavior_session_distributed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" CLUSTER cluster_01 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sl_dm_store_behavior_session_local\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Distributed")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cluster_01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sl_dm_store_behavior_session_local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" rand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("strong",[t._v("CK店铺表（store_id分片+store_id+月分区）")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sl_dm_store_behavior_session_local_store_id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" cluster cluster_01\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    dt                     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DateTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    app_id                 String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    store_id               Int64"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    ua_type                String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    ua_browser             String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    ua_os_version          String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    ua_os                  String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    city                   String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    province               String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    region                 String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    pv                     Int64"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    uv                     Int32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    visit_checkout_cnt     Int32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    completed_checkout_cnt Int32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INDEX")]),t._v(" tag_idx_store_id_dt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("store_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("dt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TYPE")]),t._v(" minmax GRANULARITY "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ReplicatedReplacingMergeTree"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/clickhouse/tables/{layer}-{shard}/sl_dm_store_behavior_session_local_store_id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{replica}'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PARTITION")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("store_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("toYYYYMM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ORDER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("store_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("dt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("app_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ua_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ua_browser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ua_os_version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ua_os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("city"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("province"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("region"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sl_dm_store_behavior_session_distributed_store_id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" CLUSTER cluster_01 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sl_dm_store_behavior_session_local_store_id\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Distributed")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cluster_01'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'default'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sl_dm_store_behavior_session_local_store_id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" store_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("strong",[t._v("​")])]),t._v(" "),a("p",[a("strong",[t._v('"CK分布式全量表"写入到"CK店铺表"SQL')])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("insert")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("into")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sl_dm_store_behavior_session_distributed10\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" toStartOfHour"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" dt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("app_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("store_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       ifNull"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ua_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'N/A'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" ua_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       ifNull"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ua_browser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'N/A'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" ua_browser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       ifNull"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ua_os_version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'N/A'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" ua_os_version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       ifNull"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ua_os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'N/A'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" ua_os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       ifNull"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("city"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'N/A'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" city"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       ifNull"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("province"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'N/A'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" province"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       ifNull"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("region"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'N/A'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" region"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" pv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" uv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("visit_checkout_cnt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" visit_checkout_cnt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("completed_checkout_cnt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" completed_checkout_cnt\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sl_dm_store_behavior_session_local l "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" \ntidb店铺同步表\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" store_id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" dt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("当天时间范围\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GROUP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" store_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("dt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("app_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ua_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ua_browser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ua_os_version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ua_os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("city"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("province"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("region"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);