(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{424:function(t,s,a){"use strict";a.r(s);var n=a(30),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"hiveçª—å£å‡½æ•°æ€»ç»“ä¸å®è·µ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hiveçª—å£å‡½æ•°æ€»ç»“ä¸å®è·µ"}},[t._v("#")]),t._v(" Hiveçª—å£å‡½æ•°æ€»ç»“ä¸å®è·µ")]),t._v(" "),a("h2",{attrs:{id:"ä¸€ã€ç®€ä»‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¸€ã€ç®€ä»‹"}},[t._v("#")]),t._v(" ä¸€ã€ç®€ä»‹")]),t._v(" "),a("p",[t._v("æœ¬æ–‡ä¸»è¦ä»‹ç»Hiveä¸­çš„çª—å£å‡½æ•°ï¼ŒHiveä¸­çš„çª—å£å‡½æ•°å’ŒSQLä¸­çš„çª—å£å‡½æ•°ç›¸ç±»ä¼¼ï¼Œéƒ½æ˜¯ç”¨æ¥åšä¸€äº›æ•°æ®åˆ†æç±»çš„å·¥ä½œï¼Œä¸€èˆ¬ç”¨äºolapåˆ†æï¼ˆåœ¨çº¿åˆ†æå¤„ç†ï¼‰ã€‚")]),t._v(" "),a("h2",{attrs:{id:"äºŒã€æ¦‚å¿µ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#äºŒã€æ¦‚å¿µ"}},[t._v("#")]),t._v(" äºŒã€æ¦‚å¿µ")]),t._v(" "),a("p",[t._v("æˆ‘ä»¬éƒ½çŸ¥é“åœ¨sqlä¸­æœ‰ä¸€ç±»å‡½æ•°å«åšèšåˆå‡½æ•°ï¼Œä¾‹å¦‚"),a("code",[t._v("sum()ã€avg()ã€max()")]),t._v("ç­‰ç­‰ï¼Œè¿™ç±»å‡½æ•°å¯ä»¥å°†å¤šè¡Œæ•°æ®æŒ‰ç…§è§„åˆ™èšé›†ä¸ºä¸€è¡Œï¼Œä¸€èˆ¬æ¥è®²èšé›†åçš„è¡Œæ•°æ˜¯è¦å°‘äºèšé›†å‰çš„è¡Œæ•°çš„ï¼Œä½†æ˜¯æœ‰æ—¶æˆ‘ä»¬æƒ³è¦æ—¢æ˜¾ç¤ºèšé›†å‰çš„æ•°æ®ï¼Œåˆè¦æ˜¾ç¤ºèšé›†åçš„æ•°æ®ï¼Œè¿™æ—¶æˆ‘ä»¬ä¾¿å¼•å…¥äº†çª—å£å‡½æ•°ã€‚")]),t._v(" "),a("p",[a("strong",[t._v("ã€Œåœ¨æ·±å…¥ç ”ç©¶Overå­—å¥ä¹‹å‰ï¼Œä¸€å®šè¦æ³¨æ„ï¼šåœ¨SQLå¤„ç†ä¸­ï¼Œçª—å£å‡½æ•°éƒ½æ˜¯æœ€åä¸€æ­¥æ‰§è¡Œï¼Œè€Œä¸”ä»…ä½äºOrder byå­—å¥ä¹‹å‰ã€‚ã€")])]),t._v(" "),a("h2",{attrs:{id:"ä¸‰ã€æ•°æ®å‡†å¤‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¸‰ã€æ•°æ®å‡†å¤‡"}},[t._v("#")]),t._v(" ä¸‰ã€æ•°æ®å‡†å¤‡")]),t._v(" "),a("p",[t._v("æˆ‘ä»¬å‡†å¤‡ä¸€å¼ orderè¡¨ï¼Œå­—æ®µåˆ†åˆ«ä¸ºnameï¼Œorderdateï¼Œcostï¼Œæ•°æ®å†…å®¹å¦‚ä¸‹ï¼š")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("jack 2015-04-03 23\njack 2015-01-01 10\ntony 2015-01-02 15\njack 2015-02-03 23\ntony 2015-01-04 29\njack 2015-01-05 46\njack 2015-04-06 42\ntony 2015-01-07 50\njack 2015-01-08 55\nmart 2015-04-08 62\nmart 2015-04-09 68\nneil 2015-05-10 12\nmart 2015-04-11 75\nneil 2015-06-12 80\nmart 2015-04-13 94\n")])])]),a("p",[t._v("åœ¨hiveä¸­å»ºç«‹ä¸€å¼ è¡¨order,å°†æ•°æ®æ’å…¥è¿›å»ã€‚")]),t._v(" "),a("h2",{attrs:{id:"å››ã€èšåˆå‡½æ•°-over"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å››ã€èšåˆå‡½æ•°-over"}},[t._v("#")]),t._v(" å››ã€èšåˆå‡½æ•°+over()")]),t._v(" "),a("p",[t._v("å‡å¦‚è¯´æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢åœ¨2015å¹´4æœˆä»½è´­ä¹°è¿‡çš„é¡¾å®¢åŠæ€»äººæ•°ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨çª—å£å‡½æ•°å»å»å®ç°ã€‚"),a("code",[t._v("select name,count(*) over() from order where substring(orderdate,1,7)='2015-04';")]),t._v("å¾—åˆ°ç»“æœå¦‚ä¸‹ï¼š"),a("code",[t._v("mart 6mart 6mart 6mart 6jack 6jack 6")]),t._v("å¯è§å…¶å®åœ¨2015å¹´4æœˆä¸€å…±æœ‰5æ¬¡è´­ä¹°è®°å½•ï¼Œmartè´­ä¹°äº†4æ¬¡ï¼Œjackè´­ä¹°äº†2æ¬¡ã€‚äº‹å®ä¸Šï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯åªçœ‹å»é‡åçš„ç»“æœçš„ã€‚é’ˆå¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬æƒ³å¯¹ä»£ç æ”¹è¿›ï¼Œè¿›è¡Œå»é‡ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ ğŸ˜‰")]),t._v(" "),a("p",[t._v("ç¬¬ä¸€ç§æ–¹å¼ï¼š "),a("strong",[t._v("ã€Œgroup byã€")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" j"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("j"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("e "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" e "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" substring"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2015-04'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" j \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("group")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" j"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("j"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("ç»“æœå¦‚ä¸‹ï¼š")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("jack 6\nmart 6\n")])])]),a("p",[t._v("ç¬¬äºŒç§æ–¹å¼ï¼š"),a("strong",[t._v("ã€Œdistinctã€")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("distinct")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" substring"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2015-04'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("ç»“æœå¦‚ä¸‹ï¼š")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("jack 2\nmart 2\n")])])]),a("h2",{attrs:{id:"äº”ã€partition-by-å­å¥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#äº”ã€partition-by-å­å¥"}},[t._v("#")]),t._v(" äº”ã€partition by å­å¥")]),t._v(" "),a("p",[t._v("Overå­å¥ä¹‹åç¬¬ä¸€ä¸ªæåˆ°çš„å°±æ˜¯**ã€ŒPartition Byã€"),a("strong",[t._v("ã€‚Partition Byå­å¥ä¹Ÿå¯ä»¥ç§°ä¸º")]),t._v("ã€ŒæŸ¥è¯¢åˆ†åŒºå­å¥ã€**ï¼Œéå¸¸ç±»ä¼¼äºGroup Byï¼Œéƒ½æ˜¯å°†æ•°æ®æŒ‰ç…§è¾¹ç•Œå€¼åˆ†ç»„ï¼Œè€ŒOverä¹‹å‰çš„å‡½æ•°åœ¨æ¯ä¸€ä¸ªåˆ†ç»„ä¹‹å†…è¿›è¡Œï¼Œå¦‚æœè¶…å‡ºäº†åˆ†ç»„ï¼Œåˆ™å‡½æ•°ä¼šé‡æ–°è®¡ç®—ã€‚")]),t._v(" "),a("p",[t._v("å®ä¾‹")]),t._v(" "),a("p",[t._v("æˆ‘ä»¬æƒ³è¦å»çœ‹é¡¾å®¢çš„è´­ä¹°æ˜ç»†åŠæœˆè´­ä¹°æ€»é¢ï¼Œå¯ä»¥æ‰§è¡Œå¦‚ä¸‹çš„sqlã€‚")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("month")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v("\n")])])]),a("p",[t._v("ç»“æœå¦‚ä¸‹ï¼š")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("tony 2015-01-07 50 205\njack 2015-01-01 10 205\njack 2015-01-05 46 205\ntony 2015-01-04 29 205\ntony 2015-01-02 15 205\njack 2015-01-08 55 205\njack 2015-02-03 23 23\nmart 2015-04-13 94 364\nmart 2015-04-11 75 364\nmart 2015-04-09 68 364\nmart 2015-04-08 62 364\njack 2015-04-06 42 364\njack 2015-04-03 23 364\nneil 2015-05-10 12 12\nneil 2015-06-12 80 80\n")])])]),a("p",[t._v("è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•°æ®å·²ç»å®Œå…¨æŒ‰ç…§æœˆä»½è¿›è¡Œèšåˆã€‚")]),t._v(" "),a("h2",{attrs:{id:"å…­ã€order-by-å­å¥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å…­ã€order-by-å­å¥"}},[t._v("#")]),t._v(" å…­ã€order by å­å¥")]),t._v(" "),a("p",[t._v("ä¸Šè¿°çš„åœºæ™¯ï¼Œå‡å¦‚æˆ‘ä»¬æƒ³è¦å°†costæŒ‰ç…§æœˆè¿›è¡Œç´¯åŠ ï¼Œè¿™æ—¶æˆ‘ä»¬å¼•å…¥order byå­å¥ã€‚")]),t._v(" "),a("p",[t._v("order byå­å¥ä¼šè®©è¾“å…¥çš„æ•°æ®å¼ºåˆ¶æ’åºï¼ˆçª—å£å‡½æ•°æ˜¯SQLè¯­å¥æœ€åæ‰§è¡Œçš„å‡½æ•°ï¼Œå› æ­¤å¯ä»¥æŠŠSQLç»“æœé›†æƒ³è±¡æˆè¾“å…¥æ•°æ®ï¼‰ã€‚Order Byå­å¥å¯¹äºè¯¸å¦‚"),a("code",[t._v("Row_Number()")]),t._v("ï¼Œ"),a("code",[t._v("Lead()")]),t._v("ï¼Œ"),a("code",[t._v("LAG()")]),t._v("ç­‰å‡½æ•°æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºå¦‚æœæ•°æ®æ— åºï¼Œè¿™äº›å‡½æ•°çš„ç»“æœå°±æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚å› æ­¤å¦‚æœæœ‰äº†Order Byå­å¥ï¼Œåˆ™"),a("code",[t._v("Count()")]),t._v("ï¼Œ"),a("code",[t._v("Min()")]),t._v("ç­‰è®¡ç®—å‡ºæ¥çš„ç»“æœå°±æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚")]),t._v(" "),a("p",[t._v("æˆ‘ä»¬åœ¨ä¸Šé¢çš„ä»£ç ä¸­åŠ å…¥order by")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("select name,orderdate,cost,sum(cost) over(partition by month(orderdate) order by orderdate) \nfrom order;\n")])])]),a("p",[t._v("ç»“æœå¦‚ä¸‹ï¼š")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("jack 2015-01-01 10 10         // 10\ntony 2015-01-02 15 25         // 10+15\ntony 2015-01-04 29 54         // 25+29\njack 2015-01-05 46 100\ntony 2015-01-07 50 150\njack 2015-01-08 55 205\njack 2015-02-03 23 23\njack 2015-04-03 23 23\njack 2015-04-06 42 65\nmart 2015-04-08 62 127\nmart 2015-04-09 68 195\nmart 2015-04-11 75 270\nmart 2015-04-13 94 364\nneil 2015-05-10 12 12\nneil 2015-06-12 80 80\n")])])]),a("h2",{attrs:{id:"ä¸ƒã€window-å­å¥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ƒã€window-å­å¥"}},[t._v("#")]),t._v(" ä¸ƒã€window å­å¥")]),t._v(" "),a("p",[t._v("æˆ‘ä»¬åœ¨ä¸Šé¢å·²ç»é€šè¿‡ä½¿ç”¨partition byå­å¥å°†æ•°æ®è¿›è¡Œäº†åˆ†ç»„çš„å¤„ç†ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æ›´ç»†ç²’åº¦çš„åˆ’åˆ†ï¼Œæˆ‘ä»¬å°±è¦å¼•å…¥windowå­å¥äº†ã€‚")]),t._v(" "),a("p",[t._v("æˆ‘ä»¬é¦–å…ˆè¦ç†è§£ä¸¤ä¸ªæ¦‚å¿µï¼š")]),t._v(" "),a("ul",[a("li",[t._v("å¦‚æœåªä½¿ç”¨partition byå­å¥ï¼ŒæœªæŒ‡å®šorder byçš„è¯ï¼Œæˆ‘ä»¬çš„èšåˆæ˜¯åˆ†ç»„å†…çš„èšåˆã€‚")]),t._v(" "),a("li",[t._v("ä½¿ç”¨äº†order byå­å¥ï¼Œæœªä½¿ç”¨windowå­å¥çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤ä»èµ·ç‚¹åˆ°å½“å‰è¡Œã€‚")])]),t._v(" "),a("p",[t._v("å½“åŒä¸€ä¸ªselectæŸ¥è¯¢ä¸­å­˜åœ¨å¤šä¸ªçª—å£å‡½æ•°æ—¶ï¼Œä»–ä»¬ç›¸äº’ä¹‹é—´æ˜¯æ²¡æœ‰å½±å“çš„ï¼Œæ¯ä¸ªçª—å£å‡½æ•°åº”ç”¨è‡ªå·±çš„è§„åˆ™ã€‚")]),t._v(" "),a("p",[a("strong",[t._v("ã€Œwindowå­å¥ã€")]),t._v("ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("PRECEDINGï¼šå¾€å‰")]),t._v(" "),a("li",[t._v("FOLLOWINGï¼šå¾€å")]),t._v(" "),a("li",[t._v("CURRENT ROWï¼šå½“å‰è¡Œ")]),t._v(" "),a("li",[t._v("UNBOUNDEDï¼šèµ·ç‚¹ï¼ŒUNBOUNDED PRECEDING è¡¨ç¤ºä»å‰é¢çš„èµ·ç‚¹ï¼Œ UNBOUNDED FOLLOWINGï¼šè¡¨ç¤ºåˆ°åé¢çš„ç»ˆç‚¹")])]),t._v(" "),a("p",[t._v("æˆ‘ä»¬æŒ‰ç…§nameè¿›è¡Œåˆ†åŒº,æŒ‰ç…§è´­ç‰©æ—¶é—´è¿›è¡Œæ’åºï¼Œåšcostçš„ç´¯åŠ ã€‚å¦‚ä¸‹æˆ‘ä»¬ç»“åˆä½¿ç”¨windowå­å¥è¿›è¡ŒæŸ¥è¯¢")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" fullagg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--æ‰€æœ‰è¡Œç›¸åŠ ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" fullaggbyname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--æŒ‰nameåˆ†ç»„ï¼Œç»„å†…æ•°æ®ç›¸åŠ ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" fabno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--æŒ‰nameåˆ†ç»„ï¼Œç»„å†…æ•°æ®ç´¯åŠ  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" orderdate "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("between")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("unbounded")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("preceding")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("current")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("row")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" mw1   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--å’Œfabnoä¸€æ ·,ç”±æœ€å‰é¢çš„èµ·ç‚¹åˆ°å½“å‰è¡Œçš„èšåˆ ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" orderdate "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("between")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("preceding")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("current")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("row")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" mw2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--å½“å‰è¡Œå’Œå‰é¢ä¸€è¡Œåšèšåˆ ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" orderdate "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("between")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("preceding")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("following")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" mw3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--å½“å‰è¡Œå’Œå‰è¾¹ä¸€è¡ŒåŠåé¢ä¸€è¡Œ ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" orderdate "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("between")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("current")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("row")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("unbounded")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("following")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" mw4  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--å½“å‰è¡ŒåŠåé¢æ‰€æœ‰è¡Œ ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n")])])]),a("p",[t._v("ç»“æœå¦‚ä¸‹ï¼š")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("jack 2015-01-01 10 684 199 10 10 10 56 199\njack 2015-01-05 46 684 199 56 56 56 111 189\njack 2015-01-08 55 684 199 111 111 101 124 143\njack 2015-02-03 23 684 199 134 134 78 101 88\njack 2015-04-03 23 684 199 157 157 46 88 65\njack 2015-04-06 42 684 199 199 199 65 65 42\nmart 2015-04-08 62 684 299 62 62 62 130 299\nmart 2015-04-09 68 684 299 130 130 130 205 237\nmart 2015-04-11 75 684 299 205 205 143 237 169\nmart 2015-04-13 94 684 299 299 299 169 169 94\nneil 2015-05-10 12 684 92 12 12 12 92 92\nneil 2015-06-12 80 684 92 92 92 92 92 80\ntony 2015-01-02 15 684 94 15 15 15 44 94\ntony 2015-01-04 29 684 94 44 44 44 94 79\ntony 2015-01-07 50 684 94 94 94 79 79 50\n")])])]),a("h2",{attrs:{id:"å…«ã€çª—å£å‡½æ•°ä¸­çš„åºåˆ—å‡½æ•°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å…«ã€çª—å£å‡½æ•°ä¸­çš„åºåˆ—å‡½æ•°"}},[t._v("#")]),t._v(" å…«ã€çª—å£å‡½æ•°ä¸­çš„åºåˆ—å‡½æ•°")]),t._v(" "),a("p",[t._v("ä¸»è¦åºåˆ—å‡½æ•°æ˜¯ä¸æ”¯æŒwindowå­å¥çš„ã€‚")]),t._v(" "),a("p",[t._v("hiveä¸­å¸¸ç”¨çš„åºåˆ—å‡½æ•°æœ‰ä¸‹é¢å‡ ä¸ªğŸ˜€ï¼š")]),t._v(" "),a("h3",{attrs:{id:"ntile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ntile"}},[t._v("#")]),t._v(" ntile")]),t._v(" "),a("p",[t._v("NTILE(n)ï¼Œç”¨äºå°†åˆ†ç»„æ•°æ®æŒ‰ç…§é¡ºåºåˆ‡åˆ†æˆnç‰‡ï¼Œè¿”å›å½“å‰åˆ‡ç‰‡å€¼NTILEä¸æ”¯æŒROWS BETWEENï¼Œ æ¯”å¦‚ NTILE(2) OVER(PARTITION BY cookieid ORDER BY createtime ROWS BETWEEN 3 PRECEDING - AND CURRENT ROW)å¦‚æœåˆ‡ç‰‡ä¸å‡åŒ€ï¼Œé»˜è®¤å¢åŠ ç¬¬ä¸€ä¸ªåˆ‡ç‰‡çš„åˆ†å¸ƒè¿™ä¸ªå‡½æ•°ç”¨ä»€ä¹ˆåº”ç”¨åœºæ™¯å‘¢?å‡å¦‚æˆ‘ä»¬æƒ³è¦æ¯ä½é¡¾å®¢è´­ä¹°é‡‘é¢å‰1/3çš„äº¤æ˜“è®°å½•,æˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       ntile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" sample1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- å…¨å±€æ•°æ®åˆ‡ç‰‡")]),t._v("\n       ntile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- æŒ‰ç…§nameè¿›è¡Œåˆ†ç»„,åœ¨åˆ†ç»„å†…å°†æ•°æ®åˆ‡æˆ3ä»½")]),t._v("\n       ntile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- å…¨å±€æŒ‰ç…§costå‡åºæ’åˆ—,æ•°æ®åˆ‡æˆ3ä»½")]),t._v("\n       ntile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" cost "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- æŒ‰ç…§nameåˆ†ç»„ï¼Œåœ¨åˆ†ç»„å†…æŒ‰ç…§costå‡åºæ’åˆ—,æ•°æ®åˆ‡æˆ3ä»½")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v("\n")])])]),a("p",[t._v("å¾—åˆ°çš„æ•°æ®å¦‚ä¸‹ï¼š")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("jack 2015-01-01 10 3 1 1 1\njack 2015-02-03 23 3 2 1 1\njack 2015-04-03 23 3 3 1 2\njack 2015-04-06 42 2 1 2 2\njack 2015-01-05 46 2 3 2 3\njack 2015-01-08 55 2 2 2 3\nmart 2015-04-08 62 2 1 3 1\nmart 2015-04-09 68 1 2 3 1\nmart 2015-04-11 75 1 3 3 2\nmart 2015-04-13 94 1 1 3 3\nneil 2015-05-10 12 1 2 1 1\nneil 2015-06-12 80 1 1 3 2\ntony 2015-01-02 15 3 2 1 1\ntony 2015-01-04 29 3 1 2 2\ntony 2015-01-07 50 2 3 2 3\n")])])]),a("p",[t._v("å¦‚ä¸Šè¿°æ•°æ®ï¼Œæˆ‘ä»¬å»sample4 = 1çš„é‚£éƒ¨åˆ†æ•°æ®å°±æ˜¯æˆ‘ä»¬è¦çš„ç»“æœ")]),t._v(" "),a("h3",{attrs:{id:"row-number"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#row-number"}},[t._v("#")]),t._v(" row_number")]),t._v(" "),a("p",[t._v("ç”¨é€”éå¸¸å¹¿æ³›ï¼Œæ’åºæœ€å¥½ç”¨å®ƒï¼Œå®ƒä¼šä¸ºæŸ¥è¯¢å‡ºæ¥çš„æ¯ä¸€è¡Œè®°å½•ç”Ÿæˆä¸€ä¸ªåºå·ï¼Œä¾æ¬¡æ’åºä¸”ä¸ä¼šé‡å¤ï¼Œæ³¨æ„ä½¿ç”¨row_numberå‡½æ•°æ—¶å¿…é¡»è¦ç”¨overå­å¥é€‰æ‹©å¯¹æŸä¸€åˆ—è¿›è¡Œæ’åºæ‰èƒ½ç”Ÿæˆåºå·ã€‚rankå‡½æ•°ç”¨äºè¿”å›ç»“æœé›†çš„åˆ†åŒºå†…æ¯è¡Œçš„æ’åï¼Œè¡Œçš„æ’åæ˜¯ç›¸å…³è¡Œä¹‹å‰çš„æ’åæ•°åŠ ä¸€ã€‚ç®€å•æ¥è¯´rankå‡½æ•°å°±æ˜¯å¯¹æŸ¥è¯¢å‡ºæ¥çš„è®°å½•è¿›è¡Œæ’åï¼Œä¸row_numberå‡½æ•°ä¸åŒçš„æ˜¯ï¼Œrankå‡½æ•°è€ƒè™‘åˆ°äº†overå­å¥ä¸­æ’åºå­—æ®µå€¼ç›¸åŒçš„æƒ…å†µï¼Œå¦‚æœä½¿ç”¨rankå‡½æ•°æ¥ç”Ÿæˆåºå·ï¼Œoverå­å¥ä¸­æ’åºå­—æ®µå€¼ç›¸åŒçš„åºå·æ˜¯ä¸€æ ·çš„ï¼Œåé¢å­—æ®µå€¼ä¸ç›¸åŒçš„åºå·å°†è·³è¿‡ç›¸åŒçš„æ’åå·æ’ä¸‹ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯ç›¸å…³è¡Œä¹‹å‰çš„æ’åæ•°åŠ ä¸€ï¼Œå¯ä»¥ç†è§£ä¸ºæ ¹æ®å½“å‰çš„è®°å½•æ•°ç”Ÿæˆåºå·ï¼Œåé¢çš„è®°å½•ä¾æ­¤ç±»æ¨ã€‚dense_rankå‡½æ•°çš„åŠŸèƒ½ä¸rankå‡½æ•°ç±»ä¼¼ï¼Œdense_rankå‡½æ•°åœ¨ç”Ÿæˆåºå·æ—¶æ˜¯è¿ç»­çš„ï¼Œè€Œrankå‡½æ•°ç”Ÿæˆçš„åºå·æœ‰å¯èƒ½ä¸è¿ç»­ã€‚dense_rankå‡½æ•°å‡ºç°ç›¸åŒæ’åæ—¶ï¼Œå°†ä¸è·³è¿‡ç›¸åŒæ’åå·ï¼Œrankå€¼ç´§æ¥ä¸Šä¸€æ¬¡çš„rankå€¼ã€‚åœ¨å„ä¸ªåˆ†ç»„å†…ï¼Œrank()æ˜¯è·³è·ƒæ’åºï¼Œæœ‰ä¸¤ä¸ªç¬¬ä¸€åæ—¶æ¥ä¸‹æ¥å°±æ˜¯ç¬¬ä¸‰åï¼Œdense_rank()æ˜¯è¿ç»­æ’åºï¼Œæœ‰ä¸¤ä¸ªç¬¬ä¸€åæ—¶ä»ç„¶è·Ÿç€ç¬¬äºŒåã€‚è¿™ä¸‰ä¸ªçª—å£å‡½æ•°çš„ä½¿ç”¨åœºæ™¯éå¸¸å¤š"),a("code",[t._v("row_number()")]),t._v("ï¼šä»1å¼€å§‹ï¼ŒæŒ‰ç…§é¡ºåºï¼Œç”Ÿæˆåˆ†ç»„å†…è®°å½•çš„åºåˆ—ï¼Œrow_number()çš„å€¼ä¸ä¼šå­˜åœ¨é‡å¤ï¼Œå½“æ’åºçš„å€¼ç›¸åŒæ—¶ï¼ŒæŒ‰ç…§è¡¨ä¸­è®°å½•çš„é¡ºåºè¿›è¡Œæ’åˆ—"),a("code",[t._v("rank()")]),t._v(" ï¼šç”Ÿæˆæ•°æ®é¡¹åœ¨åˆ†ç»„ä¸­çš„æ’åï¼Œæ’åç›¸ç­‰ä¼šåœ¨åæ¬¡ä¸­**ã€Œç•™ä¸‹ç©ºä½ã€"),a("strong",[a("code",[t._v("dense_rank()")]),t._v(" ï¼šç”Ÿæˆæ•°æ®é¡¹åœ¨åˆ†ç»„ä¸­çš„æ’åï¼Œæ’åç›¸ç­‰ä¼šåœ¨åæ¬¡ä¸­")]),t._v("ã€Œä¸ä¼šç•™ä¸‹ç©ºä½ã€****ã€Œæ³¨æ„ï¼šrankå’Œdense_rankçš„åŒºåˆ«åœ¨äºæ’åç›¸ç­‰æ—¶ä¼šä¸ä¼šç•™ä¸‹ç©ºä½ã€**")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nrow_number"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" rn1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nrank"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" rn2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\ndense_rank"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" rn3\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("å¾—åˆ°ç»“æœï¼š")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("jack 2015-01-01 10 1 1 1\njack 2015-02-03 23 2 2 2\njack 2015-04-03 23 3 2 2\njack 2015-04-06 42 4 4 3\njack 2015-01-05 46 5 5 4\njack 2015-01-08 55 6 6 5\nmart 2015-04-08 62 1 1 1\nmart 2015-04-09 68 2 2 2\nmart 2015-04-11 75 3 3 3\nmart 2015-04-13 94 4 4 4\nneil 2015-05-10 12 1 1 1\nneil 2015-06-12 80 2 2 2\ntony 2015-01-02 15 1 1 1\ntony 2015-01-04 29 2 2 2\ntony 2015-01-07 50 3 3 3\n")])])]),a("h3",{attrs:{id:"lag-å’Œ-lead"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lag-å’Œ-lead"}},[t._v("#")]),t._v(" lag å’Œ lead")]),t._v(" "),a("p",[t._v("è¿™ä¸¤ä¸ªå‡½æ•°ä¸ºå¸¸ç”¨çš„çª—å£å‡½æ•°,å¯ä»¥è¿”å›ä¸Šä¸‹æ•°æ®è¡Œçš„æ•°æ®. ä»¥æˆ‘ä»¬çš„è®¢å•è¡¨ä¸ºä¾‹,å‡å¦‚æˆ‘ä»¬æƒ³è¦æŸ¥çœ‹é¡¾å®¢ä¸Šæ¬¡çš„è´­ä¹°æ—¶é—´å¯ä»¥è¿™æ ·å»æŸ¥è¯¢")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("hive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("lag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1996-09-09'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v("  orderdate "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" time1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("lag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" orderdate "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" time2 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/zWSuIP8rdu0KbLSZGdgjMCdyFeFiaKXqp2bmzkAvH9R24ytIVrtnbnEYgujjrGRDCbVvHZOE249MlMbSFPMoHJA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),t._v("time1å–çš„ä¸ºæŒ‰ç…§nameè¿›è¡Œåˆ†ç»„ï¼Œåˆ†ç»„å†…å‡åºæ’åˆ—,å–ä¸Šä¸€è¡Œæ•°æ®çš„å€¼ã€‚")]),t._v(" "),a("p",[t._v("time2å–çš„ä¸ºæŒ‰ç…§nameè¿›è¡Œåˆ†ç»„ï¼Œåˆ†ç»„å†…å‡åºæ’åˆ—,å–ä¸Šé¢4è¡Œçš„æ•°æ®çš„å€¼ï¼Œæ³¨æ„å½“lagå‡½æ•°æœªè®¾ç½®è¡Œæ•°å€¼æ—¶,é»˜è®¤ä¸º1è¡Œ.è®¾å®šå–ä¸åˆ°æ—¶çš„é»˜è®¤å€¼æ—¶ï¼Œå–nullå€¼ã€‚")]),t._v(" "),a("p",[t._v("leadå‡½æ•°ä¸lagå‡½æ•°æ–¹å‘ç›¸åï¼Œå–å‘ä¸‹çš„æ•°æ®ï¼Œè¿™é‡Œæˆ‘å°±ä¸å†ä¸¾ä¾‹è¾£ğŸ˜‚ã€‚")]),t._v(" "),a("h3",{attrs:{id:"first-value-å’Œ-last-value"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#first-value-å’Œ-last-value"}},[t._v("#")]),t._v(" first_value å’Œ last_value")]),t._v(" "),a("p",[t._v("first_valueå–åˆ†ç»„å†…æ’åºåï¼Œæˆªæ­¢åˆ°å½“å‰è¡Œï¼Œç¬¬ä¸€ä¸ªå€¼ last_valueå–åˆ†ç»„å†…æ’åºåï¼Œæˆªæ­¢åˆ°å½“å‰è¡Œï¼Œæœ€åä¸€ä¸ªå€¼")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("cost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nfirst_value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" time1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nlast_value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" orderdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" time2\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v("\n")])])]),a("p",[t._v("æŸ¥è¯¢ç»“æœå¦‚ä¸‹:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("name    orderdate   cost    time1   time2\njack    2015-01-01  10  2015-01-01  2015-01-01\njack    2015-01-05  46  2015-01-01  2015-01-05\njack    2015-01-08  55  2015-01-01  2015-01-08\njack    2015-02-03  23  2015-01-01  2015-02-03\njack    2015-04-06  42  2015-01-01  2015-04-06\nmart    2015-04-08  62  2015-04-08  2015-04-08\nmart    2015-04-09  68  2015-04-08  2015-04-09\nmart    2015-04-11  75  2015-04-08  2015-04-11\nmart    2015-04-13  94  2015-04-08  2015-04-13\nneil    2015-05-10  12  2015-05-10  2015-05-10\nneil    2015-06-12  80  2015-05-10  2015-06-12\ntony    2015-01-02  15  2015-01-02  2015-01-02\ntony    2015-01-04  29  2015-01-02  2015-01-04\ntony    2015-01-07  50  2015-01-02  2015-01-07\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);